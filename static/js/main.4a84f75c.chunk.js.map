{"version":3,"sources":["components/common/launchpad/index.ts","consts/types.ts","hooks/useCopyPast.ts","components/common/new-drawer/utils/convertMouseEventToPosition.ts","components/common/new-drawer/entity/core/resize-area.ts","components/common/new-drawer/entity/core/event-emitter.ts","components/common/new-drawer/entity/core/abstract-figure.ts","utils/lineSegmentIntersection.ts","components/common/new-drawer/utils/convert-color/convert-color.js","utils/angleToVectorPoint.ts","components/common/new-drawer/entity/ellipse.ts","components/common/new-drawer/entity/rectangle.ts","components/common/new-drawer/entity/polygon.ts","components/common/new-drawer/entity/blob.ts","hooks/usePrev.tsx","components/common/color-picker/const.ts","components/common/color-picker/styled.tsx","components/common/color-picker/color-picker.tsx","components/common/color-picker/utils.ts","components/common/new-drawer/styleds/sidebar.tsx","components/common/new-drawer/parts/sidebar/sidebar.tsx","components/common/new-drawer/assets/ellipse.svg","components/common/new-drawer/assets/polygon.svg","components/common/new-drawer/assets/rectangle.svg","components/common/new-drawer/assets/blob.svg","components/common/new-drawer/assets/save.svg","components/common/new-drawer/assets/upload.svg","components/common/new-drawer/assets/play.svg","components/common/new-drawer/parts/control-group.tsx","utils/create-color.tsx","components/common/new-drawer/utils/shape-creators.ts","components/common/new-drawer/utils/guards/isSimpleShapeSchemeType.ts","components/common/new-drawer/utils/create-background-rectangle.ts","components/common/new-drawer/styleds/root.tsx","components/common/new-drawer/parts/title-text-field.tsx","components/common/new-drawer/parts/canvas.tsx","components/common/new-drawer/parts/drawer.tsx","utils/squeezeBase64.ts","components/common/dropzone/styled.tsx","components/common/dropzone/index.tsx","components/common/new-drawer/parts/import-modal/import-modal.tsx","utils/saveFile.ts","components/common/new-drawer/parts/export-modal/export-modal.tsx","components/common/new-drawer/paper-music.tsx","app.tsx","reportWebVitals.ts","index.tsx","consts/palettes.ts","consts/soundMap.ts","utils/MusicFactory.ts","components/common/launchpad/styleds/matrix.tsx","components/common/launchpad/parts/matrix.tsx","components/common/launchpad/styleds/root.tsx","components/common/launchpad/styleds/play-button.tsx","components/common/launchpad/launchpad.tsx","utils/isPositionEqual.ts"],"names":["IGradientType","ShapeSchemeType","useCopyPast","onCopy","onPast","handleCopyRef","useRef","current","handlePastRef","useEffect","keyPressHandler","event","handleCopy","handlePast","ctrlKey","code","document","addEventListener","removeEventListener","offsetX","isMouseEvent","x","y","offsetY","touches","clientX","clientY","changingXDirections","changingYDirections","horizontalResizeDirection","verticalResizeDirection","cursorDirectionMap","diagonalDirMap","right","down","top","left","ResizeArea","paperScope","rectangle","expandSize","onResize","_resizeHoverRectangle","_resizeVisibleRectangle","_cursorBeforeModify","_isShow","_onDocumentMouseUp","_onDocumentMouseMove","_onDocumentTouchMove","unbindMouseHoverHandlers","onMouseMove","onMouseLeave","bindMouseHoverHandlers","handleMouseMove","handleBlur","handleMouseDown","mouseUpHandler","handleMouseUp","window","mouseMoveHandler","resizeHandlerCreator","touchMoveHandler","resizeTouchHandlerCreator","direction","calculateDirection","cursor","body","style","bounds","height","width","onePercentForWidth","STROKE_WIDTH","onePercentForHeight","strokeHorizontalPercent","strokeVerticalPercent","horizontalTriggerValue","verticalTriggerValue","percentByX","point","percentByY","diffX","diffY","Math","abs","resizeVisibleRectangle","this","self","expandRectangle","rectangleVisibleColor","Color","Path","Rectangle","strokeColor","strokeWidth","visible","resizeHoverRectangle","rectangleHoverColor","Number","EPSILON","onMouseDown","updateBounds","clone","position","bringToFront","remove","isXPositionChange","includes","isYPositionChange","initBounds","initResizePoint","initX","initY","updateBoundsWidth","updateBoundsHeight","originalRectangle","unExpandRectangle","size","state","rectangleClone","eventEmitter","listeners","on","key","fn","concat","off","filter","f","emit","data","forEach","hitOptions","segments","stroke","fill","tolerance","AbstractFigure","_paperScope","_shapeData","_coreFigure","isDisable","_isPlayMode","_isActive","_ResizeArea","_lastMovePosition","_moveFigureHandler","_touchFigureHandler","_moveSegmentHandler","_touchSegmentHandler","onClick","_updateNotify","throttle","updateShapeData","serializationToShapeData","static","emitter","initCoreFigure","bindHandlers","updateCoreFigureByShapeData","updateSize","track","SoundPaletteKey","soundPosition","musicFactory","MusicFactory","soundMap","matrix","palettes","musicRoad","map","sound","playSong","selectedColor","shapeData","id","isActive","project","view","unbindSegmentMoveHandler","isShiftPress","modifiers","shift","hitResult","hitTest","item","type","segment","stopPropagation","onMouseUp","unbindFigureMoveHandler","playTrack","mustBindHandler","isCanChangePoints","location","index","insert","isSmoothFigure","smooth","bindSegmentMoveHandler","activeLayer","selected","bindFigureMoveHandler","convertMouseEventToPosition","moveFigure","updatePosition","status","resizeFigure","isShow","point2f","start","end","firstLine","secondSegment","start1","end1","start2","end2","dir1","dir2","a1","b1","d1","a2","b2","d2","seg1_line2_start","seg1_line2_end","seg2_line1_start","seg2_line1_end","u","pin_out","figure","color","isGradient","paper","red","green","blue","alpha","gradient","stops","points","GradientStop","radial","originPoint","destinationPoint","figureCenter","round","degree","vectorPoint","angle","angleInRadian","PI","cos","sin","angleToVectorPoint","doubleMaxLength","max","pointForFindIntersection","gradientLineForFindIntersection","floor","ceil","figureLineSegments","figureBounds","bottom","createLineSegment","topIntersection","lineSegmentIntersection","bottomIntersection","leftIntersection","rightIntersection","origin","destination","Ellipse","shapeScheme","coreShape","fillColor","convertColorForPaperJS","coreFigure","shape","Polygon","path","closed","pointData","Point","add","removeSegments","Blob","usePrev","value","valueRef","defaultColor","defaultGradient","linear","PickerSelectWrap","styled","div","ColorPickerWrap","ColorPicker","memo","payload","onChange","isColorGradient","useState","pikerIsGradient","setState","prevId","onChangeType","useCallback","defaultPayload","onChangeColor","colorProps","useMemo","Select","fullWidth","target","MenuItem","onStartChange","onEndChange","SidebarContainer","Sidebar","selectShape","background","onColorChange","onTrackChange","Box","sx","mb","InputLabel","_extends","Object","assign","i","arguments","length","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","d","_ref","svgRef","title","props","viewBox","ref","ForwardRef","forwardRef","fillRule","clipRule","className","CustomIconButton","IconButton","DeleteIconButton","ControlGroupContainer","ControlSubgroupContainer","withoutExtraPadding","hasButtonOffset","ControlGroup","isPlayMode","createFigure","removeFigure","openDownloadModal","openUploadModal","setPlayMode","SvgIcon","component","rectangleSVG","padding","boxSizing","ellipse","ellipseSVG","blob","blobSVG","polygon","polygonSVG","saveSVG","uploadSVG","playSVG","createColor","random","INIT_POINT","INIT_SIZE","firstPaletteKey","default","isSimpleShapeSchemeType","createBackgroundRectangle","scope","backgroundColor","viewSize","Container","TitleTextFields","Content","canvasRef","Drawer","shapeList","updateShapeList","updateBackgroundColor","updateTitle","selectShapeId","setSelectShapeId","pastBufferRef","shapeListRef","find","containerRef","shapeArrRef","backgroundRef","scopeRef","titleInputRef","updateShapeItem","updateShape","actualShapeList","selectShapeIndex","findIndex","slice","handleResizeWindow","container","clientWidth","clientHeight","updateFromShapeData","update","Error","PaperScope","setup","handleShapeUpdate","handleShapeFocused","handleCanvasClick","focus","containerElement","shapeMap","reduce","createShapeMap","createShape","push","values","bufferValueShape","nanoid","createMusicShape","musicShapeType","musicShape","centerPoint","corePoint","pointArr","delta","multiply","totalX","totalY","createComplexMusicShape","removeMusicShape","handleColorChange","handleTrackChange","Input","placeholder","decode","dataStr","packJSON","fromBase64","unpack","DropZoneContainer","Dropzone","onLoaded","accept","onDrop","acceptedFiles","file","firstFile","Promise","resolve","reader","FileReader","result","readAsArrayBuffer","then","arrayBuffer","useDropzone","multiple","undefined","getRootProps","getInputProps","isDragActive","Typography","ModalContainer","UploadStringTextField","TextField","CustomFormControlLabel","FormControlLabel","CustomButton","Button","ImportModal","isOpen","uploadMusicPaper","closeUploadModal","uploadType","setUploadType","dataString","setDataString","handleUploadFile","base64","musicPaper","handleUploadString","handleUploadTypeChange","Modal","open","onClose","m","FormControl","FormLabel","RadioGroup","name","row","_","control","Radio","label","margin","multiline","rows","el","variant","disabled","saveFile","fileName","a","download","url","URL","createObjectURL","href","appendChild","click","setTimeout","removeChild","revokeObjectURL","ExportModal","closeDownloadModal","pack","encodeToBase64","encodeSqueezeBase64","handleDownload","WHITE_COLOR","PaperMusic","isUploadModalOpen","setUploadModalState","isDownloadModalOpen","setDownloadModalState","version","setMusicPaper","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById","soundPaletteMap","caption","nodeName","extra","bass","Mixed","x1","x2","x3","x4","x5","x6","x7","x8","x9","b3","b4","b5","b6","b7","b8","b9","d3","d4","d5","d6","d7","d8","d9","a3","a4","a5","a6","a7","a8","a9","SongFactory","initSoundData","Howl","src","soundArray","unexpendedSound","playSound","soundArr","soundKey","once","play","MatrixContainer","MatrixRow","MatrixCell","isSelect","css","LaunchpadMatrix","activeCell","schemeKey","onToggleCell","orderMap","keyMap","Array","fromEntries","obj","isCellSelect","onCellClick","rowIndex","cell","cellIndex","PlayButton","paletteItemsForDD","firstPalette","createEmptyTrack","LaunchPad","onMusicChange","selectPalette","setPalette","onPlay","updateSoundPosition","trackItem","second","first","onChangePalette"],"mappings":"oHAAA,6D,gJCuBYA,EAmBAC,E,iGAnBAD,K,gBAAAA,E,iBAAAA,M,cAmBAC,O,qBAAAA,I,yBAAAA,I,qBAAAA,I,gBAAAA,M,KCbGC,MA3Bf,SAAqBC,EAAsBC,GACzC,IAAMC,EAAgBC,iBAAOH,GAC7BE,EAAcE,QAAUJ,EAExB,IAAMK,EAAgBF,iBAAOF,GAC7BI,EAAcD,QAAUH,EAExBK,qBAAU,WAER,IAAMC,EAAkB,SAACC,GACvB,IAAMC,EAAaP,EAAcE,QAC3BM,EAAaL,EAAcD,QAC5BI,EAAMG,UACQ,SAAfH,EAAMI,KACRH,IACwB,SAAfD,EAAMI,MACfF,MAKJ,OADAG,SAASC,iBAAiB,UAAWP,GAC9B,WACLM,SAASE,oBAAoB,UAAWR,MAEzC,K,gDCpBU,WAACC,GACd,OALmB,SAACA,GACpB,QAAUA,EAAqBQ,QAI3BC,CAAaT,GACR,CACLU,EAAGV,EAAMQ,QACTG,EAAGX,EAAMY,SAIN,CACLF,EAAGV,EAAMa,QAAQ,GAAGC,QACpBH,EAAGX,EAAMa,QAAQ,GAAGE,UCsBlBC,EAAoC,CACxC,OACA,iBACA,kBAGIC,EAAoC,CACxC,MACA,iBACA,kBAGIC,EAAsC,CAC1C,OACA,QACA,iBACA,iBACA,iBACA,kBAEIC,EAAoC,CACxC,OACA,MACA,iBACA,iBACA,iBACA,kBAGIC,EAAyC,CAC7C,KAAQ,YACR,IAAO,YACP,KAAQ,YACR,MAAS,YACT,iBAAkB,cAClB,iBAAkB,cAClB,iBAAkB,cAClB,iBAAkB,eAGdC,EAA4D,CAChEC,MAAO,CACLC,KAAM,iBACNC,IAAK,kBAEPC,KAAM,CACJF,KAAM,iBACNC,IAAK,mBAYYE,E,WAcnB,WACUC,EACRC,GAEC,IAAD,OADQC,EACR,uDApBwB,GAoBxB,yBAHQF,aAGR,KADQE,aACR,KAjBKC,SAAiC,KAiBtC,KAfMC,2BAeN,OAdMC,6BAcN,OAZMC,oBAAqC,KAY3C,KAXMC,SAAmB,EAWzB,KATMC,mBAA0C,KAShD,KARMC,qBAAkD,KAQxD,KAPMC,qBAAkD,KAOxD,KA0DQC,yBAA2B,WACnC,EAAKP,sBAAsBQ,YAAc,KACzC,EAAKR,sBAAsBS,aAAe,MA5D1C,KA+DQC,uBAAyB,WACjC,EAAKV,sBAAsBQ,YAAc,SAACvC,GACxC,EAAK0C,gBAAgB1C,IAEvB,EAAK+B,sBAAsBS,aAAe,WACxC,EAAKG,eApEP,KAwEQC,gBAAkB,SAAC5C,GAC3B,EAAKsC,2BAEL,IAAMO,EAAiB,kBAAM,EAAKC,iBAClCC,OAAOzC,iBAAiB,UAAWuC,GACnCE,OAAOzC,iBAAiB,WAAYuC,GACpC,EAAKV,mBAAqBU,EAG1B,IAAMG,EAAmB,EAAKC,qBAAqBjD,GAC7CkD,EAAmB,EAAKC,0BAA0BnD,GACxD+C,OAAOzC,iBAAiB,YAAa0C,GACrCD,OAAOzC,iBAAiB,YAAa4C,GACrC,EAAKd,qBAAuBY,EAC5B,EAAKX,qBAAuBa,GAtF5B,KAyFQJ,cAAgB,WACpB,EAAKX,qBACPY,OAAOxC,oBAAoB,UAAW,EAAK4B,oBAC3CY,OAAOxC,oBAAoB,WAAY,EAAK4B,qBAE1C,EAAKC,uBACPW,OAAOxC,oBAAoB,YAAa,EAAK6B,sBAE7CW,OAAOxC,oBAAoB,YAAa,EAAK8B,uBAG/C,EAAKI,0BApGL,KAuGQC,gBAAkB,SAAC1C,GAC3B,IAAMoD,EAAY,EAAKC,mBAAmBrD,GACpCsD,EAASlC,EAAmBgC,GAED,OAA7B,EAAKnB,sBACP,EAAKA,oBAAsB5B,SAASkD,KAAKC,MAAMF,QAGjDjD,SAASkD,KAAKC,MAAMF,OAASA,GA/G7B,KAkHQX,WAAa,WACW,MAA5B,EAAKV,sBACP5B,SAASkD,KAAKC,MAAMF,OAAS,EAAKrB,oBAClC,EAAKA,oBAAsB,OArH7B,KA6NQoB,mBAAqB,SAACrD,GAAyC,IAAD,EACtC,EAAK+B,sBAAsB0B,OAAnDC,EAD8D,EAC9DA,OAAQC,EADsD,EACtDA,MAAOjD,EAD+C,EAC/CA,EAAGC,EAD4C,EAC5CA,EACpBiD,GAAsBD,EAAQE,IAAgB,IAC9CC,GAAuBJ,EAASG,IAAgB,IAEhDE,EAxPW,GAwP8BH,EACzCI,EAzPW,GAyP4BF,EAEvCG,GAA0B,IAAiC,EAA1BF,GAA8B,EAC/DG,GAAwB,IAAiC,EAA1BH,GAA8B,EAE7DI,GAAcnE,EAAMoE,MAAM1D,EAAIA,GAAKkD,EACnCS,GAAcrE,EAAMoE,MAAMzD,EAAIA,GAAKmD,EAEnCQ,EAAQH,EAAa,GACrBI,EAAQF,EAAa,GAO3B,OAJEG,KAAKC,IAAIH,IAAUL,GAChBO,KAAKC,IAAIF,IAAUL,EAMf7C,EAFqCiD,EAAQ,EAAI,QAAU,QAC1BC,EAAQ,EAAI,OAAS,OAIzDJ,EAAaH,EAA8B,OAC3CG,EAAa,IAAMH,EAA8B,QACjDK,EAAaN,EAAgC,MACM,QA3PzD,IAAMW,EAAyBC,KAAKC,KAAKC,gBAAgBjD,EAAW+C,KAAK9C,YACnEiD,EAAwB,IAAIH,KAAKhD,WAAWoD,MAAM,EAAG,EAAG,EAAG,IACjEJ,KAAK3C,wBAA0B,IAAI2C,KAAKhD,WAAWqD,KAAKC,UAAUP,GAElEC,KAAK3C,wBAAwBkD,YAAcJ,EAC3CH,KAAK3C,wBAAwBmD,YA7BJ,EA8BzBR,KAAK3C,wBAAwBoD,SAAU,EAEvC,IAAMC,EAAuBV,KAAKC,KAAKC,gBAAgBjD,EAAW+C,KAAK9C,YACjEyD,EAAsB,IAAIX,KAAKhD,WAAWoD,MAAM,EAAG,EAAG,EAAGQ,OAAOC,SACtEb,KAAK5C,sBAAwB,IAAI4C,KAAKhD,WAAWqD,KAAKC,UAAUI,GAEhEV,KAAK5C,sBAAsBmD,YAAcI,EACzCX,KAAK5C,sBAAsBoD,YApCV,GAqCjBR,KAAK5C,sBAAsBqD,SAAU,EAErCT,KAAKlC,yBAELkC,KAAK5C,sBAAsB0D,YAAe,SAACzF,GACzC,EAAK4C,gBAAgB5C,I,uDAIP4B,GAChB,IAAM8D,EAAef,KAAKC,KAAKC,gBAAgBjD,EAAW+C,KAAK9C,YAC/D8C,KAAK3C,wBAAwByB,OAASiC,EAAaC,QACnDhB,KAAK5C,sBAAsB0B,OAASiC,I,4BAazBhF,EAAWC,GACtBgE,KAAK5C,sBAAsB6D,SAASlF,GAAKA,EACzCiE,KAAK5C,sBAAsB6D,SAASjF,GAAKA,EAEzCgE,KAAK3C,wBAAwB4D,SAASlF,GAAKA,EAC3CiE,KAAK3C,wBAAwB4D,SAASjF,GAAKA,I,qCAI3CgE,KAAK3C,wBAAwB6D,eAC7BlB,KAAK5C,sBAAsB8D,iB,+BAI3BlB,KAAK3C,wBAAwB8D,SAC7BnB,KAAK5C,sBAAsB+D,W,2CAkEE9F,GAA6C,IAAD,OACnEoD,EAAYuB,KAAKtB,mBAAmBrD,GACpC+F,EAAoB/E,EAAoBgF,SAAS5C,GACjD6C,EAAoBhF,EAAoB+E,SAAS5C,GACjD8C,EAAavB,KAAK5C,sBAAsB0B,OAAOkC,QACtCQ,EAAoBnG,EAA3BoE,MAER,OAAO,SAACpE,GAAuB,IAClBoG,EAAmBD,EAAtBzF,EAAa2F,EAASF,EAAZxF,EACDD,EAAkBV,EAA3BQ,QAAqBG,EAAMX,EAAfY,QAEhB0D,EAAQpD,EAA0B8E,SAAS5C,GAAa1C,EAAI0F,EAAQ,EACpE7B,EAAQpD,EAAwB6E,SAAS5C,GAAazC,EAAI0F,EAAQ,EAEtE/B,EAAQyB,GAAqBzB,EAAQA,EACrCC,EAAQ0B,GAAqB1B,EAAQA,EAGrC,IAAMd,EAASyC,EAAWP,QACpBW,EAAoB7C,EAAOE,MAAQW,EACnCiC,EAAqB9C,EAAOC,OAASa,EAoB3C,GAlBI+B,EAAoB,IACtB7C,EAAOE,MAAQ2C,EACf7C,EAAO/C,GAAKqF,GAAqBzB,EAAQ,IAEzCb,EAAOE,MAAQ,EAAK5B,sBAAsB0B,OAAOE,MACjDF,EAAO/C,EAAI,EAAKqB,sBAAsB0B,OAAO/C,GAG3C6F,EAAqB,IACvB9C,EAAOC,OAAS6C,EAChB9C,EAAO9C,GAAKsF,GAAqB1B,EAAQ,IAEzCd,EAAOC,OAAS,EAAK3B,sBAAsB0B,OAAOC,OAClDD,EAAO9C,EAAI,EAAKoB,sBAAsB0B,OAAO9C,GAG/C,EAAKqB,wBAAwByB,OAASA,EAAOkC,QAC7C,EAAK5D,sBAAsB0B,OAASA,EAChC,EAAK3B,SAAU,CACjB,IAAM0E,EAAoB,EAAK5B,KAAK6B,kBAAkBhD,EAAQ,EAAK5B,YAC7D6E,EAAc,CAAE/C,MAAO6C,EAAkB7C,MAAOD,OAAQ8C,EAAkB9C,QAC1EkC,EAAmB,CAAElF,EAAG8F,EAAkB9F,EAAGC,EAAG6F,EAAkB7F,GACxE,EAAKmB,SAAS4E,EAAMd,O,gDAKU5F,GAA6C,IAAD,OACxEoD,EAAYuB,KAAKtB,mBAAmBrD,GAEpC+F,EAAoB/E,EAAoBgF,SAAS5C,GACjD6C,EAAoBhF,EAAoB+E,SAAS5C,GACjD8C,EAAavB,KAAK5C,sBAAsB0B,OAAOkC,QACtCQ,EAAoBnG,EAA3BoE,MAER,OAAO,SAACpE,GACN,GAAKA,EAAMa,QAAQ,GAAnB,CAD4B,IAEjBuF,EAAmBD,EAAtBzF,EAAa2F,EAASF,EAAZxF,EAFU,EAGOX,EAAMa,QAAQ,GAAhCH,EAHW,EAGpBI,QAAqBH,EAHD,EAGRI,QAEhBuD,EAAQpD,EAA0B8E,SAAS5C,GAAa1C,EAAI0F,EAAQ,EACpE7B,EAAQpD,EAAwB6E,SAAS5C,GAAazC,EAAI0F,EAAQ,EAEtE/B,EAAQyB,GAAqBzB,EAAQA,EACrCC,EAAQ0B,GAAqB1B,EAAQA,EAGrC,IAAMd,EAASyC,EAAWP,QACpBW,EAAoB7C,EAAOE,MAAQW,EACnCiC,EAAqB9C,EAAOC,OAASa,EAoB3C,GAlBI+B,EAAoB,IACtB7C,EAAOE,MAAQ2C,EACf7C,EAAO/C,GAAKqF,GAAqBzB,EAAQ,IAEzCb,EAAOE,MAAQ,EAAK5B,sBAAsB0B,OAAOE,MACjDF,EAAO/C,EAAI,EAAKqB,sBAAsB0B,OAAO/C,GAG3C6F,EAAqB,IACvB9C,EAAOC,OAAS6C,EAChB9C,EAAO9C,GAAKsF,GAAqB1B,EAAQ,IAEzCd,EAAOC,OAAS,EAAK3B,sBAAsB0B,OAAOC,OAClDD,EAAO9C,EAAI,EAAKoB,sBAAsB0B,OAAO9C,GAG/C,EAAKqB,wBAAwByB,OAASA,EAAOkC,QAC7C,EAAK5D,sBAAsB0B,OAASA,EAChC,EAAK3B,SAAU,CACjB,IAAM0E,EAAoB,EAAK5B,KAAK6B,kBAAkBhD,EAAQ,EAAK5B,YAC7D6E,EAAc,CAAE/C,MAAO6C,EAAkB7C,MAAOD,OAAQ8C,EAAkB9C,QAC1EkC,EAAmB,CAAElF,EAAG8F,EAAkB9F,EAAGC,EAAG6F,EAAkB7F,GACxE,EAAKmB,SAAS4E,EAAMd,Q,6BAzLxB,OAAOjB,KAAKzC,S,aAEIyE,GACZhC,KAAKzC,UAAYyE,IACrBhC,KAAK3C,wBAAwBoD,QAAUuB,EACvChC,KAAK5C,sBAAsBqD,QAAUuB,EACrChC,KAAKzC,QAAUyE,K,2BA6Nf,OAAOjF,K,uCAIPE,EACAC,GAEA,IAAM+E,EAAiBhF,EAAU+D,QAKjC,OAJAiB,EAAelG,GAAKmB,EACpB+E,EAAejG,GAAKkB,EACpB+E,EAAejD,OAAsB,EAAb9B,EACxB+E,EAAelD,QAAuB,EAAb7B,EAClB+E,I,wCAIPhF,EACAC,GAEA,IAAM+E,EAAiBhF,EAAU+D,QAKjC,OAJAiB,EAAelG,GAAKmB,EACpB+E,EAAejG,GAAKkB,EACpB+E,EAAejD,OAAsB,EAAb9B,EACxB+E,EAAelD,QAAuB,EAAb7B,EAClB+E,M,KC3WIC,MApBf,WACE,IAAMC,EAEF,GAEJ,MAAO,CACLC,GADK,SACFC,EAAKC,GACNH,EAAUE,IAAQF,EAAUE,IAAQ,IAAIE,OAAOD,IAEjDE,IAJK,SAIDH,EAAKC,GACPH,EAAUE,IAAQF,EAAUE,IAAQ,IAAII,QAAO,SAAAC,GAAC,OAAIA,IAAMJ,MAE5DK,KAPK,SAOAN,EAAKO,IACPT,EAAUE,IAAQ,IAAIQ,SAAQ,SAASP,GACtCA,EAAGM,SCVLE,EAAa,CAClBC,UAAU,EACVC,QAAQ,EACRC,MAAM,EACNC,UAAW,GAGUC,EAAtB,WAgCE,WACUC,EACAC,GACP,IAAD,gCAFQD,cAER,KADQC,aACR,KA9BeC,iBA8Bf,OA7BKC,WAAqB,EA6B1B,KA3BMC,aAAuB,EA2B7B,KA1BMC,WAAqB,EA0B3B,KAzBMC,YAAiC,KAyBvC,KAxBMC,kBAAmC,KAwBzC,KAvBMC,mBAA8C,KAuBpD,KAtBMC,oBAA+C,KAsBrD,KArBMC,oBAA+C,KAqBrD,KApBMC,qBAAgD,KAoBtD,KAPKC,QAA+B,KAOpC,KA8FMC,cAAgBC,oBAAS,WAC/B,IAAMC,EAAkB,EAAKC,yBAAyB,EAAKd,YAAa,EAAKD,YAC7E,EAAKA,WAAac,EAClB,EAAKE,OAAOC,QAAQ3B,KAAK,SAAUwB,KAClC,IAjGDnE,KAAKsD,YAActD,KAAKuE,eAAenB,EAAaC,GACpDrD,KAAKwE,eArCT,gEAwC6BL,GAAmC,IAAD,EAC3DnE,KAAKyE,4BAA4BzE,KAAKsD,YAAaa,EAAiBnE,KAAKoD,aACzEpD,KAAKqD,WAAac,EAClB,UAAAnE,KAAK0D,mBAAL,SAAkBgB,WAAW1E,KAAKsD,YAAYxE,UA3ClD,qCA6FyB,IAAD,EACpBkB,KAAKsD,YAAYpC,eACjB,UAAAlB,KAAK0D,mBAAL,SAAkBxC,iBA/FtB,+BAmGQlB,KAAK4D,oBACPxF,OAAOxC,oBAAoB,YAAaoE,KAAK4D,oBAG3C5D,KAAK0D,aAAa1D,KAAK0D,YAAYvC,SACvCnB,KAAKsD,YAAYnC,WAxGrB,uCA4GI,OAAO,IA5GX,0CAgHI,OAAO,IAhHX,kCAmHuB,IACXwD,EAAU3E,KAAKqD,WAAfsB,MACR,GAAKA,EAAL,CAFkB,IAGVC,EAAmCD,EAAnCC,gBAAiBC,EAAkBF,EAAlBE,cACnBC,EAAe,IAAIC,IAAaC,KAC9BC,EAAWC,IAASN,GAApBK,OACFE,EAAYN,EAAcO,KAAI,YAAe,IAAZrJ,EAAW,EAAXA,EAAGC,EAAQ,EAARA,EAExC,OADkBiJ,EAAOlJ,GAAGC,GAApBqJ,SAIVP,EAAaQ,SAASH,MA9H1B,qCAuI0B,IAAD,OACrBnF,KAAKsD,YAAY/C,YAAc,IAAIP,KAAKoD,YAAYhD,MAAM,EAAG,EAAG,EAAGQ,OAAOC,SAC1Eb,KAAKsD,YAAYiC,cAAgB,IAAIvF,KAAKoD,YAAYhD,MAAM,EAAG,EAAG,GAClEJ,KAAKsD,YAAY9C,YAAc,EAE/BR,KAAKqE,OAAOC,QAAQlC,GAAG,SAAS,SAACoD,GAC3BA,EAAUC,KAAO,EAAKA,KAC1B,EAAKC,UAAW,MAGlB1F,KAAKoD,YAAYuC,QAAQC,KAAKxD,GAAG,WAAW,SAAC/G,GAA6B,IAAD,EACvE,IAAI,EAAKkI,UAAT,CACA,EAAKsC,2BAFkE,IAIxDC,EAAiBzK,EAAM0K,UAA9BC,MACR,GAAK,EAAKN,UAAaI,EAAvB,CAEA,IAAMG,EAAY,EAAK7C,YAAYuC,QAAQO,QAAQ7K,EAAMoE,MAAOqD,GAC3DmD,GAEDA,EAAUE,OAAS,EAAK7C,aAAkC,YAAnB2C,EAAUG,OACrDH,EAAUI,QAAQlF,SAClB,YAAKuC,mBAAL,SAAkBgB,WAAW,EAAKpB,YAAYxE,QAC9CzD,EAAMiL,wBAGRtG,KAAKsD,YAAYiD,UAAY,WAC3B,EAAKC,2BAGPxG,KAAKsD,YAAYxC,YAAc,SAACzF,GAC9B,GAAI,EAAKmI,YACP,EAAKiD,iBAGP,GAAI,EAAKlD,UACP,EAAKc,OAAOC,QAAQ3B,KAAK,QAAS,EAAKU,gBADzC,CAIA,IAAIqD,GAAkB,EACtB,GAAK,EAAKhB,UAIH,GAAI,EAAKiB,oBAAqB,CAAC,IAE9BV,EADc,EAAK7C,YAAjBuC,QACkBO,QAAQ7K,EAAMoE,MAAOqD,GAC/C,GAAImD,EAAW,CAAC,IAEoC,EADnCH,EAAiBzK,EAAM0K,UAA9BC,MACR,GAAIF,GAAmC,YAAnBG,EAAUG,KAC5BH,EAAUI,QAAQlF,SAClB,YAAKuC,mBAAL,SAAkBgB,WAAW,EAAKpB,YAAYxE,QAC9CzD,EAAMiL,kBACNI,GAAkB,EAClB,EAAKzC,qBACA,GAAuB,YAAnBgC,EAAUG,MAAuBN,GAGrC,GAAuB,WAAnBG,EAAUG,KAAmB,CAAC,IAAD,EAChCnF,EAAWgF,EAAUW,SAASC,MAAQ,EACtCR,EAAU,EAAK/C,YAAYwD,OAAO7F,EAAU5F,EAAMoE,OACpD,EAAKsH,kBAAkB,EAAKzD,YAAY0D,SAE5C,YAAKtD,mBAAL,SAAkBgB,WAAW,EAAKpB,YAAYxE,QAC9C,EAAKmI,uBAAuBZ,GAC5BK,GAAkB,QATlB,EAAKO,uBAAuBhB,EAAUI,SACtCK,GAAkB,SAhBtB,EAAKtD,YAAYuC,QAAQuB,YAAYC,UAAW,EAChD,EAAK9C,OAAOC,QAAQ3B,KAAK,QAAS,EAAKU,YACvC,EAAKqC,UAAW,EA4BlB,GAAIgB,EAAiB,CAAC,IAAD,EACSrL,EAApBoE,MAAS1D,EADE,EACFA,EAAGC,EADD,EACCA,EACpB,EAAKoL,sBAAsB,CAAErL,IAAGC,MAElC,EAAKgI,SAAW,EAAKA,cAlN3B,6CAsNiCqC,GAAyB,IAAD,OACrDrG,KAAK8D,oBAAsBI,oBAAS,SAAC7I,GAAuB,IAAD,EACnD4F,EAAWoG,EAA4BhM,GAC7CgL,EAAQ5G,MAAM1D,EAAIkF,EAASlF,EAC3BsK,EAAQ5G,MAAMzD,EAAIiF,EAASjF,EAC3B,YAAK0H,mBAAL,SAAkBgB,WAAW,EAAKpB,YAAYxE,UAC7C,IACHkB,KAAK+D,qBAAuBG,oBAAS,SAAC7I,GAAuB,IAAD,EACpD4F,EAAWoG,EAA4BhM,GAC7CgL,EAAQ5G,MAAM1D,EAAIkF,EAASlF,EAC3BsK,EAAQ5G,MAAMzD,EAAIiF,EAASjF,EAC3B,YAAK0H,mBAAL,SAAkBgB,WAAW,EAAKpB,YAAYxE,UAC7C,IAEHV,OAAOzC,iBAAiB,YAAaqE,KAAK8D,qBAC1C1F,OAAOzC,iBAAiB,YAAaqE,KAAK+D,wBArO9C,iDAyOS/D,KAAK8D,qBAAwB9D,KAAK+D,uBACvC3F,OAAOxC,oBAAoB,YAAaoE,KAAK8D,qBAC7C1F,OAAOxC,oBAAoB,YAAaoE,KAAK+D,sBAE7C/D,KAAKiE,gBACLjE,KAAK8D,oBAAsB,KAC3B9D,KAAK+D,qBAAuB,QA/OhC,4CAoPgC9C,GAAmB,IAAD,OAC9CjB,KAAK2D,kBAAoB1C,EACzBjB,KAAK4D,mBAAqBM,oBAAS,SAAC7I,GAAD,OAAW,EAAKiM,WAAWjM,KAAQ,IACtE2E,KAAK6D,oBAAsBK,oBAAS,SAAC7I,GAAD,OAAuB,EAAKiM,WAAWjM,KAAQ,IACnF+C,OAAOzC,iBAAiB,YAAaqE,KAAK4D,oBAC1CxF,OAAOzC,iBAAiB,YAAaqE,KAAK6D,uBAzP9C,gDA6PS7D,KAAK4D,oBAAuB5D,KAAK6D,sBACtCzF,OAAOxC,oBAAoB,YAAaoE,KAAK4D,oBAC7CxF,OAAOxC,oBAAoB,YAAaoE,KAAK6D,qBAC7C7D,KAAKiE,gBACLjE,KAAK2D,kBAAoB,QAjQ7B,iCAoQqBtI,GACjB,GAAK2E,KAAK2D,kBAAV,CAEA,IAAM4D,EAAiBF,EAA4BhM,GAC7CsE,EAAQ4H,EAAexL,EAAIiE,KAAK2D,kBAAkB5H,EAClD6D,EAAQ2H,EAAevL,EAAIgE,KAAK2D,kBAAkB3H,EACxDgE,KAAKsD,YAAYrC,SAASlF,GAAK4D,EAC/BK,KAAKsD,YAAYrC,SAASjF,GAAI4D,EAE1BI,KAAK0D,aAAa1D,KAAK0D,YAAYsC,MAAMrG,EAAOC,GACpDI,KAAK2D,kBAAoB4D,KA9Q7B,mCAiSuBxF,EAAad,GAChCjB,KAAKsD,YAAYxE,OAAOE,MAAQ+C,EAAK/C,MACrCgB,KAAKsD,YAAYxE,OAAOC,OAASgD,EAAKhD,OACtCiB,KAAKsD,YAAYxE,OAAO/C,EAAIkF,EAASlF,EACrCiE,KAAKsD,YAAYxE,OAAO9C,EAAIiF,EAASjF,IArSzC,gCA+CI,OAAOgE,KAAKqD,aA/ChB,6BAmDI,OAAOF,IAnDX,6BAuDI,OAAOnD,KAAKsD,YAAYxE,SAvD5B,yBA2DI,OAAOkB,KAAKqD,WAAWoC,KA3D3B,iCA+DI,OAAOzF,KAAKwD,aA/DhB,aAkEwBgE,GACpBxH,KAAKwD,YAAcgE,EACnBxH,KAAK0F,UAAW,IApEpB,+BAwEI,OAAO1F,KAAKyD,WAxEhB,aA2EsBzB,GAAiB,IAAD,OAC9BhC,KAAKyD,YAAczB,IAClBhC,KAAK0D,cACR1D,KAAK0D,YAAc,IAAI3G,EAAWiD,KAAKoD,YAAapD,KAAKsD,YAAYxE,QACrEkB,KAAK0D,YAAYvG,SAAW,SAAC4E,EAAMd,GACjC,EAAKwG,aAAa1F,EAAMd,GACxB,EAAKgD,kBAILjE,KAAK2G,sBACP3G,KAAKsD,YAAY6D,SAAWnF,GAG9BhC,KAAK0D,YAAYgE,OAAS1F,EAC1BhC,KAAKyD,UAAYzB,KA1FrB,iCAmRI,QAAKhC,KAAK0D,aACH1D,KAAK0D,YAAYgE,QApR5B,aAuRiB1F,GAAiB,IAAD,OACxBhC,KAAK0D,cACR1D,KAAK0D,YAAc,IAAI3G,EAAWiD,KAAKoD,YAAapD,KAAKsD,YAAYxE,QACrEkB,KAAK0D,YAAYvG,SAAW,SAAC4E,EAAMd,GACjC,EAAKwG,aAAa1F,EAAMd,KAG5BjB,KAAK0D,YAAYgE,OAAS1F,MA9R9B,KAAsBmB,EAIJmB,QAA2BpC,I,oBCvBvCyF,EAAU,SAACC,EAAexB,EAAmByB,GACjD,OAAOzB,GACL,IAAK,IACH,MAAO,CAACrK,EAAG6L,EAAM7L,EAAI8L,EAAI9L,EAAGC,EAAG4L,EAAM5L,EAAI6L,EAAI7L,GAC/C,IAAK,IACH,MAAO,CAACD,EAAG6L,EAAM7L,EAAI8L,EAAI9L,EAAGC,EAAG4L,EAAM5L,EAAI6L,EAAI7L,GAC/C,IAAK,IACH,MAAO,CAACD,EAAG6L,EAAM7L,EAAI8L,EAAI9L,EAAGC,EAAG4L,EAAM5L,EAAI6L,EAAI7L,GAC/C,IAAK,IACH,MAAO,CAACD,EAAG6L,EAAM7L,EAAI8L,EAAI9L,EAAGC,EAAG4L,EAAM5L,EAAI6L,EAAI7L,KAKpC,WAAC8L,EAAwBC,GAA+B,IAAD,cAC7CD,EAD6C,GAC7DE,EAD6D,KACrDC,EADqD,mBAE7CF,EAF6C,GAE7DG,EAF6D,KAErDC,EAFqD,KAI9DC,EAAOT,EAAQM,EAAM,IAAKD,GAC1BK,EAAOV,EAAQQ,EAAM,IAAKD,GAE1BI,GAAMF,EAAKpM,EACXuM,GAAMH,EAAKrM,EACXyM,IAAOF,EAAGN,EAAOjM,EAAIwM,EAAGP,EAAOhM,GAE/ByM,GAAMJ,EAAKrM,EACX0M,GAAML,EAAKtM,EACX4M,IAAOF,EAAGP,EAAOnM,EAAI2M,EAAGR,EAAOlM,GAE/B4M,EAAmBH,EAAGT,EAAOjM,EAAI2M,EAAGV,EAAOhM,EAAI2M,EAC/CE,EAAiBJ,EAAGR,EAAKlM,EAAI2M,EAAGT,EAAKjM,EAAI2M,EAEzCG,EAAmBR,EAAGJ,EAAOnM,EAAIwM,EAAGL,EAAOlM,EAAIwM,EAC/CO,EAAiBT,EAAGH,EAAKpM,EAAIwM,EAAGJ,EAAKnM,EAAIwM,EAE/C,GAAII,EAAmBC,GAAkB,GAAKC,EAAmBC,GAAkB,EACjF,OAAO,EAGT,IAAMC,EAAIJ,GAAoBA,EAAmBC,GAC3CI,EAAUtB,EAAQ,CAAC5L,EAAGiN,EAAGhN,EAAGgN,GAAI,IAAKZ,GAC3C,OAAOT,EAAQK,EAAQ,IAAKiB,ICjBf,WAACC,EAAQC,GACtB,IA3BiB,SAACA,GAClB,QAASA,EAAM/C,MAAuB,QAAf+C,EAAM/C,KA0BxBgD,CAAWD,GACd,OAAO,IAAIE,IAAMjJ,MAAM+I,EAAMG,IAAI,IAAKH,EAAMI,MAAM,IAAKJ,EAAMK,KAAK,IAAKL,EAAMM,OAF/C,MAKAP,EAAOpK,OAA/BE,EALwB,EAKxBA,MAAOD,EALiB,EAKjBA,OAAQhD,EALS,EAKTA,EAAGC,EALM,EAKNA,EACpB0N,EAAW,CACfC,MAAOR,EAAMS,OAAOxE,KAAI,SAAC3F,GAAD,OAAW,IAAI4J,IAAMQ,aAC3C,IAAIR,IAAMjJ,MAAMX,EAAM6J,IAAI,IAAK7J,EAAM8J,MAAM,IAAK9J,EAAM+J,KAAK,IAAK/J,EAAMgK,OACtEhK,EAAM3C,KAAK,QAEbgN,OAAuB,WAAfX,EAAM/C,MAGhB,GAAmB,WAAf+C,EAAM/C,KAAmB,CAC3B,IA8BI2D,EAAaC,EA9BXC,EAAe,CACnBlO,EAAGA,EAAI8D,KAAKqK,MAAMlL,EAAM,GACxBhD,EAAGA,EAAI6D,KAAKqK,MAAMnL,EAAO,IAGrBoL,EAAShB,EAAMgB,OAAS,GACxBC,ECjDK,SAACC,GACd,IAAMC,EAAgBD,EAAM,IAAMxK,KAAK0K,GACvC,MAAO,CACLxO,EAAG8D,KAAK2K,IAAIF,GACZtO,EAAG6D,KAAK4K,IAAIH,ID6CQI,CAAmBP,GACjCQ,EAA4C,EAA1B9K,KAAK+K,IAAI5L,EAAOD,GAClC8L,EAA2B,CAC/B9O,EAAGqO,EAAYrO,EAAI4O,EACnB3O,EAAGoO,EAAYpO,EAAI2O,GAGfG,EAAkC,CACtC,CACE/O,EAAG8D,KAAKkL,MAAMd,EAAalO,EAAI8O,EAAyB9O,GACxDC,EAAG6D,KAAKkL,MAAMd,EAAajO,EAAI6O,EAAyB7O,IAE1D,CACED,EAAG8D,KAAKmL,KAAKf,EAAalO,EAAI8O,EAAyB9O,GACvDC,EAAG6D,KAAKmL,KAAKf,EAAajO,EAAI6O,EAAyB7O,KAGrDiP,EA5DgB,SAACC,GAAkB,IACnClM,EAAwBkM,EAAxBlM,MAAOD,EAAiBmM,EAAjBnM,OAAQhD,EAASmP,EAATnP,EAAGC,EAAMkP,EAANlP,EAa1B,MAAO,CACLa,IAbqB,CAAE,CAAEd,IAAGC,KAAK,CAACD,EAAGA,EAAIiD,EAAOhD,MAchDmP,OAbwB,CACxB,CAAEpP,IAAGC,EAAGA,EAAI+C,GACZ,CAAChD,EAAGA,EAAIiD,EAAOhD,EAAGA,EAAI+C,IAYtBjC,KATsB,CAAE,CAAEf,IAAGC,KAAK,CAAED,IAAGC,EAAGA,EAAI+C,IAU9CpC,MATuB,CACvB,CAAEZ,EAAGA,EAAIiD,EAAOhD,KAChB,CAAED,EAAGA,EAAIiD,EAAOhD,EAAGA,EAAI+C,KAiDIqM,CAAkBlC,EAAOpK,QAE9CuM,EAAkBC,EAAwBR,EAAiCG,EAAmBpO,KAC9F0O,EAAqBD,EAAwBR,EAAiCG,EAAmBE,QACjGK,EAAmBF,EAAwBR,EAAiCG,EAAmBnO,MAC/F2O,EAAoBH,EAAwBR,EAAiCG,EAAmBtO,OAGtG,GAAI0O,EAAiB,CACnB,IAAKE,EAAoB,OAGzB,GAFAxB,EAAcsB,EACdrB,EAAmBuB,EACdpB,EAAS,KAAOA,EAAS,IAAM,CAAC,IAAD,EACD,CAACH,EAAkBD,GAAnDA,EADiC,KACrBC,EADqB,UAG/B,CACL,IAAKwB,IAAqBC,EAAmB,OAG7C,GAFA1B,EAAcyB,EACdxB,EAAmByB,IACbtB,EAAS,IAAMA,EAAS,KAAM,CAAC,IAAD,EACD,CAACH,EAAkBD,GAAnDA,EADiC,KACrBC,EADqB,MAQtC,MAAQ,CACNN,SAAUA,EACVgC,OAAQ,CAAE7L,KAAKqK,MAAMH,EAAYhO,GAAI8D,KAAKqK,MAAMH,EAAY/N,IAC5D2P,YAAa,CAAE9L,KAAKqK,MAAMF,EAAiBjO,GAAI8D,KAAKqK,MAAMF,EAAiBhO,KAG7E,MAAO,CACL0N,SAAUA,EACViC,YAAa,CAAE5P,EAAGC,GAClB0P,OAAQ,CAAE3P,EAAI8D,KAAKqK,MAAMlL,EAAM,GAAIhD,EAAI6D,KAAKqK,MAAMnL,EAAO,MElGlD6M,EAAb,6KAC2B5O,EAA8BwI,GAA+C,IAC5F2D,EAAwC3D,EAAxC2D,MAD2F,EACnD3D,EAAjCqG,YAAe9J,EADqE,EACrEA,KAAMtC,EAD+D,EAC/DA,MAC9BqM,EAAa,IAAI9O,EAAWqD,KAAKuL,QAAQ,CAC7C5M,MAAO+C,EAAK/C,MACZD,OAAQgD,EAAKhD,OACbhD,EAAG0D,EAAM1D,EACTC,EAAGyD,EAAMzD,IAGX,OADA8P,EAAUC,UAAYC,EAAuBF,EAAW3C,GACjD2C,IAVX,kDAawCA,EAA+BtG,GAAmC,IAC9F2D,EAAwC3D,EAAxC2D,MAD6F,EACrD3D,EAAjCqG,YAAe9J,EADuE,EACvEA,KAAMtC,EADiE,EACjEA,MAEpCqM,EAAUhN,OAAOC,OAASgD,EAAKhD,OAC/B+M,EAAUhN,OAAOE,MAAQ+C,EAAK/C,MAC9B8M,EAAUhN,OAAO/C,EAAI0D,EAAM1D,EAC3B+P,EAAUhN,OAAO9C,EAAIyD,EAAMzD,EAC3B8P,EAAUC,UAAYC,EAAuBF,EAAW3C,KApB5D,+CAuBqC8C,EAAgCC,GACjE,OAAO,2BACFA,GADL,IAEEL,YAAa,CACX9J,KAAM,CACJ/C,MAAOiN,EAAWnN,OAAOE,MACzBD,OAAQkN,EAAWnN,OAAOC,QAE5BU,MAAO,CACL1D,EAAGkQ,EAAWnN,OAAO/C,EACrBC,EAAGiQ,EAAWnN,OAAO9C,UAjC/B,GAA6BmH,GCDhB7C,EAAb,6KAC2BtD,EAA8BwI,GAA+C,IAC5F2D,EAAwC3D,EAAxC2D,MAD2F,EACnD3D,EAAjCqG,YAAe9J,EADqE,EACrEA,KAAMtC,EAD+D,EAC/DA,MAC9BqM,EAAa,IAAIzC,IAAMhJ,KAAKC,UAAU,CAC1CtB,MAAO+C,EAAK/C,MACZD,OAAQgD,EAAKhD,OACbhD,EAAG0D,EAAM1D,EACTC,EAAGyD,EAAMzD,IAIX,OADA8P,EAAUC,UAAYC,EAAuBF,EAAW3C,GACjD2C,IAXX,kDAcwCA,EAAiCtG,GAAmC,IAChG2D,EAAwC3D,EAAxC2D,MAD+F,EACvD3D,EAAjCqG,YAAe9J,EADyE,EACzEA,KAAMtC,EADmE,EACnEA,MAEpCqM,EAAUhN,OAAOC,OAASgD,EAAKhD,OAC/B+M,EAAUhN,OAAOE,MAAQ+C,EAAK/C,MAC9B8M,EAAUhN,OAAO/C,EAAI0D,EAAM1D,EAC3B+P,EAAUhN,OAAO9C,EAAIyD,EAAMzD,EAC3B8P,EAAUC,UAAYC,EAAuBF,EAAW3C,KArB5D,+CAwBqC8C,EAAkCC,GACnE,OAAO,2BACFA,GADL,IAEEL,YAAa,CACX9J,KAAM,CACJ/C,MAAOiN,EAAWnN,OAAOE,MACzBD,OAAQkN,EAAWnN,OAAOC,QAE5BU,MAAO,CACL1D,EAAGkQ,EAAWnN,OAAO/C,EACrBC,EAAGiQ,EAAWnN,OAAO9C,UAlC/B,GAA+BmH,GCAlBgJ,EAAb,6KAC2BnP,EAA8BkP,GAA4C,IACzF/C,EAAmC+C,EAAnC/C,MAAsBS,EAAasC,EAA5BL,YAAejC,OACxBwC,EAAO,IAAIpP,EAAWqD,KAU5B,OATA+L,EAAKC,QAAS,EAEdzC,EAAO/G,SAAQ,SAACyJ,GACd,IAAM7M,EAAQ,IAAIzC,EAAWuP,MAAMD,GACnCF,EAAKI,IAAI/M,MAGPO,KAAK+G,kBAAkBqF,EAAKpF,SAChCoF,EAAKL,UAAYC,EAAuBI,EAAMjD,GACvCiD,IAbX,0CAiBI,OAAO,IAjBX,kDAqBIN,EACAtG,EACAxI,GACC,IACOmM,EAAmC3D,EAAnC2D,MAAsBS,EAAapE,EAA5BqG,YAAejC,OAC9BkC,EAAUW,iBAEV7C,EAAO/G,SAAQ,SAACyJ,GACd,IAAM7M,EAAQ,IAAIzC,EAAWuP,MAAMD,GACnCR,EAAUU,IAAI/M,MAGZO,KAAK+G,kBAAkB+E,EAAU9E,SACrC8E,EAAUC,UAAYC,EAAuBF,EAAW3C,KAlC5D,+CAqCqC8C,EAAwBC,GACzD,OAAO,2BACFA,GADL,IAEEL,YAAa,CACXjC,OAAQqC,EAAWlJ,SAASqC,KAAI,SAACiB,GAAD,MAAc,CAC5CtK,EAAGsK,EAAQ5G,MAAM1D,EACjBC,EAAGqK,EAAQ5G,MAAMzD,aA3C3B,GAA6BmH,GCHhBuJ,EAAb,+KAEI,OAAO,MAFX,GAA0BP,G,qECUXQ,MAVf,SAAoBC,GAClB,IAAMC,EAAW7R,mBAMjB,OAJAG,qBAAU,WACR0R,EAAS5R,QAAU2R,IAClB,CAACA,IAEGC,EAAS5R,SCPL6R,EAA6B,CACxCxD,IAAK,IACLC,MAAO,EACPC,KAAM,EACNC,MAAO,GAGIsD,EAAmC,CAC9CnD,OAAQ,CACN,CACE9M,KAAM,EACNwM,IAAK,EACLC,MAAO,EACPC,KAAM,EACNC,MAAO,GAET,CACE3M,KAAM,IACNwM,IAAK,IACLC,MAAO,EACPC,KAAM,EACNC,MAAO,IAEXU,OAAQ,EACR/D,KAAM1L,EAAcsS,Q,oWCxBf,IAAMC,GAAmBC,KAAOC,IAAV,MAIhBC,GAAkBF,KAAOC,IAAV,MC4FbE,GAtE2BC,gBAAK,YAAuC,IAApC7H,EAAmC,EAAnCA,GAAW8H,EAAwB,EAA/BpE,MAAgBqE,EAAe,EAAfA,SAC9DC,IAAoBF,KAAsBA,EC1Bb3D,ODyBgD,EAEpC8D,mBAA2B,CACxEvE,MAAK,OAAEoE,QAAF,IAAEA,IAAWT,EAClBa,gBAAiBF,IAJgE,0BAE1EtE,EAF0E,EAE1EA,MAAOwE,EAFmE,EAEnEA,gBAAmBC,EAFgD,KAO7EC,EAASlB,EAAQlH,GAEvBtK,qBAAU,WACHoS,GACLK,EAAS,CACPzE,MAAK,OAAEoE,QAAF,IAAEA,IAAWT,EAClBa,gBAAiBF,MAElB,CAACF,EAASE,EAAiBG,IAE9B,IAAME,EAAeC,uBAAY,SAAC3E,GAChC,IAAM4E,EAAwB5E,EAAa2D,EAAkBD,EAC7DU,EAASQ,GACTJ,EAAS,CACPD,gBAAiBvE,EACjBD,MAAO6E,MAER,CAACJ,EAAUJ,IAERS,EAAgBF,sBAAY7J,KAAS,SAACiF,GAC1CyE,GAAS,SAAA5L,GAAK,kCAAUA,GAAV,IAAiBmH,aAC/BqE,EAASrE,KACR,IAAK,CAACyE,EAAUJ,IAEbU,EAAkBC,kBAAQjK,KAAS,WACvC,IAAMtB,EAA+B,GACrC,OAAKuG,GAGLvG,EADkD+K,EAAkB,WAAa,SACjF,eAAyBxE,GAClBvG,GAJYA,IAKlB,IAAK,CAACuG,EAAOwE,IAGhB,OAAME,GAAUA,IAAWpI,EAAW,KAGpC,oCACE,kBAACwH,GAAD,KACE,kBAACmB,EAAA,EAAD,CACExB,MAAOhM,OAAO+M,GACdU,WAAW,EACXb,SAAU,SAACnS,GAAD,OAAWyS,IAAezS,EAAMiT,OAAO1B,SAEjD,kBAAC2B,EAAA,EAAD,CAAU3B,MAAO,GAAjB,QACA,kBAAC2B,EAAA,EAAD,CAAU3B,MAAO,GAAjB,cAGJ,kBAACQ,GAAD,KACE,kBAAC,cAAD,eAEEoB,cAAeP,EACfT,SAAUS,EACVQ,YAAaR,EACb7E,WAAYuE,GACRO,S,8VExFP,IAAMQ,GAAmBxB,KAAOC,IAAV,MCmDdwB,GArCkB,SAAC,GAK3B,IAJLC,EAII,EAJJA,YACAC,EAGI,EAHJA,WACAC,EAEI,EAFJA,cACAC,EACI,EADJA,cACI,EACqBH,GAAe,GAAhCzF,EADJ,EACIA,MAAOxE,EADX,EACWA,MACf,OACE,kBAAC+J,GAAD,KACE,kBAACM,EAAA,EAAD,CAAKC,GAAI,CAAEC,GAAI,IACb,kBAACF,EAAA,EAAD,CAAKC,GAAI,CAAEC,GAAI,IACb,kBAACC,EAAA,EAAD,eAEF,kBAAC,GAAD,CACE1J,GAAE,OAAEmJ,QAAF,IAAEA,OAAF,EAAEA,EAAanJ,GACjB0D,MAAOA,GAAS0F,EAChBrB,SAAU,SAACrE,GAAD,OAAW2F,EAAc3F,SAGpCyF,GACD,kBAACI,EAAA,EAAD,KACE,kBAACA,EAAA,EAAD,CAAKC,GAAI,CAAEC,GAAI,IACb,kBAACF,EAAA,EAAD,CAAKC,GAAI,CAAEC,GAAI,IACb,kBAACC,EAAA,EAAD,gBAGJ,kBAAC,WAAD,CACExK,MAAOA,GAAS,KAChBoK,cAAe,SAACpK,GAAD,OAAWoK,EAAcpK,S,6DC5CpD,SAASyK,KAA2Q,OAA9PA,GAAWC,OAAOC,QAAU,SAAUhB,GAAU,IAAK,IAAIiB,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAIlN,KAAOqN,EAAcL,OAAOM,UAAUC,eAAeC,KAAKH,EAAQrN,KAAQiM,EAAOjM,GAAOqN,EAAOrN,IAAY,OAAOiM,IAA2BwB,MAAM9P,KAAMwP,WAEhT,SAASO,GAAyBL,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkErN,EAAKkN,EAAnEjB,EAEzF,SAAuCoB,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DrN,EAAKkN,EAA5DjB,EAAS,GAAQ2B,EAAaZ,OAAOa,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOlN,EAAM4N,EAAWV,GAAQS,EAASG,QAAQ9N,IAAQ,IAAaiM,EAAOjM,GAAOqN,EAAOrN,IAAQ,OAAOiM,EAFxM8B,CAA8BV,EAAQM,GAAuB,GAAIX,OAAOgB,sBAAuB,CAAE,IAAIC,EAAmBjB,OAAOgB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOlN,EAAMiO,EAAiBf,GAAQS,EAASG,QAAQ9N,IAAQ,GAAkBgN,OAAOM,UAAUY,qBAAqBV,KAAKH,EAAQrN,KAAgBiM,EAAOjM,GAAOqN,EAAOrN,IAAU,OAAOiM,EAMne,IAAI,GAAqB,IAAMkC,cAAc,OAAQ,CACnDC,EAAG,kJACHzN,OAAQ,UAGN,GAAa,SAAoB0N,GACnC,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQd,GAAyBW,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMF,cAAc,MAAOpB,GAAS,CACtDpQ,MAAO,GACPD,OAAQ,GACR+R,QAAS,YACT7N,KAAM,OACN8N,IAAKJ,GACJE,GAAQD,EAAqB,IAAMJ,cAAc,QAAS,KAAMI,GAAS,KAAM,KAGhFI,GAA0B,IAAMC,YAAW,SAAUJ,EAAOE,GAC9D,OAAoB,IAAMP,cAAc,GAAYpB,GAAS,CAC3DuB,OAAQI,GACPF,OAEU,IChCf,SAAS,KAA2Q,OAA9P,GAAWxB,OAAOC,QAAU,SAAUhB,GAAU,IAAK,IAAIiB,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAIlN,KAAOqN,EAAcL,OAAOM,UAAUC,eAAeC,KAAKH,EAAQrN,KAAQiM,EAAOjM,GAAOqN,EAAOrN,IAAY,OAAOiM,IAA2BwB,MAAM9P,KAAMwP,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkErN,EAAKkN,EAAnEjB,EAEzF,SAAuCoB,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DrN,EAAKkN,EAA5DjB,EAAS,GAAQ2B,EAAaZ,OAAOa,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOlN,EAAM4N,EAAWV,GAAQS,EAASG,QAAQ9N,IAAQ,IAAaiM,EAAOjM,GAAOqN,EAAOrN,IAAQ,OAAOiM,EAFxM,CAA8BoB,EAAQM,GAAuB,GAAIX,OAAOgB,sBAAuB,CAAE,IAAIC,EAAmBjB,OAAOgB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOlN,EAAMiO,EAAiBf,GAAQS,EAASG,QAAQ9N,IAAQ,GAAkBgN,OAAOM,UAAUY,qBAAqBV,KAAKH,EAAQrN,KAAgBiM,EAAOjM,GAAOqN,EAAOrN,IAAU,OAAOiM,EAMne,IAAI,GAAqB,IAAMkC,cAAc,OAAQ,CACnDC,EAAG,uLACHzN,OAAQ,UAGN,GAAa,SAAoB0N,GACnC,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMF,cAAc,MAAO,GAAS,CACtDxR,MAAO,GACPD,OAAQ,GACR+R,QAAS,YACT7N,KAAM,OACN8N,IAAKJ,GACJE,GAAQD,EAAqB,IAAMJ,cAAc,QAAS,KAAMI,GAAS,KAAM,KAGhF,GAA0B,IAAMK,YAAW,SAAUJ,EAAOE,GAC9D,OAAoB,IAAMP,cAAc,GAAY,GAAS,CAC3DG,OAAQI,GACPF,OAEU,IChCf,SAAS,KAA2Q,OAA9P,GAAWxB,OAAOC,QAAU,SAAUhB,GAAU,IAAK,IAAIiB,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAIlN,KAAOqN,EAAcL,OAAOM,UAAUC,eAAeC,KAAKH,EAAQrN,KAAQiM,EAAOjM,GAAOqN,EAAOrN,IAAY,OAAOiM,IAA2BwB,MAAM9P,KAAMwP,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkErN,EAAKkN,EAAnEjB,EAEzF,SAAuCoB,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DrN,EAAKkN,EAA5DjB,EAAS,GAAQ2B,EAAaZ,OAAOa,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOlN,EAAM4N,EAAWV,GAAQS,EAASG,QAAQ9N,IAAQ,IAAaiM,EAAOjM,GAAOqN,EAAOrN,IAAQ,OAAOiM,EAFxM,CAA8BoB,EAAQM,GAAuB,GAAIX,OAAOgB,sBAAuB,CAAE,IAAIC,EAAmBjB,OAAOgB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOlN,EAAMiO,EAAiBf,GAAQS,EAASG,QAAQ9N,IAAQ,GAAkBgN,OAAOM,UAAUY,qBAAqBV,KAAKH,EAAQrN,KAAgBiM,EAAOjM,GAAOqN,EAAOrN,IAAU,OAAOiM,EAMne,IAAI,GAAqB,IAAMkC,cAAc,OAAQ,CACnDzU,EAAG,GACHC,EAAG,GACHgD,MAAO,GACPD,OAAQ,GACRiE,OAAQ,UAGN,GAAe,SAAsB0N,GACvC,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMF,cAAc,MAAO,GAAS,CACtDxR,MAAO,GACPD,OAAQ,GACR+R,QAAS,YACT7N,KAAM,OACN8N,IAAKJ,GACJE,GAAQD,EAAqB,IAAMJ,cAAc,QAAS,KAAMI,GAAS,KAAM,KAGhF,GAA0B,IAAMK,YAAW,SAAUJ,EAAOE,GAC9D,OAAoB,IAAMP,cAAc,GAAc,GAAS,CAC7DG,OAAQI,GACPF,OAEU,ICnCf,SAAS,KAA2Q,OAA9P,GAAWxB,OAAOC,QAAU,SAAUhB,GAAU,IAAK,IAAIiB,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAIlN,KAAOqN,EAAcL,OAAOM,UAAUC,eAAeC,KAAKH,EAAQrN,KAAQiM,EAAOjM,GAAOqN,EAAOrN,IAAY,OAAOiM,IAA2BwB,MAAM9P,KAAMwP,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkErN,EAAKkN,EAAnEjB,EAEzF,SAAuCoB,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DrN,EAAKkN,EAA5DjB,EAAS,GAAQ2B,EAAaZ,OAAOa,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOlN,EAAM4N,EAAWV,GAAQS,EAASG,QAAQ9N,IAAQ,IAAaiM,EAAOjM,GAAOqN,EAAOrN,IAAQ,OAAOiM,EAFxM,CAA8BoB,EAAQM,GAAuB,GAAIX,OAAOgB,sBAAuB,CAAE,IAAIC,EAAmBjB,OAAOgB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOlN,EAAMiO,EAAiBf,GAAQS,EAASG,QAAQ9N,IAAQ,GAAkBgN,OAAOM,UAAUY,qBAAqBV,KAAKH,EAAQrN,KAAgBiM,EAAOjM,GAAOqN,EAAOrN,IAAU,OAAOiM,EAMne,IAAI,GAAqB,IAAMkC,cAAc,OAAQ,CACnDC,EAAG,6nBACHzN,OAAQ,UAGN,GAAU,SAAiB0N,GAC7B,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMF,cAAc,MAAO,GAAS,CACtDxR,MAAO,GACPD,OAAQ,GACR+R,QAAS,YACT7N,KAAM,OACN8N,IAAKJ,GACJE,GAAQD,EAAqB,IAAMJ,cAAc,QAAS,KAAMI,GAAS,KAAM,KAGhF,GAA0B,IAAMK,YAAW,SAAUJ,EAAOE,GAC9D,OAAoB,IAAMP,cAAc,GAAS,GAAS,CACxDG,OAAQI,GACPF,OAEU,IChCf,SAAS,KAA2Q,OAA9P,GAAWxB,OAAOC,QAAU,SAAUhB,GAAU,IAAK,IAAIiB,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAIlN,KAAOqN,EAAcL,OAAOM,UAAUC,eAAeC,KAAKH,EAAQrN,KAAQiM,EAAOjM,GAAOqN,EAAOrN,IAAY,OAAOiM,IAA2BwB,MAAM9P,KAAMwP,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkErN,EAAKkN,EAAnEjB,EAEzF,SAAuCoB,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DrN,EAAKkN,EAA5DjB,EAAS,GAAQ2B,EAAaZ,OAAOa,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOlN,EAAM4N,EAAWV,GAAQS,EAASG,QAAQ9N,IAAQ,IAAaiM,EAAOjM,GAAOqN,EAAOrN,IAAQ,OAAOiM,EAFxM,CAA8BoB,EAAQM,GAAuB,GAAIX,OAAOgB,sBAAuB,CAAE,IAAIC,EAAmBjB,OAAOgB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOlN,EAAMiO,EAAiBf,GAAQS,EAASG,QAAQ9N,IAAQ,GAAkBgN,OAAOM,UAAUY,qBAAqBV,KAAKH,EAAQrN,KAAgBiM,EAAOjM,GAAOqN,EAAOrN,IAAU,OAAOiM,EAMne,IAAI,GAAqB,IAAMkC,cAAc,OAAQ,CACnDU,SAAU,UACVC,SAAU,UACVV,EAAG,gnBACHxN,KAAM,UAGJ,GAAU,SAAiByN,GAC7B,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMF,cAAc,MAAO,GAAS,CACtDxR,MAAO,GACPD,OAAQ,GACR+R,QAAS,YACT7N,KAAM,OACN8N,IAAKJ,GACJE,GAAQD,EAAqB,IAAMJ,cAAc,QAAS,KAAMI,GAAS,KAAM,KAGhF,GAA0B,IAAMK,YAAW,SAAUJ,EAAOE,GAC9D,OAAoB,IAAMP,cAAc,GAAS,GAAS,CACxDG,OAAQI,GACPF,OAEU,IClCf,SAAS,KAA2Q,OAA9P,GAAWxB,OAAOC,QAAU,SAAUhB,GAAU,IAAK,IAAIiB,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAIlN,KAAOqN,EAAcL,OAAOM,UAAUC,eAAeC,KAAKH,EAAQrN,KAAQiM,EAAOjM,GAAOqN,EAAOrN,IAAY,OAAOiM,IAA2BwB,MAAM9P,KAAMwP,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkErN,EAAKkN,EAAnEjB,EAEzF,SAAuCoB,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DrN,EAAKkN,EAA5DjB,EAAS,GAAQ2B,EAAaZ,OAAOa,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOlN,EAAM4N,EAAWV,GAAQS,EAASG,QAAQ9N,IAAQ,IAAaiM,EAAOjM,GAAOqN,EAAOrN,IAAQ,OAAOiM,EAFxM,CAA8BoB,EAAQM,GAAuB,GAAIX,OAAOgB,sBAAuB,CAAE,IAAIC,EAAmBjB,OAAOgB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOlN,EAAMiO,EAAiBf,GAAQS,EAASG,QAAQ9N,IAAQ,GAAkBgN,OAAOM,UAAUY,qBAAqBV,KAAKH,EAAQrN,KAAgBiM,EAAOjM,GAAOqN,EAAOrN,IAAU,OAAOiM,EAMne,IAAI,GAAqB,IAAMkC,cAAc,OAAQ,CACnDU,SAAU,UACVC,SAAU,UACVV,EAAG,iqEACHxN,KAAM,UAGJ,GAAqB,IAAMuN,cAAc,OAAQ,CACnDU,SAAU,UACVC,SAAU,UACVV,EAAG,6dACHxN,KAAM,UAGJ,GAAY,SAAmByN,GACjC,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMF,cAAc,MAAO,GAAS,CACtDxR,MAAO,GACPD,OAAQ,GACR+R,QAAS,YACT7N,KAAM,OACN8N,IAAKJ,GACJE,GAAQD,EAAqB,IAAMJ,cAAc,QAAS,KAAMI,GAAS,KAAM,GAAO,KAGvF,GAA0B,IAAMK,YAAW,SAAUJ,EAAOE,GAC9D,OAAoB,IAAMP,cAAc,GAAW,GAAS,CAC1DG,OAAQI,GACPF,OAEU,ICzCf,SAAS,KAA2Q,OAA9P,GAAWxB,OAAOC,QAAU,SAAUhB,GAAU,IAAK,IAAIiB,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAIlN,KAAOqN,EAAcL,OAAOM,UAAUC,eAAeC,KAAKH,EAAQrN,KAAQiM,EAAOjM,GAAOqN,EAAOrN,IAAY,OAAOiM,IAA2BwB,MAAM9P,KAAMwP,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkErN,EAAKkN,EAAnEjB,EAEzF,SAAuCoB,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DrN,EAAKkN,EAA5DjB,EAAS,GAAQ2B,EAAaZ,OAAOa,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOlN,EAAM4N,EAAWV,GAAQS,EAASG,QAAQ9N,IAAQ,IAAaiM,EAAOjM,GAAOqN,EAAOrN,IAAQ,OAAOiM,EAFxM,CAA8BoB,EAAQM,GAAuB,GAAIX,OAAOgB,sBAAuB,CAAE,IAAIC,EAAmBjB,OAAOgB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOlN,EAAMiO,EAAiBf,GAAQS,EAASG,QAAQ9N,IAAQ,GAAkBgN,OAAOM,UAAUY,qBAAqBV,KAAKH,EAAQrN,KAAgBiM,EAAOjM,GAAOqN,EAAOrN,IAAU,OAAOiM,EAMne,IAAI,GAAqB,IAAMkC,cAAc,OAAQ,KAAmB,IAAMA,cAAc,QAAS,KAAM,oDAEvG,GAAqB,IAAMA,cAAc,UAAW,CACtDY,UAAW,QACXxH,OAAQ,kDAGN,GAAU,SAAiB8G,GAC7B,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMF,cAAc,MAAO,GAAS,CACtD/K,GAAI,UACJqL,QAAS,kBACTC,IAAKJ,GACJE,GAAQD,EAAqB,IAAMJ,cAAc,QAAS,KAAMI,GAAS,KAAM,GAAO,KAGvF,GAA0B,IAAMK,YAAW,SAAUJ,EAAOE,GAC9D,OAAoB,IAAMP,cAAc,GAAS,GAAS,CACxDG,OAAQI,GACPF,OAEU,I,k5BCHf,IAAMQ,GAAmBnE,aAAOoE,KAAPpE,CAAH,MAgBhBqE,GAAmBrE,aAAOoE,KAAPpE,CAAH,MAYhBsE,GAAwBtE,KAAOC,IAAV,MAarBsE,GAA2BvE,KAAOC,IAAV,MAEjB,qBAAGuE,oBAAgD,MAAQ,UACrD,qBAAGC,gBAAwC,OAAS,OA8DxDC,GAxDmC,SAAC,GAQ5C,IAPLhD,EAOI,EAPJA,YACAiD,EAMI,EANJA,WACAC,EAKI,EALJA,aACAC,EAII,EAJJA,aACAC,EAGI,EAHJA,kBACAC,EAEI,EAFJA,gBACAC,EACI,EADJA,YAEA,OACE,kBAACV,GAAD,OACK5C,GACD,kBAAC2C,GAAD,CAAkBvN,QAAS,kBAAM+N,EAAanD,KAC5C,kBAAC,KAAD,OAGJ,kBAAC6C,GAAD,CAA0BE,iBAAe,GACvC,kBAACN,GAAD,CAAkBrN,QAAS,kBAAM8N,EAAanX,EAAgBsC,aAC5D,kBAACkV,GAAA,EAAD,CAASC,UAAWC,GAAcvB,QAAQ,YAAYjS,MAAO,CAAEyT,QAAS,MAAOC,UAAW,iBAE5F,kBAAClB,GAAD,CAAkBrN,QAAS,kBAAM8N,EAAanX,EAAgB6X,WAC5D,kBAACL,GAAA,EAAD,CAASC,UAAWK,GAAY3B,QAAQ,eAE1C,kBAACO,GAAD,CAAkBrN,QAAS,kBAAM8N,EAAanX,EAAgB+X,QAC5D,kBAACP,GAAA,EAAD,CAASC,UAAWO,GAAS7B,QAAQ,eAEvC,kBAACO,GAAD,CAAkBrN,QAAS,kBAAM8N,EAAanX,EAAgBiY,WAC5D,kBAACT,GAAA,EAAD,CAASC,UAAWS,GAAY/B,QAAQ,gBAG5C,kBAACW,GAAD,CAA0BE,iBAAe,GACvC,kBAACN,GAAD,CAAkBrN,QAAS,kBAAMgO,MAC/B,kBAACG,GAAA,EAAD,CACEC,UAAWU,GACXhC,QAAQ,YACRjS,MAAO,CACLoE,KAAM,cACNqP,QAAS,MACTC,UAAW,iBAIjB,kBAAClB,GAAD,CAAkBrN,QAAS,kBAAMiO,MAC/B,kBAACE,GAAA,EAAD,CAASC,UAAWW,GAAWjC,QAAQ,YAAYjS,MAAO,CAAEoE,KAAM,mBAGtE,kBAACwO,GAAD,CAA0BC,qBAAmB,GAC3C,kBAACJ,GAAA,EAAD,CAAYtN,QAAS,kBAAMkO,GAAaL,MACpCA,GAAe,kBAACM,GAAA,EAAD,CAASC,UAAWY,GAASlC,QAAQ,oBACrDe,GAAe,kBAAC,KAAD,CAAUhT,MAAO,CAAEsK,MAAO,cCvHrC8J,GAPK,iBAAqB,CACvCxJ,MAAO,EACPH,IAAKzJ,KAAKqK,MAAM,IAAMrK,KAAKqT,UAC3B3J,MAAO1J,KAAKqK,MAAM,IAAMrK,KAAKqT,UAC7B1J,KAAM3J,KAAKqK,MAAM,IAAMrK,KAAKqT,YCOxBC,GAAqB,CACzBpX,EAAG,IACHC,EAAG,KAGCoX,GAAmB,CACvBpU,MAAO,IACPD,OAAQ,KAIJsU,GAAkBnO,IAASoO,QAAQjR,IClB1BkR,GAJiB,SAACnN,GAC/B,MAAO,CAACzL,EAAgB6X,QAAS7X,EAAgBsC,WAAWoE,SAAS+E,ICoBxDoN,GAlBmB,SAACC,GACjC,IAAMC,EAAkB,IAAID,EAAMrT,MAAM,IAAK,IAAK,IAAK,GADM,EAEZqT,EAAM7N,KAAK9G,OACtD6U,EAAkB,CAAE3U,MAHmC,EAErDA,MACoCD,OAHiB,EAEnCA,QAI1B,OAAQ,IAAIuB,EAAUmT,EAAO,CAC3BhO,GAT4B,OAU5BW,KAAMzL,EAAgBsC,UACtBkM,MAAOuK,EACP/O,MAAO,KACPkH,YAAa,CACXpM,MARsB,CAAE1D,EAAG,EAAGC,EAAG,GASjC+F,KAAM4R,M,8PChBL,IAAMC,GAAY1G,KAAOC,IAAV,MAOCD,KAAOC,IAAV,M,oLCPb,IAAM0G,GAAkB3G,KAAOC,IAAV,M,0ICKrB,IAAM2G,GAAU5G,KAAOC,IAAV,MAcLG,mBARiB,SAAC,GAAmB,IAAjByG,EAAgB,EAAhBA,UACjC,OACE,kBAAC,GAAD,KACE,4BAAQhD,IAAKgD,Q,UCmTJC,GA9QiB,SAAC,GAW1B,IAVLpD,EAUI,EAVJA,MACAqD,EASI,EATJA,UACAP,EAQI,EARJA,gBACA7B,EAOI,EAPJA,WACAqC,EAMI,EANJA,gBACAC,EAKI,EALJA,sBACAC,EAII,EAJJA,YACAnC,EAGI,EAHJA,gBACAD,EAEI,EAFJA,kBACAE,EACI,EADJA,YACI,EACsCxE,mBAAwB,MAD9D,mBACG2G,EADH,KACkBC,EADlB,KAEEC,EAAgBvZ,iBAA+B,MAC/CwZ,EAAexZ,iBAA0B,IAC/CwZ,EAAavZ,QAAUgZ,EACvB,IAAMrF,EAAcT,mBAAgC,WAElD,OADc8F,EAAUQ,MAAK,SAAAvI,GAAK,OAAIA,EAAMzG,KAAO4O,MACnC,OACf,CAACA,EAAeJ,IAGbS,EAAe1Z,iBAAuB,MACtC+Y,EAAY/Y,iBAA0B,MACtC2Z,EAAc3Z,iBAAyB,IACvC4Z,EAAgB5Z,iBAAyB,MACzC6Z,EAAW7Z,mBAEX8Z,EAAgB9Z,iBAAyB,MAEzC+Z,EAAkBhH,uBAAY,SAACiH,GACnC,IAAMC,EAAkBT,EAAavZ,QAC/Bia,EAAmBD,EAAgBE,WAAU,SAACjJ,GAAD,OAAWA,EAAMzG,KAAOuP,EAAYvP,OAC7D,IAAtByP,GACJhB,EAAgB,GAAD,mBACVe,EAAgBG,MAAM,EAAGF,IADf,CAEbF,GAFa,YAGVC,EAAgBG,MAAMF,EAAmB,QAG7C,CAAChB,IAEEmB,EAAqBtH,uBAAY,WACrC,IAAMuH,EAAYZ,EAAazZ,QACzB4T,EAAa+F,EAAc3Z,QAC3BwY,EAAQoB,EAAS5Z,QAEvB,GAAKqa,GAAczG,GAAe4E,EAAlC,CAL2C,IAMtBzU,EAAgCsW,EAA7CC,YAAkCxW,EAAWuW,EAAzBE,aAE5B/B,EAAM7N,KAAK+N,SAAS3U,MAAQA,EAC5ByU,EAAM7N,KAAK+N,SAAS5U,OAASA,EAE7B8P,EAAW4G,oBAAX,2BACK5G,EAAWrJ,WADhB,IAEEqG,YAAY,2BACPgD,EAAWrJ,UAAUqG,aADf,IAET9J,KAAM,CAAE/C,QAAOD,eAGnB0U,EAAM7N,KAAK8P,YACV,IAEHva,qBAAU,WACR,IAAK4Y,EAAU9Y,QAAS,MAAM,IAAI0a,MAAM,mCACxC,IAAMlC,EAAQ,IAAIpK,IAAMuM,WACxBnC,EAAMoC,MAAM9B,EAAU9Y,SACtB4Z,EAAS5Z,QAAUwY,EAEnB,IAAM5E,EAAa2E,GAA0BC,GAC7C5E,EAAWtL,WAAY,EACvBqR,EAAc3Z,QAAU4T,EACxB,IAAMD,EACK,KAGLkH,EAAoB,SAACtQ,GACzB,IAAMyP,EAAkBT,EAAavZ,QAC/Bia,EAAmBD,EAAgBE,WAAU,SAACjJ,GAAD,OAAWA,EAAMzG,KAAOD,EAAUC,OAC3D,IAAtByP,GACJhB,EAAgB,GAAD,mBACVe,EAAgBG,MAAM,EAAGF,IADf,CAEb1P,GAFa,YAGVyP,EAAgBG,MAAMF,EAAmB,OAI1Ca,EAAqB,SAACvQ,GAAgC,IAAD,IACzD,GAAIA,EAAUC,MAAV,UAAiBmP,EAAc3Z,eAA/B,aAAiB,EAAuBwK,IAA5C,CAKA,IAAMwP,EAAkBT,EAAavZ,QAC/Bia,EAAmBD,EAAgBE,WAAU,SAACjJ,GAAD,OAAWA,EAAMzG,KAAOD,EAAUC,OAC3D,IAAtByP,IACJhB,EAAgB,GAAD,mBACVe,EAAgBG,MAAM,EAAGF,IADf,YAEVD,EAAgBG,MAAMF,EAAmB,IAF/B,CAGb1P,MAGE,UAAAoJ,SAAA,eAAqBnJ,MAAOD,EAAUC,IACxC6O,EAAiB9O,EAAUC,UAd3B6O,EAAiB,OAkBf0B,EAAoB,WAAO,IAAD,EAC9B,UAAAlB,EAAc7Z,eAAd,SAAuBgb,SAGnBC,EAAmBxB,EAAazZ,QAMtC,OALAmD,OAAOzC,iBAAiB,SAAU0Z,GAClB,OAAhBa,QAAgB,IAAhBA,KAAkBva,iBAAiB,QAASqa,GAE5C7S,EAAemB,QAAQlC,GAAG,QAAS2T,GACnC5S,EAAemB,QAAQlC,GAAG,SAAU0T,GAC7B,WACL1X,OAAOxC,oBAAoB,SAAUyZ,GACrB,OAAhBa,QAAgB,IAAhBA,KAAkBta,oBAAoB,QAASoa,GAE/C7S,EAAemB,QAAQ9B,IAAI,QAASuT,GACpC5S,EAAemB,QAAQlC,GAAG,SAAU0T,MAErC,CAACxB,EAAkBJ,EAAiBmB,IAEvCla,qBAAU,WACR,IAAK0Z,EAAS5Z,QAAS,MAAM,IAAI0a,MAAM,0BACvC,IAAMQ,EAvIa,SAAClC,GACtB,OAAOA,EAAUmC,QAAiB,SAAChR,EAAK8G,GAAN,mBAAC,eAC9B9G,GAD6B,kBAE/B8G,EAAMzG,GAAKyG,MACV,IAmIemK,CAAe1B,EAAY1Z,SACtCwY,EAAQoB,EAAS5Z,QACvB0Z,EAAY1Z,QAAU,GACtBgZ,EAAUpR,SAAQ,SAAA2C,GAChB,IAAI0G,EAAQiK,EAAS3Q,EAAUC,IAC3ByG,GACFA,EAAMuJ,oBAAoBjQ,UACnB2Q,EAAS3Q,EAAUC,KAE1ByG,EA7JY,SAACuH,EAAyBjO,GAC5C,OAAQA,EAAUY,MAChB,KAAKzL,EAAgBsC,UACnB,OAAO,IAAIqD,EAAUmT,EAAOjO,GAC9B,KAAK7K,EAAgB6X,QACnB,OAAO,IAAI5G,EAAQ6H,EAAOjO,GAC5B,KAAK7K,EAAgBiY,QACnB,OAAO,IAAIzG,EAAQsH,EAAOjO,GAC5B,KAAK7K,EAAgB+X,KACnB,OAAO,IAAIhG,EAAK+G,EAAOjO,IAoJb8Q,CAAY7C,EAAOjO,GAE7BmP,EAAY1Z,QAAQsb,KAAKrK,GACzBA,EAAMhL,kBAMRmO,OAAOmH,OAAOL,GAAUtT,SAAQ,SAACqJ,GAC/BA,EAAM/K,cAEP,CAAC8S,IAEJ9Y,qBAAU,WACR,GAAKyT,EAAL,CACA,IAAM1C,EAAQyI,EAAY1Z,QAAQwZ,MAAK,SAAAvI,GAAK,OAAIA,EAAMzG,KAAOmJ,EAAYnJ,MACpEyG,IACLyI,EAAY1Z,QAAQ4H,SAAQ,SAAAqJ,GAAK,OAAIA,EAAMxG,UAAW,KACtDwG,EAAMxG,UAAW,MAChB,CAACkJ,IAEJzT,qBAAU,WACR,IAAM0T,EAAa+F,EAAc3Z,QAC5B4T,GACLA,EAAW4G,oBAAX,2BACK5G,EAAWrJ,WADhB,IAEE2D,MAAOuK,OAER,CAACA,IAEJvY,qBAAU,WACRwZ,EAAY1Z,QAAQ4H,SAAQ,SAAAqJ,GAAK,OAAIA,EAAM2F,WAAaA,KACxDwD,IACAf,EAAiB,QAChB,CAACzC,EAAYyC,EAAkBe,IAGlC,IAAM/Z,EAAayS,uBAAY,WACxBa,IACL2F,EAActZ,QAAd,eAA6B2T,MAC5B,CAACA,IAEErT,EAAawS,uBAAY,WAC7B,GAAKwG,EAActZ,QAAnB,CACA,IAAMwb,EAAiC,2BAClClC,EAActZ,SADoB,IAErCwK,GAAIiR,gBAGNpC,EAAiBmC,EAAiBhR,IAClCyO,EAAgB,GAAD,mBACVM,EAAavZ,SADH,CAEbwb,QAID,CAACvC,EAAiBI,IAErB1Z,EAAYU,EAAYC,GAGxB,IAAMob,EAAmB5I,uBAAY,SAAC3H,GACpC,INnOmCwQ,EMmO7BC,EAAatD,GAAwBnN,INnORwQ,EMmOuCxQ,ENnO2B,CACvGX,GAAIiR,cACJtQ,KAAMwQ,EACNjS,MAAO,CACLC,gBAAiByO,GACjBxO,cAAe,IAEjBsE,MAAO8J,KACPpH,YAAa,CACXpM,MAAM,eAAM0T,IACZpR,KAAK,eAAMqR,OAKwB,SAACwD,GAQtC,IAPA,IAAME,EAAW,eAAQ3D,IAInB4D,EAAY,IAAI1N,IAAMkD,MAAMuK,GAC5BE,EAAqB,GAElBzH,EAAI,EAAGA,EA1BqB,GA0BeA,IAAK,CACvD,IAAM0H,EAAQ,IAAI5N,IAAMkD,MAAM,CAC5BkD,OAAS,GAAwB,IAAhB5P,KAAKqT,SACtB7I,MAAQ,GAAwCkF,IAHK,EAMtCwH,EAAUG,SAASD,GAA5Blb,EAN+C,EAM/CA,EAAGC,EAN4C,EAM5CA,EAGLmb,EAASpb,EAAI8D,KAAKkL,MAAqB,IAAfoI,GAAWpX,GACnCqb,EAASpb,EAAI6D,KAAKkL,MAAqB,IAAfoI,GAAWnX,GAEzCgb,EAAST,KAAK,CAAExa,EAAGob,EAAQnb,EAAGob,IAGhC,MAAO,CACL3R,GAAIiR,cACJtQ,KAAMwQ,EACNjS,MAAO,CACLC,gBAAiByO,GACjBxO,cAAe,IAEjBsE,MAAO8J,KACPpH,YAAa,CACXjC,OAAQoN,IMoLwEK,CAAwBjR,GAC1G8N,EAAgB,GAAD,mBACVD,GADU,CAEb4C,OAED,CAAC5C,EAAWC,IAEToD,EAAmBvJ,uBAAY,SAAC7B,GACpC,IAAMrF,EAAQoN,EAAUkB,WAAU,SAAAhP,GAAI,OAAIA,EAAKV,KAAOyG,EAAMzG,OAC7C,IAAXoB,GAEJqN,EAAgB,GAAD,mBACVD,EAAUmB,MAAM,EAAGvO,IADT,YAEVoN,EAAUmB,MAAMvO,EAAQ,QAE5B,CAACoN,EAAWC,IAETqD,EAAoBxJ,uBAAY,SAAC5E,GACjCyF,EACFmG,EAAgB,2BAAMnG,GAAP,IAAoBzF,WAEnCgL,EAAsBhL,KAEvB,CACDyF,EACAuF,EACAY,IAGIyC,EAAoBzJ,uBAAY,SAACpJ,GAChCiK,GACLmG,EAAgB,2BAAMnG,GAAP,IAAoBjK,aAClC,CAACiK,EAAamG,IAGjB,OACE,oCACE,kBAACnB,GAAD,CAAW7C,IAAK2D,GACd,kBAACb,GAAD,KACE,kBAAC4D,GAAA,EAAD,CACE7K,MAAOgE,EACPG,IAAK+D,EACL4C,YAAY,QACZrJ,WAAS,EACTb,SAAU,SAAAnS,GAAK,OAAI+Y,EAAY/Y,EAAMiT,OAAO1B,WAGhD,kBAAC,GAAD,CACEgC,YAAaA,EACbiD,WAAYA,EACZC,aAAc6E,EACd5E,aAAcuF,EACdtF,kBAAmBA,EACnBC,gBAAiBA,EACjBC,YAAaA,IAEf,kBAAC,GAAD,CAAQ6B,UAAWA,KACjBlC,GACA,kBAAC,GAAD,CACEjD,YAAaA,EACbC,WAAY6E,EACZ5E,cAAeyI,EACfxI,cAAeyI,O,kGCnTdG,GAAS,SAAeC,GACnC,IAAMC,EAAWC,aAAWF,GAC5B,OAAOG,kBAAUF,I,8MCJZ,IAAMG,GAAoB9K,KAAOC,IAAV,MAGd,qBAAGzH,SAA0B,SAAW,WCO3CuS,GAAW,SAAC,GAAyC,IAAvCC,EAAsC,EAAtCA,SAAUC,EAA4B,EAA5BA,OAC7BC,EAASrK,uBAAY,SAACsK,GAC1B,IAbcC,EAaRC,EAAYF,EAAc,IAblBC,EAcLC,EAdoB,IAAIC,SAAqC,SAAAC,GACxE,IAAMC,EAAS,IAAIC,WACnBD,EAAO/c,iBAAiB,WAAW,kBAAM8c,EAAQC,EAAOE,WACxDF,EAAOG,kBAAkBP,OAWHQ,MAAK,SAACC,GACxBb,EAASa,QAEV,CAACb,IAN2D,EAQXc,aAAY,CAC9DC,UAAU,EACVb,SACAD,OAAM,OAAEA,QAAF,IAAEA,SAAUe,IAHbC,EARwD,EAQxDA,aAAcC,EAR0C,EAQ1CA,cAAeC,EAR2B,EAQ3BA,aAMpC,OACE,kBAACrB,GAAD,iBACMmB,IADN,CAEEzT,SAAU2T,IAEV,0BAAWD,KAETC,EACE,kBAACC,GAAA,EAAD,gCACA,kBAACA,GAAA,EAAD,gE,gxBClBV,IAAMC,GAAiBrM,KAAOC,IAAV,MAYdqM,GAAwBtM,aAAOuM,KAAPvM,CAAH,MAKrBwM,GAAyBxM,aAAOyM,KAAPzM,CAAH,MAMtB0M,GAAe1M,aAAO2M,KAAP3M,CAAH,MAeL4M,GAAoC,SAAC,GAAoD,IAAlDC,EAAiD,EAAjDA,OAAQC,EAAyC,EAAzCA,iBAAkBC,EAAuB,EAAvBA,iBAAuB,EAC/DvM,mBAAqB,QAD0C,mBAC5FwM,EAD4F,KAChFC,EADgF,OAE/DzM,mBAAiB,IAF8C,mBAE5F0M,EAF4F,KAEhFC,EAFgF,KAI7FC,EAAmBvM,uBAAY,SAACwM,GACpC,IAAMC,EAAa7C,GAAmB4C,GACtCP,EAAiBQ,KAChB,CAACR,IAEES,EAAqB1M,uBAAY,WACrC,IAAMyM,EAAa7C,GAAmByC,GACtCJ,EAAiBQ,KAChB,CAACJ,EAAYJ,IAEVU,EAAyB3M,uBAAY,SAAC3H,GAC1C+T,EAAc/T,KACb,CAAC+T,IAEJ,OACE,kBAACQ,GAAA,EAAD,CACEC,KAAMb,EACNc,QAASZ,GAET,kBAACV,GAAD,KACE,kBAACvK,EAAA,EAAD,CAAKC,GAAI,CAAE6L,EAAG,IACZ,kBAACC,GAAA,EAAD,CAAa3I,UAAU,YACrB,kBAAC4I,GAAA,EAAD,CAAW5I,UAAU,UAArB,KACA,kBAAC6I,GAAA,EAAD,CACEC,KAAK,aACLtO,MAAOsN,EACPiB,KAAG,EACH3N,SAAW,SAAC4N,EAAGxO,GAAJ,OAAc8N,EAAuB9N,KAEhD,kBAAC8M,GAAD,CAAwB9M,MAAM,OAAOyO,QAAS,kBAACC,GAAA,EAAD,MAAWC,MAAM,qBAC/D,kBAAC7B,GAAD,CAAwB9M,MAAM,aAAayO,QAAS,kBAACC,GAAA,EAAD,MAAWC,MAAM,gCAI1D,SAAfrB,GACA,yBAAKrb,MAAO,CAAE2c,OAAQ,WACpB,kBAAC,GAAD,CACEtD,SAAUoC,EACVnC,OAAO,WAII,eAAf+B,GACA,oCACE,kBAAClL,EAAA,EAAD,CAAKC,GAAI,CAAE6L,EAAG,IACZ,kBAACtB,GAAD,CACE+B,MAAM,gCACNE,WAAS,EACTC,KAAM,EACNhE,YAAY,QACZ9K,MAAOwN,EACP5M,SAAU,SAACmO,GAAD,OAAQtB,EAAcsB,EAAGrN,OAAO1B,WAG9C,yBAAK/N,MAAO,CAAE2c,OAAQ,WACpB,kBAAC5B,GAAD,CACEgC,QAAQ,YACRvN,WAAS,EACTwN,SAAUzB,EAAW3K,QAAU,EAC/BzL,QAASyW,GAJX,eCvGCqB,GAdE,SAACxD,EAAYyD,GAC5B,IAAMC,EAAItgB,SAAS8U,cAAc,KACjCwL,EAAEC,SAAWF,EACb,IAAMG,EAAMC,IAAIC,gBAAgB9D,GAChC0D,EAAEK,KAAOH,EAETxgB,SAASkD,KAAK0d,YAAYN,GAC1BA,EAAEO,QACFC,YAAW,WACT9gB,SAASkD,KAAK6d,YAAYT,GAC1B5d,OAAO+d,IAAIO,gBAAgBR,KAC1B,I,ghBCKL,IAAM3C,GAAiBrM,KAAOC,IAAV,MAYPyM,GAAe1M,aAAO2M,KAAP3M,CAAH,MAaZyP,GAAoC,SAAC,GAI3C,IAHL5C,EAGI,EAHJA,OACAS,EAEI,EAFJA,WACAoC,EACI,EADJA,mBAEMxC,EAAajM,mBAAQ,kBL3CP,SAAevL,GACnC,IAAMiV,EAAWgF,gBAAKja,GACtB,OAAOka,aAAejF,GAAU,GKyCCkF,CAAoBvC,KAAa,CAACA,IAC7DwC,EAAiBjP,uBAAY,WACjC,IAAMuK,EAAO,IAAI5L,KAAK,CAAC0N,GAAa,CAAEhU,KAAM,qBAC1C0V,GAASxD,EAAD,UAAUkC,EAAW5J,MAArB,YACT,CAACwJ,EAAYI,IAMhB,OACE,kBAACG,GAAA,EAAD,CAAOC,KAAMb,EAAQc,QAAS+B,GAC5B,kBAAC,GAAD,KACE,kBAAC5N,EAAA,EAAD,CAAKC,GAAI,CAAEC,GAAI,IACb,kBAACuK,GAAA,EAAD,CACE8B,MAAM,kDACNE,WAAS,EACTC,KAAM,GACN9O,MAAOwN,EACP/L,WAAS,KAab,kBAAC,GAAD,CACEuN,QAAQ,YACRvN,WAAS,EACTwN,SAAUzB,EAAW3K,QAAU,EAC/BzL,QAASgZ,GAJX,eCxEFC,GAAqB,CAAExT,MAAO,EAAGF,MAAO,IAAKD,IAAK,IAAKE,KAAM,KAgFpD0T,GA7EQ,WAAO,IAAD,EACsBxP,oBAAkB,GADxC,mBACpByP,EADoB,KACDC,EADC,OAE0B1P,oBAAkB,GAF5C,mBAEpB2P,EAFoB,KAECC,EAFD,OAGO5P,oBAAkB,GAHzB,mBAGpBmE,EAHoB,KAGRK,EAHQ,OAISxE,mBAAqB,CACvDjI,GAAIiR,cACJ9F,MAAO,GACP2M,QAT6B,QAU7BtJ,UAAW,GACXP,gBAAgB,eAAMuJ,MATG,mBAIpBzC,EAJoB,KAIRgD,EAJQ,KAYLxiB,iBAAmBwf,GAC3Bvf,QAAUuf,EAExB,IAAMR,EAAmBjM,uBAAY,SAACnL,GACpC4a,EAAc5a,GACdwa,GAAoB,KACnB,CAACA,EAAqBI,IAEnBtJ,EAAkBnG,uBAAY,SAACmG,GACnCsJ,GAAc,SAAAxb,GAAK,kCAAUA,GAAV,IAAiBiS,UAAWC,SAC9C,CAACsJ,IAEErJ,EAAwBpG,uBAAY,SAAC5E,GACzCqU,GAAc,SAAAxb,GAAK,kCAAUA,GAAV,IAAiB0R,gBAAiBvK,SACpD,CAACqU,IAEEpJ,EAAcrG,uBAAY,SAAC6C,GAC3BA,EAAMnB,OAAS,IACnB+N,GAAc,SAAAxb,GAAK,kCAAUA,GAAV,IAAiB4O,eACnC,CAAC4M,IAEEvL,EAAkBlE,uBAAY,WAClCqP,GAAoB,KACnB,CAACA,IAEEnD,EAAmBlM,uBAAY,WACnCqP,GAAoB,KACnB,CAACA,IAEEpL,EAAoBjE,uBAAY,WACpCuP,GAAsB,KACrB,CAACA,IAEEV,EAAqB7O,uBAAY,WACrCuP,GAAsB,KACrB,CAACA,IAEJ,OACE,oCACE,kBAAC,GAAD,CACE1M,MAAO4J,EAAW5J,MAClBqD,UAAWuG,EAAWvG,UACtBP,gBAAiB8G,EAAW9G,gBAC5B7B,WAAYA,EACZI,gBAAiBA,EACjBD,kBAAmBA,EACnBkC,gBAAiBA,EACjBC,sBAAuBA,EACvBC,YAAaA,EACblC,YAAaA,IAEf,kBAAC,GAAD,CACE6H,OAAQoD,EACRnD,iBAAkBA,EAClBC,iBAAkBA,IAEpB,kBAAC,GAAD,CACEF,OAAQsD,EACR7C,WAAYA,EACZoC,mBAAoBA,MCpEba,I,cANH,WACV,OACE,kBAAC,GAAD,QCKWC,GAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,8BAAqB9E,MAAK,YAAkD,IAA/C+E,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,OCJdO,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,GAAD,OAEF1iB,SAAS2iB,eAAe,SAM1BX,M,gCCbO,IAkGDY,EAAmC,CACvChL,QAvBwC,CACxCjR,IAAK,UACLkc,QAAS,YACTtZ,OA/EqC,CACrC,CACE,CAAEuZ,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,YAExC,CACE,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,YAExC,CACE,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,cAsFxCsV,MAlBuC,CACvCpc,IAAK,QACLkc,QAAS,OACTtZ,OAlEgC,CAChC,CACE,CAAEuZ,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,YAExC,CACE,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,YAExC,CACE,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,cAoExCuV,KAbsC,CACtCrc,IAAK,OACLkc,QAAS,OACTtZ,OAvD+B,CAC/B,CACE,CAAEuZ,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,YAExC,CACE,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,YAExC,CACE,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,cAoDxCwV,MATuC,CACvCtc,IAAK,QACLkc,QAAS,QACTtZ,OA1CgC,CAChC,CACE,CAAEuZ,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,YAExC,CACE,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,YAExC,CACE,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,WACtC,CAAEqV,SAAU,KAAMnZ,MAAO,KAAM8D,MAAO,eAqC3BmV,O,gCCpEAtZ,IAvCE,CACf4Z,GAAI,2BACJC,GAAI,2BACJC,GAAI,2BACJC,GAAI,2BACJC,GAAI,2BACJC,GAAG,2BACHC,GAAI,2BACJC,GAAI,2BACNC,GAAG,2BACH7W,GAAI,sBACJG,GAAI,sBACJ2W,GAAI,sBACJC,GAAI,sBACJC,GAAI,sBACJC,GAAG,sBACHC,GAAI,sBACJC,GAAI,sBACJC,GAAG,sBACHnX,GAAI,uBACJG,GAAI,uBACJiX,GAAI,uBACJC,GAAI,uBACJC,GAAI,uBACJC,GAAG,uBACHC,GAAI,uBACJC,GAAI,uBACJC,GAAG,uBACH5X,GAAI,iBACJG,GAAI,iBACJ0X,GAAI,iBACJC,GAAI,iBACJC,GAAI,iBACJC,GAAG,iBACHC,GAAI,iBACJC,GAAI,iBACJC,GAAG,oB,kGCXkBC,E,WAGnB,WAAYC,GAA+B,IAAD,gCAFhC3b,cAEgC,EACxChF,KAAKgF,SAAW,GAEhBqK,OAAOa,KAAKyQ,GAAe9d,SAAQ,SAACR,GAClC,IAAM6Z,EAAMyE,EAActe,GAC1B,EAAK2C,SAAS3C,GAAO,IAAIue,OAAK,CAAEC,IAAK,CAAC3E,Q,qDAIjC4E,GAAuB,IAAD,OACvBC,EAAkBD,EAAWrM,MACjC,SAACpP,GAAD,OAAY,EAAKL,SAASK,MAG5B,GAAI0b,EACF,MAAM,IAAIpL,MAAJ,2BAA8BoL,KA/B1C,SAASC,EAAUhc,EAAoBic,GAAgC,IAAZpa,EAAW,uDAAH,EACzDqa,EAAWD,EAASpa,GAC1B,GAAKqa,EAAL,CAEA,IAAM7b,EAAQL,EAASkc,GACvB7b,EAAM8b,KAAK,OAAO,WAChBH,EAAUhc,EAAUic,EAAUpa,EAAQ,MAGxCxB,EAAM+b,QA2BNJ,CADiBhhB,KAAKgF,SACF8b,O,m9BC5CjB,IAAMO,EAAkBnU,IAAOC,IAAV,KAQfmU,EAAYpU,IAAOC,IAAV,KAYToU,EAAarU,IAAOC,IAAV,KAQC,SAAC0D,GAAD,uBAAWA,EAAM1H,aAAjB,QAA0B,UAI5C,SAAC0H,GAAD,OAAWA,EAAM2Q,UAAYC,YAAlB,QC8BFC,EA5C2B,SAAC,GAKpC,IAJHzc,EAIE,EAJFA,OACA0c,EAGE,EAHFA,WACAC,EAEE,EAFFA,UACAC,EACE,EADFA,aAEIC,EAAW3T,mBAAQ,WACvB,IAAM4T,EAAS,IAAIC,MAAM/c,EAAOwK,QAAQxM,KAAK,MAAMmC,KAAI,SAACgW,EAAG7L,GAAJ,MAAU,CAACA,EAAG,OAC/DnK,EAAsBiK,OAAO4S,YAAYF,GAC/C,OAAOJ,EAAWvL,QAAO,SAAC8L,EAAD,EAAgBrb,GAAW,IAAnB9K,EAAkB,EAAlBA,EAE/B,OADAmmB,EADiD,EAAflmB,GAC3BD,GAAK8K,EAAQ,EACbqb,IACN9c,KACF,CAACuc,EAAY1c,IAEVkd,EAAepU,uBACnB,SAAChS,EAAWC,GAAZ,QAA4B8lB,EAAS9lB,GAAGD,KACxC,CAAC+lB,IAGGM,EAAcrU,uBAAY,SAAChS,EAAWC,GAC1C6lB,EAAa,CAAE9lB,IAAGC,QACjB,CAAC6lB,IAEJ,OACE,kBAACR,EAAD,KACGpc,EAAOG,KAAI,SAAC+V,EAAKkH,GAAN,OACV,kBAACf,EAAD,CAAWjf,IAAG,UAAKuf,EAAL,YAAkBS,IAC7BlH,EAAI/V,KAAI,SAACkd,EAAMC,GAAP,OACP,kBAAChB,EAAD,CACElf,IAAG,UAAKuf,EAAL,YAAkBS,EAAlB,YAA8BE,GACjCf,SAAUW,EAAaI,EAAWF,GAClClZ,MAAOmZ,EAAKnZ,MACZnF,QAAS,kBAAMoe,EAAYG,EAAWF,KAErCC,EAAK9D,mB,0HCvDb,IAAM5K,EAAa1G,IAAOC,IAAX,K,sRCEf,IAAMqV,EAAatV,YAAO2M,IAAP3M,CAAH,KCajBuV,EAAoBpT,OAAOa,KAAKhL,KAAUE,KAAI,SAAC/C,GAAD,OAAS6C,IAAS7C,MAChEqgB,EAAexd,IAASoO,QAExBqP,EAAmB,iBAAc,CACrC/d,gBAAiB8d,EAAargB,IAC9BwC,cAAe,KA2FF+d,IAxFuB,SAAC,GAA6C,IAAD,EAA1Cje,EAA0C,EAA1CA,MAAsBke,EAAoB,EAAnC9T,cAAmC,EAE7CrB,oBAAsB,OAAL/I,QAAK,IAALA,OAAA,EAAAA,EAAOC,kBAAmB8d,EAAargB,KAFX,mBAE1EygB,EAF0E,KAE3DC,EAF2D,KAY3Eje,EAAeqJ,mBAAQ,kBAAM,IAAIpJ,IAAaC,OAAW,IAEzDge,EAASjV,uBAAY,WAAO,IAAD,EACYpJ,GAASge,IAA5C/d,EADuB,EACvBA,gBAAiBC,EADM,EACNA,cACjBI,EAAWC,IAASN,GAApBK,OACFE,EAAYN,EAAcO,KAAI,YAAe,IAAZrJ,EAAW,EAAXA,EAAGC,EAAQ,EAARA,EAExC,OADkBiJ,EAAOlJ,GAAGC,GAApBqJ,SAIVP,EAAaQ,SAASH,KACrB,CAACL,EAAcH,IAGZkd,EAAe9T,uBAAY,SAAC9M,GAAsB,IAMlDgiB,EANiD,EACVte,GAASge,IAA5C/d,EAD6C,EAC7CA,gBAAiBC,EAD4B,EAC5BA,cACnBgC,EAAQhC,EAAcsQ,WAC1B,SAAC+N,GAAD,OCpDyBC,EDoDiBliB,GCpDhCmiB,EDoDqBF,GCnDtBnnB,IAAMonB,EAAOpnB,GAAKqnB,EAAMpnB,IAAMmnB,EAAOnnB,EADrC,IAAConB,EAAeD,KDyDzBF,GADa,IAAXpc,EACiB,sBACdhC,EAAcuQ,MAAM,EAAGvO,IADT,YAEdhC,EAAcuQ,MAAMvO,EAAQ,KAGd,sBACdhC,GADc,CAEjB5D,IAIJ4hB,EAAc,CACZje,kBACAC,cAAeoe,MAEhB,CAACte,EAAOke,IAELQ,EAAkBtV,uBAAY,SAACnB,GACnCiW,EAAc,CACZje,gBAAiBgI,EACjB/H,cAAe,KAEjBke,EAAWnW,KACV,CAACmW,EAAYF,IAEhB,OACE,kBAACjP,EAAD,KACE,kBAACxF,EAAA,EAAD,CACExB,MAAOkW,EACPtV,SAAU,SAACnS,GAAD,OAAWgoB,EAAgBhoB,EAAMiT,OAAO1B,QAClDyB,WAAW,GAEVoU,EAAkBrd,KAAI,gBAAGmZ,EAAH,EAAGA,QAASlc,EAAZ,EAAYA,IAAZ,OACrB,kBAACkM,EAAA,EAAD,CAAUlM,IAAKA,EAAKuK,MAAOvK,GAAOkc,OAGtC,kBAAC,EAAD,CACEtZ,OAAQC,IAAS4d,GAAe7d,OAChC0c,WAAU,iBAAEhd,QAAF,IAAEA,OAAF,EAAEA,EAAOE,qBAAT,QAA0B,GACpC+c,UAAWkB,EACXjB,aAAcA,IAEhB,kBAACW,EAAD,CACExe,QAASgf,EACT7Z,MAAM,UACNyS,QAAQ,YACRvN,WAAW,GAJb,Y","file":"static/js/main.4a84f75c.chunk.js","sourcesContent":["export * from './launchpad.types';\nexport { default } from './launchpad';\n","// Core shape interface\nexport interface ISize {\n    width: number;\n    height: number;\n}\n\nexport interface IPoint {\n    x: number;\n    y: number;\n}\n\n// Colors interface\nexport interface ISimpleColor {\n  alpha: number;\n  blue: number;\n  green: number;\n  red: number;\n};\n\nexport interface IGradientColorItem extends ISimpleColor {\n  left: number;\n};\n\nexport enum IGradientType {\n  linear = 'linear',\n  radial = 'radial'\n}\n\nexport interface ICustomGradient {\n  type: IGradientType;\n  points: IGradientColorItem[];\n  degree: number;\n};\n\nexport type Color = ISimpleColor | ICustomGradient;\n\n\nexport type Track = {\n  SoundPaletteKey: string;\n  soundPosition: IPoint[];\n}\n\nexport enum ShapeSchemeType {\n  ellipse,\n  rectangle,\n  polygon,\n  blob,\n}\n\nexport type SimpleShapeSchemeType = ShapeSchemeType.ellipse | ShapeSchemeType.rectangle;\nexport type ComplexShapeSchemeType = ShapeSchemeType.polygon | ShapeSchemeType.blob;\n\nexport interface SimpleShapeScheme {\n  point: IPoint;\n  size: ISize;\n}\n\nexport interface ComplexShapeScheme {\n  points: IPoint[];\n}\n\ntype MusicPaperShapeCreator<Types, Data extends {}> = {\n  id: string;\n  type: Types;\n  shapeScheme: Data\n  color: Color;\n  track: Track | null;\n}\n\nexport interface SimpleScheme {\n  point: IPoint;\n  size: ISize;\n}\n\nexport interface ComplexScheme {\n  points: IPoint[];\n}\n\nexport type SimpleMusicPaperShape = MusicPaperShapeCreator<SimpleShapeSchemeType, SimpleScheme>;\nexport type ComplexMusicPaperShape = MusicPaperShapeCreator<ComplexShapeSchemeType, ComplexScheme>\n\nexport type MusicPaperShape = SimpleMusicPaperShape | ComplexMusicPaperShape;\n\n\nexport interface MusicPaper {\n  id: string;\n  title: string;\n  version: `${number}.${number}.${number}`\n  backgroundColor: Color;\n  shapeList: MusicPaperShape[]\n}","import { useRef, useEffect } from \"react\";\n\nfunction useCopyPast(onCopy: VoidFunction, onPast: VoidFunction): void {\n  const handleCopyRef = useRef(onCopy);\n  handleCopyRef.current = onCopy;\n\n  const handlePastRef = useRef(onPast);\n  handlePastRef.current = onPast;\n\n  useEffect(() => {\n\n    const keyPressHandler = (event: KeyboardEvent) => {\n      const handleCopy = handleCopyRef.current;\n      const handlePast = handlePastRef.current;\n      if (!event.ctrlKey) return;\n      if (event.code === 'KeyC') {\n        handleCopy();\n      } else if (event.code === 'KeyV') {\n        handlePast();\n      }\n    }\n\n    document.addEventListener('keydown', keyPressHandler);\n    return () => {\n      document.removeEventListener('keydown', keyPressHandler);\n    }\n  }, []);\n}\n\nexport default useCopyPast;","import { IPoint } from '@consts/types';\n\nconst isMouseEvent = (event: MouseEvent | TouchEvent): event is MouseEvent => {\n  return !!(event as MouseEvent).offsetX;\n}\n\nexport default (event: MouseEvent | TouchEvent): IPoint => {\n  if (isMouseEvent(event)) {\n    return {\n      x: event.offsetX,\n      y: event.offsetY\n    }\n  }\n\n  return {\n    x: event.touches[0].clientX,\n    y: event.touches[0].clientY,\n  }\n}\n","import paper from 'paper'\nimport { IPoint, ISize } from '@consts/types';\n\n\n\ntype VerticalDirections = 'top' | 'down';\ntype HorizontalDirections = 'left' | 'right';\ntype SimpleDirections = VerticalDirections | HorizontalDirections;\n\n/* \n*   The direction in diagonal type names equals direction\n*   from bottom to top for diagonal.\n*\n*   More about types values: \n*   diagonal-lb-rt - ↗\n*   diagonal-rt-lb - ↙\n*   diagonal-rb-lt - ↖\n*   diagonal-lt-rb - ↘\n**/\ntype DiagonalRightDirections = 'diagonal-lb-rt' | 'diagonal-rt-lb';\ntype DiagonalLeftDirections = 'diagonal-rb-lt' | 'diagonal-lt-rb';\ntype DiagonalDirections = DiagonalRightDirections | DiagonalLeftDirections;\n\ntype Directions = SimpleDirections | DiagonalDirections;\n\ntype ResizeCursor = 'ew-resize' | 'ns-resize' | 'nesw-resize' | 'nwse-resize';\n\ntype CursorDirectionMap = { [key in Directions]: ResizeCursor };\ntype MapBySimpleDirections<T extends string> = {\n  [horizontalKey in HorizontalDirections]: {\n    [verticalKey in VerticalDirections]: T;\n  }\n}\n\ntype ResizeHandler = (size: ISize, position: IPoint) => void;\ntype MouseEventHandler = (event: MouseEvent) => void;\ntype TouchEventHandler = (event: TouchEvent) => void;\n\nconst changingXDirections: Directions[] = [\n  'left',\n  'diagonal-rt-lb',\n  'diagonal-rb-lt'\n]\n\nconst changingYDirections: Directions[] = [\n  'top',\n  'diagonal-lb-rt',\n  'diagonal-rb-lt'\n]\n\nconst horizontalResizeDirection: string[] = [\n  'left',\n  'right',\n  'diagonal-lt-rb',\n  'diagonal-rb-lt',\n  'diagonal-lb-rt',\n  'diagonal-rt-lb'\n];\nconst verticalResizeDirection: string[] = [\n  'down',\n  'top',\n  'diagonal-lt-rb',\n  'diagonal-rb-lt',\n  'diagonal-lb-rt',\n  'diagonal-rt-lb'\n];\n\nconst cursorDirectionMap: CursorDirectionMap = {\n  \"down\": 'ns-resize',\n  \"top\": 'ns-resize',\n  \"left\": 'ew-resize',\n  \"right\": 'ew-resize',\n  \"diagonal-lb-rt\": 'nesw-resize',\n  \"diagonal-rb-lt\": 'nwse-resize',\n  \"diagonal-lt-rb\": 'nwse-resize',\n  \"diagonal-rt-lb\": 'nesw-resize'\n}\n\nconst diagonalDirMap: MapBySimpleDirections<DiagonalDirections> = {\n  right: {\n    down: 'diagonal-lt-rb',\n    top: 'diagonal-lb-rt'\n  },\n  left: {\n    down: 'diagonal-rt-lb',\n    top: 'diagonal-rb-lt'\n  }\n}\n\n//  FIXME: Has problem where STROKE_WIDTH equals 10\n//  On right border created wrong cursor icon in case\n//  where cursor hover on max left postilion\nconst STROKE_VISIBLE_WIDTH = 2;\nconst STROKE_WIDTH = 20;\n\nconst DEFAULT_EXPAND_SIZE = 15;\n\nexport default class ResizeArea {\n  public onResize: ResizeHandler | null = null;\n\n  private _resizeHoverRectangle: paper.Path.Rectangle;\n  private _resizeVisibleRectangle: paper.Path.Rectangle;\n\n  private _cursorBeforeModify: string | null = null;\n  private _isShow: boolean = false;\n\n  private _onDocumentMouseUp: VoidFunction | null = null;\n  private _onDocumentMouseMove: MouseEventHandler  | null = null;\n  private _onDocumentTouchMove: TouchEventHandler  | null = null;\n\n\n  constructor(\n    private paperScope: paper.PaperScope,\n    rectangle: paper.Rectangle,\n    private expandSize: number = DEFAULT_EXPAND_SIZE,\n  ) {\n    const resizeVisibleRectangle = this.self.expandRectangle(rectangle, this.expandSize);\n    const rectangleVisibleColor = new this.paperScope.Color(0, 0, 0, 0.2);\n    this._resizeVisibleRectangle = new this.paperScope.Path.Rectangle(resizeVisibleRectangle)\n\n    this._resizeVisibleRectangle.strokeColor = rectangleVisibleColor;\n    this._resizeVisibleRectangle.strokeWidth = STROKE_VISIBLE_WIDTH;\n    this._resizeVisibleRectangle.visible = false;\n\n    const resizeHoverRectangle = this.self.expandRectangle(rectangle, this.expandSize);\n    const rectangleHoverColor = new this.paperScope.Color(0, 0, 0, Number.EPSILON);\n    this._resizeHoverRectangle = new this.paperScope.Path.Rectangle(resizeHoverRectangle)\n\n    this._resizeHoverRectangle.strokeColor = rectangleHoverColor;\n    this._resizeHoverRectangle.strokeWidth = STROKE_WIDTH;\n    this._resizeHoverRectangle.visible = false;\n\n    this.bindMouseHoverHandlers();\n\n    this._resizeHoverRectangle.onMouseDown  = (event: paper.MouseEvent) => {\n      this.handleMouseDown(event)\n    }\n  }\n\n  public updateSize(rectangle: paper.Rectangle) {\n    const updateBounds = this.self.expandRectangle(rectangle, this.expandSize);\n    this._resizeVisibleRectangle.bounds = updateBounds.clone();\n    this._resizeHoverRectangle.bounds = updateBounds;\n  }\n\n  public get isShow() {\n    return this._isShow;\n  }\n  public set isShow(state: boolean) {\n    if (this._isShow === state) return;\n    this._resizeVisibleRectangle.visible = state;\n    this._resizeHoverRectangle.visible = state;\n    this._isShow = state;\n  }\n\n  public shift(x: number, y: number) {\n    this._resizeHoverRectangle.position.x += x;\n    this._resizeHoverRectangle.position.y += y;\n  \n    this._resizeVisibleRectangle.position.x += x;\n    this._resizeVisibleRectangle.position.y += y;\n  }\n\n  public bringToFront() {\n    this._resizeVisibleRectangle.bringToFront();\n    this._resizeHoverRectangle.bringToFront();\n  }\n\n  public remove() {\n    this._resizeVisibleRectangle.remove();\n    this._resizeHoverRectangle.remove();\n  }\n\n  protected unbindMouseHoverHandlers = () => {\n    this._resizeHoverRectangle.onMouseMove = null;\n    this._resizeHoverRectangle.onMouseLeave = null;\n  }\n\n  protected bindMouseHoverHandlers = () => {\n    this._resizeHoverRectangle.onMouseMove = (event: paper.MouseEvent) => {\n      this.handleMouseMove(event)\n    }\n    this._resizeHoverRectangle.onMouseLeave = () => {\n      this.handleBlur()\n    }\n  }\n\n  protected handleMouseDown = (event: paper.MouseEvent) => {\n    this.unbindMouseHoverHandlers();\n\n    const mouseUpHandler = () => this.handleMouseUp();\n    window.addEventListener('mouseup', mouseUpHandler);\n    window.addEventListener('touchend', mouseUpHandler);\n    this._onDocumentMouseUp = mouseUpHandler;\n\n    \n    const mouseMoveHandler = this.resizeHandlerCreator(event);\n    const touchMoveHandler = this.resizeTouchHandlerCreator(event);\n    window.addEventListener('mousemove', mouseMoveHandler);\n    window.addEventListener('touchmove', touchMoveHandler);\n    this._onDocumentMouseMove = mouseMoveHandler;\n    this._onDocumentTouchMove = touchMoveHandler;\n  }\n\n  protected handleMouseUp = () => {\n    if (this._onDocumentMouseUp) {\n      window.removeEventListener('mouseup', this._onDocumentMouseUp);\n      window.removeEventListener('touchend', this._onDocumentMouseUp);\n    }\n    if (this._onDocumentMouseMove) {\n      window.removeEventListener('mousemove', this._onDocumentMouseMove);\n      // @ts-ignore\n      window.removeEventListener('touchmove', this._onDocumentTouchMove as unknown as (this:Window, ev: MouseEvent) => any);\n    }\n\n    this.bindMouseHoverHandlers();\n  }\n\n  protected handleMouseMove = (event: paper.MouseEvent) => {\n    const direction = this.calculateDirection(event);\n    const cursor = cursorDirectionMap[direction];\n\n    if (this._cursorBeforeModify === null) {\n      this._cursorBeforeModify = document.body.style.cursor;\n    }\n\n    document.body.style.cursor = cursor;\n  }\n\n  protected handleBlur = () => {\n    if (this._cursorBeforeModify != null) {\n      document.body.style.cursor = this._cursorBeforeModify;\n      this._cursorBeforeModify = null;\n    }\n  }\n\n  protected resizeHandlerCreator(event: paper.MouseEvent): MouseEventHandler {\n    const direction = this.calculateDirection(event);\n    const isXPositionChange = changingXDirections.includes(direction);\n    const isYPositionChange = changingYDirections.includes(direction);\n    const initBounds = this._resizeHoverRectangle.bounds.clone();\n    const { point: initResizePoint } = event;\n\n    return (event: MouseEvent) => {\n      const { x: initX, y: initY} = initResizePoint;\n      const { offsetX: x, offsetY: y } = event;\n\n      let diffX = horizontalResizeDirection.includes(direction) ? x - initX : 0;\n      let diffY = verticalResizeDirection.includes(direction) ? y - initY : 0;\n\n      diffX = isXPositionChange ? -diffX : diffX;\n      diffY = isYPositionChange ? -diffY : diffY;\n      \n\n      const bounds = initBounds.clone();\n      const updateBoundsWidth = bounds.width + diffX;\n      const updateBoundsHeight = bounds.height + diffY;\n\n      if (updateBoundsWidth > 10) {\n        bounds.width = updateBoundsWidth;\n        bounds.x += isXPositionChange ? -diffX : 0;\n      } else {\n        bounds.width = this._resizeHoverRectangle.bounds.width;\n        bounds.x = this._resizeHoverRectangle.bounds.x;\n      }\n\n      if (updateBoundsHeight > 10) {\n        bounds.height = updateBoundsHeight;\n        bounds.y += isYPositionChange ? -diffY : 0;\n      } else {\n        bounds.height = this._resizeHoverRectangle.bounds.height;\n        bounds.y = this._resizeHoverRectangle.bounds.y;\n      }\n      \n      this._resizeVisibleRectangle.bounds = bounds.clone();\n      this._resizeHoverRectangle.bounds = bounds;\n      if (this.onResize) {\n        const originalRectangle = this.self.unExpandRectangle(bounds, this.expandSize);\n        const size: ISize = { width: originalRectangle.width, height: originalRectangle.height };\n        const position: IPoint = { x: originalRectangle.x, y: originalRectangle.y };\n        this.onResize(size, position);\n      }\n    }\n  }\n\n  protected resizeTouchHandlerCreator(event: paper.MouseEvent): TouchEventHandler {\n    const direction = this.calculateDirection(event);\n\n    const isXPositionChange = changingXDirections.includes(direction);\n    const isYPositionChange = changingYDirections.includes(direction);\n    const initBounds = this._resizeHoverRectangle.bounds.clone();\n    const { point: initResizePoint } = event;\n\n    return (event: TouchEvent) => {\n      if (!event.touches[0]) return;\n      const { x: initX, y: initY} = initResizePoint;\n      const { clientX: x, clientY: y } = event.touches[0];\n\n      let diffX = horizontalResizeDirection.includes(direction) ? x - initX : 0;\n      let diffY = verticalResizeDirection.includes(direction) ? y - initY : 0;\n\n      diffX = isXPositionChange ? -diffX : diffX;\n      diffY = isYPositionChange ? -diffY : diffY;\n\n\n      const bounds = initBounds.clone();\n      const updateBoundsWidth = bounds.width + diffX;\n      const updateBoundsHeight = bounds.height + diffY;\n\n      if (updateBoundsWidth > 10) {\n        bounds.width = updateBoundsWidth;\n        bounds.x += isXPositionChange ? -diffX : 0;\n      } else {\n        bounds.width = this._resizeHoverRectangle.bounds.width;\n        bounds.x = this._resizeHoverRectangle.bounds.x;\n      }\n\n      if (updateBoundsHeight > 10) {\n        bounds.height = updateBoundsHeight;\n        bounds.y += isYPositionChange ? -diffY : 0;\n      } else {\n        bounds.height = this._resizeHoverRectangle.bounds.height;\n        bounds.y = this._resizeHoverRectangle.bounds.y;\n      }\n\n      this._resizeVisibleRectangle.bounds = bounds.clone();\n      this._resizeHoverRectangle.bounds = bounds;\n      if (this.onResize) {\n        const originalRectangle = this.self.unExpandRectangle(bounds, this.expandSize);\n        const size: ISize = { width: originalRectangle.width, height: originalRectangle.height };\n        const position: IPoint = { x: originalRectangle.x, y: originalRectangle.y };\n        this.onResize(size, position);\n      }\n    }\n  }\n\n  protected calculateDirection = (event: paper.MouseEvent): Directions => {\n    const { height, width, x, y } = this._resizeHoverRectangle.bounds;\n    const onePercentForWidth = (width + STROKE_WIDTH/2)/100;\n    const onePercentForHeight = (height + STROKE_WIDTH/2)/100;\n\n    const strokeHorizontalPercent = STROKE_WIDTH / onePercentForWidth;\n    const strokeVerticalPercent = STROKE_WIDTH / onePercentForHeight;\n\n    const horizontalTriggerValue = (100 - (strokeHorizontalPercent * 2))/2;\n    const verticalTriggerValue = (100 - (strokeHorizontalPercent * 2))/2;\n\n    const percentByX = (event.point.x - x) / onePercentForWidth;\n    const percentByY = (event.point.y - y) / onePercentForHeight;\n\n    const diffX = percentByX - 50;\n    const diffY = percentByY - 50;\n\n    const isPointOnDiagonal = \n      Math.abs(diffX) >= horizontalTriggerValue \n      && Math.abs(diffY) >= verticalTriggerValue;\n\n\n    if (isPointOnDiagonal) {\n      const HorizontalDir: HorizontalDirections = diffX > 0 ? 'right' : 'left';\n      const verticalDir: VerticalDirections = diffY > 0 ? 'down' : 'top';\n      return diagonalDirMap[HorizontalDir][verticalDir];\n    } else {\n      // TODO: make a complete algorithm\n      if (percentByX < strokeVerticalPercent) return 'left';\n      if (percentByX > 100 - strokeVerticalPercent) return 'right';\n      if (percentByY < strokeHorizontalPercent) return 'top';\n      if (percentByY > 100 - strokeHorizontalPercent) return 'down';\n      return 'down';\n    }\n  }\n\n  protected get self() {\n    return ResizeArea;\n  }\n\n  static expandRectangle(\n    rectangle: paper.Rectangle,\n    expandSize: number\n  ): paper.Rectangle {\n    const rectangleClone = rectangle.clone();\n    rectangleClone.x -= expandSize;\n    rectangleClone.y -= expandSize;\n    rectangleClone.width += expandSize * 2;\n    rectangleClone.height += expandSize * 2;\n    return rectangleClone;\n  }\n\n  static unExpandRectangle(\n    rectangle: paper.Rectangle,\n    expandSize: number\n  ): paper.Rectangle {\n    const rectangleClone = rectangle.clone();\n    rectangleClone.x += expandSize;\n    rectangleClone.y += expandSize;\n    rectangleClone.width -= expandSize * 2;\n    rectangleClone.height -= expandSize * 2;\n    return rectangleClone;\n  }\n};","type EventMap = Record<string, any>;\n\ntype EventKey<T extends EventMap> = string & keyof T;\ntype EventReceiver<T> = (params: T) => void;\n\nexport interface Emitter<T extends EventMap> {\n  on<K extends EventKey<T>>\n  (eventName: K, fn: EventReceiver<T[K]>): void;\n  off<K extends EventKey<T>>\n  (eventName: K, fn: EventReceiver<T[K]>): void;\n  emit<K extends EventKey<T>>\n  (eventName: K, params: T[K]): void;\n}\n\nfunction eventEmitter<T extends EventMap>(): Emitter<T> {\n  const listeners: {\n    [K in keyof EventMap]?: Array<(p: EventMap[K]) => void>;\n  } = {};\n\n  return {\n    on(key, fn) {\n      listeners[key] = (listeners[key] || []).concat(fn);\n    },\n    off(key, fn) {\n      listeners[key] = (listeners[key] || []).filter(f => f !== fn);\n    },\n    emit(key, data) {\n      (listeners[key] || []).forEach(function(fn) {\n        fn(data);\n      });\n    },\n  };\n}\n\nexport default eventEmitter;","import {throttle} from 'lodash'\nimport {IPoint, ISize, MusicPaperShape} from '@consts/types'\nimport soundMap from '@consts/soundMap';\nimport palettes from '@consts/palettes';\nimport MusicFactory from '@utils/MusicFactory'\nimport convertMouseEventToPosition from '../../utils/convertMouseEventToPosition';\nimport ResizeArea from './resize-area';\nimport eventEmitter, {Emitter} from './event-emitter';\n\ntype Events = {\n  click: MusicPaperShape;\n  moved: MusicPaperShape;\n  edited: MusicPaperShape;\n}\n\ntype MouseMoveHandler = (event: MouseEvent) => void;\ntype TouchMoveHandler = (event: TouchEvent) => void;\n\nconst hitOptions = {\n\tsegments: true,\n\tstroke: true,\n\tfill: true,\n\ttolerance: 5\n};\n\nexport abstract class AbstractFigure<\n  CoreFigure extends paper.Path = paper.Path,\n  ShapeData extends MusicPaperShape = MusicPaperShape\n> {\n  static readonly emitter: Emitter<Events> = eventEmitter<Events>()\n  private readonly _coreFigure: CoreFigure;\n  public isDisable: boolean = false;\n\n  private _isPlayMode: boolean = false;\n  private _isActive: boolean = false;\n  private _ResizeArea: ResizeArea | null = null;\n  private _lastMovePosition: IPoint | null = null;\n  private _moveFigureHandler: MouseMoveHandler | null = null;\n  private _touchFigureHandler: TouchMoveHandler | null = null;\n  private _moveSegmentHandler: MouseMoveHandler | null = null;\n  private _touchSegmentHandler: TouchMoveHandler | null = null\n\n  protected abstract initCoreFigure(paperScope: paper.PaperScope, shape: ShapeData): CoreFigure;\n  protected abstract updateCoreFigureByShapeData(\n    coreFigure: CoreFigure,\n    shape: ShapeData,\n    paperScope: paper.PaperScope\n  ): void;\n  protected abstract serializationToShapeData(\n    coreFigure: CoreFigure,\n    shape: ShapeData,\n  ): ShapeData;\n\n  public onClick: VoidFunction | null = null;\n\n\n\n  public constructor(\n    private _paperScope: paper.PaperScope,\n    private _shapeData: ShapeData\n  ) {\n    this._coreFigure = this.initCoreFigure(_paperScope, _shapeData);\n    this.bindHandlers();\n  }\n\n  public updateFromShapeData(updateShapeData: ShapeData): void {\n    this.updateCoreFigureByShapeData(this._coreFigure, updateShapeData, this._paperScope);\n    this._shapeData = updateShapeData;\n    this._ResizeArea?.updateSize(this._coreFigure.bounds);\n  }\n\n  public get shapeData() {\n    return this._shapeData;\n  }\n\n  protected get static() {\n    return AbstractFigure;\n  }\n\n  public get bounds() {\n    return this._coreFigure.bounds;\n  }\n\n  public get id() {\n    return this._shapeData.id;\n  }\n\n  public get isPlayMode() {\n    return this._isPlayMode;\n  }\n\n  public set isPlayMode(status: boolean) {\n    this._isPlayMode = status;\n    this.isActive = false;\n  }\n\n  public get isActive() {\n    return this._isActive;\n  }\n\n  public set isActive(state: boolean) {\n    if (this._isActive === state) return;\n    if (!this._ResizeArea) {\n      this._ResizeArea = new ResizeArea(this._paperScope, this._coreFigure.bounds);\n      this._ResizeArea.onResize = (size, position) => {\n        this.resizeFigure(size, position);\n        this._updateNotify();\n      }\n    }\n\n    if (this.isCanChangePoints()) {\n      this._coreFigure.selected = state;\n    }\n  \n    this._ResizeArea.isShow = state;\n    this._isActive = state;\n  }\n\n  public bringToFront() {\n    this._coreFigure.bringToFront();\n    this._ResizeArea?.bringToFront();\n  }\n\n  public remove() {\n    if (this._moveFigureHandler) {\n      window.removeEventListener('mousemove', this._moveFigureHandler)\n    }\n\n    if (this._ResizeArea) this._ResizeArea.remove();\n    this._coreFigure.remove();\n  }\n  \n  protected isSmoothFigure() {\n    return false;\n  }\n  \n  protected isCanChangePoints() {\n    return false;\n  }\n\n  private playTrack() {\n    const { track } = this._shapeData;\n    if (!track) return;\n    const { SoundPaletteKey, soundPosition } = track;\n    const musicFactory = new MusicFactory(soundMap);\n    const { matrix } = palettes[SoundPaletteKey];\n    const musicRoad = soundPosition.map(({ x, y }) => {\n      const { sound } = matrix[x][y];\n      return sound;\n    });\n\n    musicFactory.playSong(musicRoad);\n  }\n\n  private _updateNotify = throttle(() => {\n    const updateShapeData = this.serializationToShapeData(this._coreFigure, this._shapeData);\n    this._shapeData = updateShapeData;\n    this.static.emitter.emit('edited', updateShapeData);\n  }, 20)\n\n  private bindHandlers() {\n    this._coreFigure.strokeColor = new this._paperScope.Color(0, 0, 0, Number.EPSILON);\n    this._coreFigure.selectedColor = new this._paperScope.Color(0, 1, 0);\n    this._coreFigure.strokeWidth = 5;\n\n    this.static.emitter.on('click', (shapeData) => {\n      if (shapeData.id === this.id) return;\n      this.isActive = false;\n    })\n\n    this._paperScope.project.view.on('mouseup', (event: paper.MouseEvent) => {\n      if (this.isDisable) return;\n      this.unbindSegmentMoveHandler();\n\n      const { shift: isShiftPress } = event.modifiers;\n      if (!this.isActive || !isShiftPress) return;\n\n      const hitResult = this._paperScope.project.hitTest(event.point, hitOptions);\n      if (!hitResult) return;\n\n      if (hitResult.item !== this._coreFigure || hitResult.type !== 'segment') return;\n      hitResult.segment.remove();\n      this._ResizeArea?.updateSize(this._coreFigure.bounds);\n      event.stopPropagation();\n    })\n\n    this._coreFigure.onMouseUp = () => {\n      this.unbindFigureMoveHandler();\n    }\n\n    this._coreFigure.onMouseDown = (event: paper.MouseEvent) => {\n      if (this._isPlayMode) {\n        this.playTrack();\n        return;\n      }\n      if (this.isDisable) {\n        this.static.emitter.emit('click', this._shapeData);\n        return;\n      }\n      let mustBindHandler = true;\n      if (!this.isActive) {\n        this._paperScope.project.activeLayer.selected = false;\n        this.static.emitter.emit('click', this._shapeData);\n        this.isActive = true;\n      } else if (this.isCanChangePoints()) {\n        const { project } = this._paperScope;\n        const hitResult = project.hitTest(event.point, hitOptions);\n        if (hitResult) {\n          const { shift: isShiftPress } = event.modifiers;\n          if (isShiftPress && hitResult.type === 'segment') {\n            hitResult.segment.remove();\n            this._ResizeArea?.updateSize(this._coreFigure.bounds);\n            event.stopPropagation();\n            mustBindHandler = false;\n            this._updateNotify();\n          } else if (hitResult.type === 'segment' && !isShiftPress) {\n            this.bindSegmentMoveHandler(hitResult.segment);\n            mustBindHandler = false;\n          } else if (hitResult.type === 'stroke') {\n            const position = hitResult.location.index + 1;\n            const segment = this._coreFigure.insert(position, event.point)\n            if (this.isSmoothFigure()) this._coreFigure.smooth();\n\n            this._ResizeArea?.updateSize(this._coreFigure.bounds);\n            this.bindSegmentMoveHandler(segment);\n            mustBindHandler = false;\n          }\n        }\n      }\n\n\n      if (mustBindHandler) {\n        const { point: { x, y } } = event;\n        this.bindFigureMoveHandler({ x, y });\n      }\n      this.onClick && this.onClick();\n    }\n  }\n\n  private bindSegmentMoveHandler(segment: paper.Segment) {\n    this._moveSegmentHandler = throttle((event: MouseEvent) => {\n      const position = convertMouseEventToPosition(event);\n      segment.point.x = position.x;\n      segment.point.y = position.y;\n      this._ResizeArea?.updateSize(this._coreFigure.bounds);\n    }, 20);\n    this._touchSegmentHandler = throttle((event: TouchEvent) => {\n      const position = convertMouseEventToPosition(event);\n      segment.point.x = position.x;\n      segment.point.y = position.y;\n      this._ResizeArea?.updateSize(this._coreFigure.bounds);\n    }, 20);\n\n    window.addEventListener('mousemove', this._moveSegmentHandler);\n    window.addEventListener('touchmove', this._touchSegmentHandler);\n  }\n\n  private unbindSegmentMoveHandler() {\n    if (!this._moveSegmentHandler || !this._touchSegmentHandler) return;\n    window.removeEventListener('mousemove', this._moveSegmentHandler);\n    window.removeEventListener('touchmove', this._touchSegmentHandler);\n\n    this._updateNotify()\n    this._moveSegmentHandler = null;\n    this._touchSegmentHandler = null;\n  }\n\n  // Move figure logic\n\n  private bindFigureMoveHandler(position: IPoint) {\n    this._lastMovePosition = position;\n    this._moveFigureHandler = throttle((event) => this.moveFigure(event), 20)\n    this._touchFigureHandler = throttle((event: TouchEvent) => this.moveFigure(event), 20)\n    window.addEventListener('mousemove', this._moveFigureHandler);\n    window.addEventListener('touchmove', this._touchFigureHandler);\n  }\n\n  private unbindFigureMoveHandler() {\n    if (!this._moveFigureHandler || !this._touchFigureHandler) return;\n    window.removeEventListener('mousemove', this._moveFigureHandler);\n    window.removeEventListener('touchmove', this._touchFigureHandler);\n    this._updateNotify();\n    this._lastMovePosition = null;\n  }\n\n  private moveFigure(event: MouseEvent | TouchEvent) {\n    if (!this._lastMovePosition) return;\n    \n    const updatePosition = convertMouseEventToPosition(event);\n    const diffX = updatePosition.x - this._lastMovePosition.x;\n    const diffY = updatePosition.y - this._lastMovePosition.y;\n    this._coreFigure.position.x += diffX;\n    this._coreFigure.position.y+= diffY;\n\n    if (this._ResizeArea) this._ResizeArea.shift(diffX, diffY);\n    this._lastMovePosition = updatePosition;\n  }\n  // resize logic\n\n  get isResizing(): boolean {\n    if (!this._ResizeArea) return false;\n    return this._ResizeArea.isShow;\n  }\n\n  set isResizing(state: boolean) {\n    if (!this._ResizeArea) {\n      this._ResizeArea = new ResizeArea(this._paperScope, this._coreFigure.bounds);\n      this._ResizeArea.onResize = (size, position) => {\n        this.resizeFigure(size, position);\n      }\n    }\n    this._ResizeArea.isShow = state;\n  }\n\n  private resizeFigure(size: ISize, position: IPoint) {\n    this._coreFigure.bounds.width = size.width;\n    this._coreFigure.bounds.height = size.height;\n    this._coreFigure.bounds.x = position.x;\n    this._coreFigure.bounds.y = position.y;\n  }\n}","import {IPoint} from '@consts/types'\n\ntype LineSegment = IPoint[];\n\ntype Point2fType = '-' | '*' | '+' | '/';\n\nconst point2f = (start: IPoint, type: Point2fType, end: IPoint): IPoint => {\n  switch(type) {\n    case '-':\n      return {x: start.x - end.x, y: start.y - end.y}\n    case '+':\n      return {x: start.x + end.x, y: start.y + end.y}\n    case '*':\n      return {x: start.x * end.x, y: start.y * end.y}\n    case '/':\n      return {x: start.x / end.x, y: start.y / end.y}\n  }\n}\n\n\nexport default (firstLine: LineSegment, secondSegment:LineSegment) => {\n  const [start1, end1] = firstLine;\n  const [start2, end2] = secondSegment;\n\n  const dir1 = point2f(end1, '-', start1);\n  const dir2 = point2f(end2, '-', start2);\n\n  const a1 = -dir1.y;\n  const b1 = +dir1.x;\n  const d1 = -(a1*start1.x + b1*start1.y);\n\n  const a2 = -dir2.y;\n  const b2 = +dir2.x;\n  const d2 = -(a2*start2.x + b2*start2.y);\n\n  const seg1_line2_start = a2*start1.x + b2*start1.y + d2;\n  const seg1_line2_end = a2*end1.x + b2*end1.y + d2;\n\n  const seg2_line1_start = a1*start2.x + b1*start2.y + d1;\n  const seg2_line1_end = a1*end2.x + b1*end2.y + d1;\n  \n  if (seg1_line2_start * seg1_line2_end >= 0 || seg2_line1_start * seg2_line1_end >= 0) {\n    return false;\n  }\n\n  const u = seg1_line2_start / (seg1_line2_start - seg1_line2_end);\n  const pin_out = point2f({x: u, y: u}, '*', dir1);\n  return point2f(start1, '+', pin_out);\n}","import paper from 'paper';\nimport angleToVectorPoint from '@utils/angleToVectorPoint';\nimport lineSegmentIntersection from '@utils/lineSegmentIntersection';\n\nconst isGradient = (color) => {\n  return !!color.type && color.type !== 'rgb';\n}\n\nconst createLineSegment = (figureBounds) => {\n  const { width, height, x, y } = figureBounds;\n  const topLineSegment = [ { x, y }, {x: x + width, y} ];\n  const bottomLineSegment = [\n    { x, y: y + height },\n    {x: x + width, y: y + height}\n  ];\n\n  const leftLineSegment = [ { x, y }, { x, y: y + height} ];\n  const rightLineSegment = [ \n    { x: x + width, y },\n    { x: x + width, y: y + height}\n  ];\n\n  return {\n    top: topLineSegment,\n    bottom: bottomLineSegment,\n    left: leftLineSegment,\n    right: rightLineSegment,\n  }\n}\n\nexport default (figure, color) => {\n  if (!isGradient(color)) {\n    return new paper.Color(color.red/255, color.green/255, color.blue/255, color.alpha);\n  }\n\n  const { width, height, x, y } = figure.bounds;\n  const gradient = {\n    stops: color.points.map((point) => new paper.GradientStop(\n      new paper.Color(point.red/255, point.green/255, point.blue/255, point.alpha),\n      point.left/100\n    )),\n    radial: color.type !== 'linear'\n  };\n\n  if (color.type === 'linear') {\n    const figureCenter = {\n      x: x + Math.round(width/2),\n      y: y + Math.round(height/2)\n    }\n\n    const degree = color.degree + 90;\n    const vectorPoint = angleToVectorPoint(degree);\n    const doubleMaxLength = Math.max(width, height) * 2;\n    const pointForFindIntersection = {\n      x: vectorPoint.x * doubleMaxLength,\n      y: vectorPoint.y * doubleMaxLength,\n    };\n\n    const gradientLineForFindIntersection = [\n      {\n        x: Math.floor(figureCenter.x - pointForFindIntersection.x),\n        y: Math.floor(figureCenter.y - pointForFindIntersection.y),\n      },\n      {\n        x: Math.ceil(figureCenter.x + pointForFindIntersection.x),\n        y: Math.ceil(figureCenter.y + pointForFindIntersection.y),\n      },\n    ]\n    const figureLineSegments = createLineSegment(figure.bounds);\n\n    const topIntersection = lineSegmentIntersection(gradientLineForFindIntersection, figureLineSegments.top);\n    const bottomIntersection = lineSegmentIntersection(gradientLineForFindIntersection, figureLineSegments.bottom);\n    const leftIntersection = lineSegmentIntersection(gradientLineForFindIntersection, figureLineSegments.left);\n    const rightIntersection = lineSegmentIntersection(gradientLineForFindIntersection, figureLineSegments.right);\n\n    let originPoint, destinationPoint;\n    if (topIntersection) {\n      if (!bottomIntersection) return;\n      originPoint = topIntersection;\n      destinationPoint = bottomIntersection;\n      if ((degree > 360 || degree < 180)) {\n        [originPoint,destinationPoint] = [destinationPoint, originPoint]\n      }\n    } else {\n      if (!leftIntersection || !rightIntersection) return;\n      originPoint = leftIntersection;\n      destinationPoint = rightIntersection;\n      if (!(degree > 90 && degree < 270)) {\n        [originPoint,destinationPoint] = [destinationPoint, originPoint]\n      }\n      // if (topIntersection || bottomIntersection) {\n      //   [originPoint,destinationPoint] = [destinationPoint, originPoint]\n      // }\n    }\n\n    return  {\n      gradient: gradient,\n      origin: [ Math.round(originPoint.x), Math.round(originPoint.y) ],\n      destination: [ Math.round(destinationPoint.x), Math.round(destinationPoint.y) ],\n    }\n  } else {\n    return {\n      gradient: gradient,\n      destination: [ x, y ],\n      origin: [ x + Math.round(width/2), y + Math.round(height/2)],\n    }\n  }\n}","import { IPoint } from '../consts/types';\n\nexport default (angle: number): IPoint => {\n  const angleInRadian = angle/180 * Math.PI;\n  return {\n    x: Math.cos(angleInRadian),\n    y: Math.sin(angleInRadian)\n  }\n}","import {SimpleMusicPaperShape} from '@consts/types'\nimport { AbstractFigure } from './core/abstract-figure'\nimport paper from \"paper\";\n\nimport convertColorForPaperJS from \"@common/new-drawer/utils/convert-color/convert-color\";\n\nexport class Ellipse extends AbstractFigure<paper.Path.Ellipse, SimpleMusicPaperShape> {\n  protected initCoreFigure(paperScope: paper.PaperScope, shapeData: SimpleMusicPaperShape): paper.Path {\n    const { color, shapeScheme: { size, point } } = shapeData;\n    const coreShape =  new paperScope.Path.Ellipse({\n      width: size.width,\n      height: size.height,\n      x: point.x,\n      y: point.y\n    });\n    coreShape.fillColor = convertColorForPaperJS(coreShape, color);\n    return coreShape;\n  }\n\n  protected updateCoreFigureByShapeData(coreShape: paper.Path.Ellipse, shapeData: SimpleMusicPaperShape) {\n    const { color, shapeScheme: { size, point } } = shapeData;\n\n    coreShape.bounds.height = size.height;\n    coreShape.bounds.width = size.width;\n    coreShape.bounds.x = point.x;\n    coreShape.bounds.y = point.y;\n    coreShape.fillColor = convertColorForPaperJS(coreShape, color);\n  }\n\n  protected serializationToShapeData(coreFigure: paper.Path.Ellipse, shape: SimpleMusicPaperShape): SimpleMusicPaperShape {\n    return {\n      ...shape,\n      shapeScheme: {\n        size: {\n          width: coreFigure.bounds.width,\n          height: coreFigure.bounds.height,\n        },\n        point: {\n          x: coreFigure.bounds.x,\n          y: coreFigure.bounds.y,\n        }\n      }\n    }\n  }\n}\n","import paper from \"paper\";\nimport {SimpleMusicPaperShape} from \"@consts/types\";\nimport { AbstractFigure } from './core/abstract-figure'\nimport convertColorForPaperJS from '../utils/convert-color/convert-color'\n\nexport class Rectangle extends AbstractFigure<paper.Path.Rectangle, SimpleMusicPaperShape> {\n  protected initCoreFigure(paperScope: paper.PaperScope, shapeData: SimpleMusicPaperShape): paper.Path {\n    const { color, shapeScheme: { size, point } } = shapeData;\n    const coreShape =  new paper.Path.Rectangle({\n      width: size.width,\n      height: size.height,\n      x: point.x,\n      y: point.y\n    });\n\n    coreShape.fillColor = convertColorForPaperJS(coreShape, color);\n    return coreShape;\n  }\n\n  protected updateCoreFigureByShapeData(coreShape: paper.Path.Rectangle, shapeData: SimpleMusicPaperShape) {\n    const { color, shapeScheme: { size, point } } = shapeData;\n\n    coreShape.bounds.height = size.height;\n    coreShape.bounds.width = size.width;\n    coreShape.bounds.x = point.x;\n    coreShape.bounds.y = point.y;\n    coreShape.fillColor = convertColorForPaperJS(coreShape, color);\n  }\n\n  protected serializationToShapeData(coreFigure: paper.Path.Rectangle, shape: SimpleMusicPaperShape): SimpleMusicPaperShape {\n    return {\n      ...shape,\n      shapeScheme: {\n        size: {\n          width: coreFigure.bounds.width,\n          height: coreFigure.bounds.height,\n        },\n        point: {\n          x: coreFigure.bounds.x,\n          y: coreFigure.bounds.y,\n        }\n      }\n    }\n  }\n}\n","import paper from \"paper\";\nimport {ComplexMusicPaperShape} from '@consts/types'\nimport convertColorForPaperJS from '../utils/convert-color/convert-color'\nimport {AbstractFigure} from './core/abstract-figure'\n\nexport class Polygon extends AbstractFigure<paper.Path, ComplexMusicPaperShape> {\n  protected initCoreFigure(paperScope: paper.PaperScope, shape: ComplexMusicPaperShape): paper.Path {\n    const { color, shapeScheme: { points } } = shape;\n    const path = new paperScope.Path();\n    path.closed = true;\n\n    points.forEach((pointData) => {\n      const point = new paperScope.Point(pointData);\n      path.add(point)\n    });\n\n    if (this.isSmoothFigure()) path.smooth();\n    path.fillColor = convertColorForPaperJS(path, color);\n    return path;\n  }\n\n  protected isCanChangePoints() {\n    return true;\n  }\n\n  protected updateCoreFigureByShapeData(\n    coreShape: paper.Path,\n    shapeData: ComplexMusicPaperShape,\n    paperScope: paper.PaperScope\n  ) {\n    const { color, shapeScheme: { points } } = shapeData;\n    coreShape.removeSegments();\n\n    points.forEach((pointData) => {\n      const point = new paperScope.Point(pointData);\n      coreShape.add(point)\n    });\n\n    if (this.isSmoothFigure()) coreShape.smooth();\n    coreShape.fillColor = convertColorForPaperJS(coreShape, color);\n  }\n\n  protected serializationToShapeData(coreFigure: paper.Path, shape: ComplexMusicPaperShape): ComplexMusicPaperShape {\n    return {\n      ...shape,\n      shapeScheme: {\n        points: coreFigure.segments.map((segment) => ({\n          x: segment.point.x,\n          y: segment.point.y,\n        }))\n      }\n    }\n  }\n}\n","import { Polygon } from './polygon';\n\nexport class Blob extends Polygon {\n  protected isSmoothFigure() {\n    return true;\n  }\n}","import { useRef, useEffect } from \"react\";\n\nfunction usePrev<T>(value: T): T | undefined {\n  const valueRef = useRef<T>();\n\n  useEffect(() => {\n    valueRef.current = value;\n  }, [value])\n\n  return valueRef.current;\n}\n\nexport default usePrev;","import {ISimpleColor, ICustomGradient, IGradientType} from \"@consts/types\";\n\nexport const defaultColor: ISimpleColor = {\n  red: 255,\n  green: 0,\n  blue: 0,\n  alpha: 1,\n};\n\nexport const defaultGradient: ICustomGradient = {\n  points: [\n    {\n      left: 0,\n      red: 0,\n      green: 0,\n      blue: 0,\n      alpha: 1,\n    },\n    {\n      left: 100,\n      red: 255,\n      green: 0,\n      blue: 0,\n      alpha: 1,\n    } ],\n  degree: 0,\n  type: IGradientType.linear,\n};","import styled from \"@emotion/styled\";\n\nexport const PickerSelectWrap = styled.div`\n  padding: 0 5px 5px;\n`;\n\nexport const ColorPickerWrap = styled.div`\n  .ui-color-picker {\n    width: 100%;\n    margin: 0;\n    padding-top: 10px;\n    background-color: transparent;\n    .input-group {\n      display: none;\n    }\n  }\n`;","import React, {FC, useCallback, useEffect, useMemo, useState, memo} from 'react';\nimport throttle from 'lodash/throttle';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Select from '@material-ui/core/Select';\n// @ts-ignore\nimport {ColorPicker as NativeColorPicker} from 'react-color-gradient-picker';\nimport 'react-color-gradient-picker/dist/index.css';\nimport {Color} from \"@consts/types\";\nimport usePrev from '@hooks/usePrev'\nimport {defaultColor, defaultGradient} from './const'\nimport {isGradient} from './utils'\nimport {ColorPickerWrap, PickerSelectWrap} from './styled'\n\nexport type ColorPickerProps = {\n  id: string | number | undefined;\n  color: Color | null;\n  onChange: (color: Color) => void;\n}\nexport type ColorPickerState = {\n  color: Color;\n  pikerIsGradient: boolean;\n}\n\ntype NativeColorPickerProps = {\n  gradient?: Color;\n  color?: Color;\n}\n\nconst ColorPicker:FC<ColorPickerProps>  = memo(({ id, color: payload, onChange }) => {\n  const isColorGradient = !!payload && isGradient(payload);\n  const [{ color, pikerIsGradient }, setState] = useState<ColorPickerState>({\n    color: payload ?? defaultColor,\n    pikerIsGradient: isColorGradient,\n  })\n\n  const prevId = usePrev(id);\n\n  useEffect(() => {\n    if (!payload) return;\n    setState({\n      color: payload ?? defaultColor,\n      pikerIsGradient: isColorGradient,\n    })\n  }, [payload, isColorGradient, setState]);\n\n  const onChangeType = useCallback((isGradient: boolean) => {\n    const defaultPayload: Color = isGradient ? defaultGradient : defaultColor;\n    onChange(defaultPayload);\n    setState({\n      pikerIsGradient: isGradient,\n      color: defaultPayload,\n    });\n  }, [setState, onChange]);\n\n  const onChangeColor = useCallback(throttle((color: Color) => {\n    setState(state => ({ ...state, color }));\n    onChange(color);\n  }, 20), [setState, onChange]);\n\n  const colorProps: any = useMemo(throttle(() => {\n    const data: NativeColorPickerProps = {};\n    if (!color) return data;\n\n    const propertyKey: keyof NativeColorPickerProps = pikerIsGradient ? 'gradient' : \"color\";\n    data[propertyKey] = { ...color };\n    return data;\n  }, 20), [color, pikerIsGradient])\n\n\n  if (!!prevId && prevId !== id) return null;\n\n  return (\n    <>\n      <PickerSelectWrap>\n        <Select\n          value={Number(pikerIsGradient)}\n          fullWidth={true}\n          onChange={(event) => onChangeType(!!event.target.value)}\n        >\n          <MenuItem value={0} >Fill</MenuItem>\n          <MenuItem value={1} >Gradient</MenuItem>\n        </Select>\n      </PickerSelectWrap>\n      <ColorPickerWrap>\n        <NativeColorPicker\n          // @ts-ignore\n          onStartChange={onChangeColor}\n          onChange={onChangeColor}\n          onEndChange={onChangeColor}\n          isGradient={pikerIsGradient}\n          {...colorProps}\n        />\n      </ColorPickerWrap>\n    </>\n  )\n})\n\n\nexport default ColorPicker","import {Color, ICustomGradient} from '@consts/types'\n\nexport const isGradient = (data: Color): data is ICustomGradient => {\n  return !!(data as ICustomGradient).points\n}","import styled from '@emotion/styled';\n\nexport const SidebarContainer = styled.div`\n  position: absolute;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  width: 260px;\n  padding: 15px 10px;\n  border-left: 1px solid #c1c1c1;\n  box-shadow: 0 0 5px #00000075;\n  background: #fff;\n  &:after {\n    content: '';\n    display: block;\n    width: 260px;\n  }\n`;\n","import React, {FC} from 'react';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport {Box} from '@material-ui/core';\nimport 'react-color-gradient-picker/dist/index.css';\nimport ColorPicker from \"@common/color-picker\";\nimport Launchpad from '@common/launchpad';\nimport {Track, MusicPaperShape, Color} from \"@consts/types\";\nimport {SidebarContainer} from '../../styleds/sidebar';\n\ntype SidebarProps = {\n  selectShape: MusicPaperShape | null;\n  background: Color;\n  onColorChange: (color: Color) => void;\n  onTrackChange: (track: Track) => void;\n}\n \nconst Sidebar:FC<SidebarProps> = ({\n  selectShape,\n  background,\n  onColorChange,\n  onTrackChange\n}) => {\n  const { color, track } = selectShape || {};\n  return (\n    <SidebarContainer>\n      <Box sx={{ mb: 5 }}>\n        <Box sx={{ mb: 1 }} >\n          <InputLabel>Color</InputLabel>\n        </Box>\n        <ColorPicker\n          id={selectShape?.id}\n          color={color || background}\n          onChange={(color) => onColorChange(color)}\n        />\n      </Box>\n      {!!selectShape && (\n        <Box>\n          <Box sx={{ mb: 1 }}>\n            <Box sx={{ mb: 1 }}>\n              <InputLabel>Sound</InputLabel>\n            </Box>\n          </Box>\n          <Launchpad\n            track={track || null}\n            onTrackChange={(track) => onTrackChange(track)}\n          />\n        </Box>\n      )}\n    </SidebarContainer>\n  )\n}\n\n\nexport default Sidebar","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M31.5 15.5C31.5 23.7694 24.5755 30.5 16 30.5C7.4245 30.5 0.5 23.7694 0.5 15.5C0.5 7.23057 7.4245 0.5 16 0.5C24.5755 0.5 31.5 7.23057 31.5 15.5Z\",\n  stroke: \"black\"\n});\n\nvar SvgEllipse = function SvgEllipse(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 32,\n    height: 31,\n    viewBox: \"0 0 32 31\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgEllipse, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/ellipse.cca01512.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M26.3388 2L17.6612 14.4091L2.04132 4.48182L11.0661 20.7909L1 23.2727L12.4545 25.7545L8.63636 41L20.438 27.1727L33.6281 36.0364L25.2975 23.2727L43 14.4091L25.2975 15.4727L26.3388 2Z\",\n  stroke: \"black\"\n});\n\nvar SvgPolygon = function SvgPolygon(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 44,\n    height: 42,\n    viewBox: \"0 0 44 42\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgPolygon, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/polygon.6be0083d.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"rect\", {\n  x: 0.5,\n  y: 0.5,\n  width: 27,\n  height: 27,\n  stroke: \"black\"\n});\n\nvar SvgRectangle = function SvgRectangle(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 28,\n    height: 28,\n    viewBox: \"0 0 28 28\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgRectangle, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/rectangle.796cbb72.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M15.1726 10.98C12.265 13.0386 11.376 11.0544 9.84031 7.24901C8.5856 4.13987 3.88061 5.07261 2.62603 6.31627C0.772506 8.15367 0.164671 13.8435 2.62603 17.1983C5.13532 20.6183 7.95832 17.8201 7.95832 21.862C7.95832 24.0384 -0.510648 28.3912 4.82167 34.9205C10.154 41.4497 14.2316 28.3912 18.6229 27.4585C23.0142 26.5257 15.8 43.1127 27.4056 38.0296C40.8932 32.1222 27.5388 27.1049 29.6012 24.0384C30.8559 22.1729 42.2149 26.1542 40.8932 19.9965C37.7565 5.38349 27.4056 14.0891 26.1509 14.0891C24.6539 14.0891 23.3279 11.1665 24.5826 8.18173C26.1509 4.45073 27.4056 1.65252 19.5639 1.03069C11.7223 0.408858 17.3683 9.42542 15.1726 10.98Z\",\n  stroke: \"black\"\n});\n\nvar SvgBlob = function SvgBlob(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 42,\n    height: 40,\n    viewBox: \"0 0 42 40\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgBlob, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/blob.3828cde4.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fillRule: \"evenodd\",\n  clipRule: \"evenodd\",\n  d: \"M19.5 0.178574C19.7761 0.178574 20 0.402431 20 0.678574V31.0621L28.3737 21.4922C28.5556 21.2844 28.8714 21.2633 29.0793 21.4451C29.2871 21.627 29.3081 21.9429 29.1263 22.1507L19.8763 32.7221C19.7833 32.8284 19.6497 32.8904 19.5086 32.8928C19.3674 32.8952 19.2318 32.8378 19.1352 32.7348L9.22452 22.1634C9.03565 21.9619 9.04586 21.6455 9.24732 21.4567C9.44877 21.2678 9.76519 21.278 9.95405 21.4795L19 31.1285V0.678574C19 0.402431 19.2239 0.178574 19.5 0.178574ZM1 20C1.27614 20 1.5 20.2239 1.5 20.5V38.5H37.5V20.5C37.5 20.2239 37.7239 20 38 20C38.2761 20 38.5 20.2239 38.5 20.5V39.5H0.5V20.5C0.5 20.2239 0.723858 20 1 20Z\",\n  fill: \"black\"\n});\n\nvar SvgSave = function SvgSave(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 39,\n    height: 40,\n    viewBox: \"0 0 39 40\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgSave, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/save.6813ed74.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fillRule: \"evenodd\",\n  clipRule: \"evenodd\",\n  d: \"M22.8202 0.500654C29.3256 0.763624 32.8974 4.56303 34.8585 8.2487C35.8366 10.0869 36.4195 11.9033 36.777 13.2529C36.9398 13.8678 37.0566 14.3886 37.1414 14.767L37.1653 14.8739C37.1843 14.9584 37.2011 15.0321 37.216 15.0957C39.6763 15.1764 41.5715 16.0839 42.8878 17.443C44.2605 18.8604 44.9761 20.74 45.076 22.6064C45.1757 24.4709 44.6625 26.3562 43.533 27.7855C42.3941 29.2267 40.6485 30.1765 38.3619 30.1765H29.8246C29.5484 30.1765 29.3246 29.9526 29.3246 29.6765C29.3246 29.4003 29.5484 29.1765 29.8246 29.1765H38.3619C40.3441 29.1765 41.8001 28.3655 42.7484 27.1654C43.7062 25.9535 44.166 24.3171 44.0774 22.6599C43.9889 21.0046 43.3548 19.3626 42.1695 18.1387C40.9913 16.9222 39.2409 16.0898 36.8554 16.0898C36.6079 16.0898 36.4733 15.9219 36.4465 15.8877C36.4032 15.8324 36.3779 15.778 36.3657 15.7503C36.3391 15.6897 36.3185 15.6217 36.3029 15.5658C36.27 15.4478 36.2323 15.2828 36.1897 15.0932L36.1657 14.9863C36.0809 14.608 35.968 14.1044 35.8103 13.5089C35.464 12.2015 34.905 10.4648 33.9757 8.71844C32.1249 5.24 28.8273 1.74961 22.7941 1.50042C16.7608 1.74961 13.4633 5.24 11.6124 8.71844C10.6832 10.4648 10.1241 12.2015 9.77784 13.5089C9.62012 14.1044 9.50723 14.608 9.42242 14.9863L9.39843 15.0932C9.35582 15.2828 9.3181 15.4478 9.2852 15.5658C9.2696 15.6217 9.24905 15.6897 9.2224 15.7503C9.21027 15.778 9.18493 15.8324 9.14163 15.8877C9.11488 15.9219 8.98022 16.0898 8.73269 16.0898C6.34722 16.0898 4.59683 16.9222 3.41867 18.1387C2.23333 19.3626 1.59927 21.0046 1.51074 22.6599C1.42211 24.3171 1.88193 25.9535 2.8397 27.1654C3.78804 28.3655 5.24401 29.1765 7.22626 29.1765H15.7636C16.0397 29.1765 16.2636 29.4003 16.2636 29.6765C16.2636 29.9526 16.0397 30.1765 15.7636 30.1765H7.22626C4.93968 30.1765 3.19407 29.2267 2.05512 27.7855C0.92561 26.3562 0.412448 24.4709 0.512167 22.6064C0.611993 20.74 1.32762 18.8604 2.70034 17.443C4.01666 16.0839 5.91185 15.1764 8.37219 15.0957C8.38705 15.0321 8.40379 14.9584 8.42279 14.8739L8.44676 14.767L8.44677 14.767C8.53158 14.3886 8.64832 13.8677 8.81117 13.2529C9.16862 11.9033 9.7515 10.0869 10.7296 8.2487C12.6907 4.56303 16.2626 0.763624 22.768 0.500654C22.77 0.500572 22.772 0.50049 22.7741 0.500409C22.7808 0.500141 22.7874 0.500005 22.7941 0.5\",\n  fill: \"black\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  fillRule: \"evenodd\",\n  clipRule: \"evenodd\",\n  d: \"M22.7942 40.5C22.518 40.5 22.2942 40.2761 22.2942 40L22.2942 17.2634L16.2914 24.2666C16.1117 24.4762 15.7961 24.5005 15.5864 24.3208C15.3767 24.1411 15.3525 23.8254 15.5322 23.6158L22.4145 15.5864C22.5095 15.4755 22.6482 15.4118 22.7942 15.4118C22.9401 15.4118 23.0788 15.4755 23.1738 15.5864L30.0561 23.6158C30.2358 23.8254 30.2116 24.1411 30.0019 24.3208C29.7922 24.5005 29.4766 24.4762 29.2969 24.2666L23.2942 17.2634L23.2942 40C23.2942 40.2761 23.0703 40.5 22.7942 40.5Z\",\n  fill: \"black\"\n});\n\nvar SvgUpload = function SvgUpload(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 46,\n    height: 41,\n    viewBox: \"0 0 46 41\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgUpload, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/upload.16c4cbfb.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"style\", null, \".cls-1{fill:none;stroke:#000;stroke-width:2px;}\"));\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"polygon\", {\n  className: \"cls-1\",\n  points: \"12.34 9.08 12.34 39.03 38.07 24.06 12.34 9.08\"\n});\n\nvar SvgPlay = function SvgPlay(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"Layer_1\",\n    viewBox: \"0 0 48.11 48.11\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgPlay, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/play.8848c01b.svg\";\nexport { ForwardRef as ReactComponent };","import React, { FC } from 'react';\nimport styled from '@emotion/styled';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport SvgIcon from '@material-ui/core/SvgIcon';\nimport StopIcon from '@material-ui/icons/Stop';\nimport {ShapeSchemeType, MusicPaperShape} from '@consts/types';\nimport { ReactComponent as ellipseSVG } from '../assets/ellipse.svg';\nimport { ReactComponent as polygonSVG } from '../assets/polygon.svg';\nimport { ReactComponent as rectangleSVG } from '../assets/rectangle.svg';\nimport { ReactComponent as blobSVG } from '../assets/blob.svg';\nimport { ReactComponent as saveSVG } from '../assets/save.svg';\nimport { ReactComponent as uploadSVG } from '../assets/upload.svg';\nimport { ReactComponent as playSVG } from '../assets/play.svg';\n\ntype CreateControlGroupProps = {\n  selectShape: MusicPaperShape | null;\n  isPlayMode: boolean;\n  createFigure: (type: ShapeSchemeType) => void;\n  removeFigure: (shape: MusicPaperShape) => void;\n  openDownloadModal: VoidFunction;\n  openUploadModal: VoidFunction;\n  setPlayMode: (status: boolean) => void;\n}\n\ntype CustomIconButtonProps = {\n  marginButton?: boolean\n}\n\nconst CustomIconButton = styled(IconButton)<CustomIconButtonProps>`\n  &.MuiIconButton-root {\n    background: transparent;\n    color: #fff;\n    svg {\n      fill: transparent;\n    }\n    &:active {\n      background: transparent;\n      svg {\n        fill: #000;\n      }\n    }\n  }\n`;\n\nconst DeleteIconButton = styled(IconButton)`;\n  &.MuiIconButton-root {\n    position: absolute;\n    top: -65px;\n    background: #f44336;\n    color: #fff;\n    &:hover {\n      background: #d32f2f\n    }\n  }\n`;\n\nconst ControlGroupContainer = styled.div`\n  top: 50%;\n  margin-top: -200px;\n  position: absolute;\n  left: 15px;\n  margin-bottom: -126px;\n`;\n\ntype ControlSubgroupContainerProps = {\n  hasButtonOffset?: boolean;\n  withoutExtraPadding?: boolean\n}\n\nconst ControlSubgroupContainer = styled.div<ControlSubgroupContainerProps>`\n  border-radius: 30px;\n  padding: ${({ withoutExtraPadding }) => withoutExtraPadding ? '0px' : '10px' } 0px;\n  margin-bottom: ${({ hasButtonOffset }) => hasButtonOffset ? '10px' : '0' };\n  display: flex;\n  flex-direction: column;\n  background: #eee;\n`;\n\nconst ControlGroup: FC<CreateControlGroupProps> = ({\n  selectShape,\n  isPlayMode,\n  createFigure,\n  removeFigure,\n  openDownloadModal,\n  openUploadModal,\n  setPlayMode\n}) => {\n  return (\n    <ControlGroupContainer>\n      {!!selectShape && (\n        <DeleteIconButton onClick={() => removeFigure(selectShape)}>\n          <CloseIcon/>\n        </DeleteIconButton>\n      )}\n      <ControlSubgroupContainer hasButtonOffset>\n        <CustomIconButton onClick={() => createFigure(ShapeSchemeType.rectangle)}>\n          <SvgIcon component={rectangleSVG} viewBox=\"0 0 28 28\" style={{ padding: '1px', boxSizing: 'border-box' }}/>\n        </CustomIconButton>\n        <CustomIconButton onClick={() => createFigure(ShapeSchemeType.ellipse)}>\n          <SvgIcon component={ellipseSVG} viewBox=\"0 0 32 31\"/>\n        </CustomIconButton>\n        <CustomIconButton onClick={() => createFigure(ShapeSchemeType.blob)}>\n          <SvgIcon component={blobSVG} viewBox=\"0 0 42 40\"/>\n        </CustomIconButton>\n        <CustomIconButton onClick={() => createFigure(ShapeSchemeType.polygon)}>\n          <SvgIcon component={polygonSVG} viewBox=\"0 0 44 42\"/>\n        </CustomIconButton>\n      </ControlSubgroupContainer>\n      <ControlSubgroupContainer hasButtonOffset>\n        <CustomIconButton onClick={() => openDownloadModal()}>\n          <SvgIcon\n            component={saveSVG}\n            viewBox=\"0 0 42 40\"\n            style={{\n              fill: 'transparent',\n              padding: '1px',\n              boxSizing: 'border-box'\n            }}\n          />\n        </CustomIconButton>\n        <CustomIconButton onClick={() => openUploadModal()}>\n          <SvgIcon component={uploadSVG} viewBox=\"0 0 46 41\" style={{ fill: 'transparent' }}/>\n        </CustomIconButton>\n      </ControlSubgroupContainer>\n      <ControlSubgroupContainer withoutExtraPadding>\n        <IconButton onClick={() => setPlayMode(!isPlayMode)}>\n          {!isPlayMode && (<SvgIcon component={playSVG} viewBox=\"0 0 48.11 48.11\"/>)}\n          {isPlayMode && (<StopIcon style={{ color: '#000' }} />)}\n        </IconButton>\n      </ControlSubgroupContainer>\n    </ControlGroupContainer>\n  )\n}\n\nexport default ControlGroup;","import {ISimpleColor} from '@consts/types';\n\nconst createColor = (): ISimpleColor => ({\n  alpha: 1,\n  red: Math.round(255 * Math.random()),\n  green: Math.round(255 * Math.random()),\n  blue: Math.round(255 * Math.random()),\n})\n\nexport default createColor;","import paper from \"paper\";\nimport {nanoid} from 'nanoid';\nimport {\n  IPoint,\n  ISize,\n  SimpleMusicPaperShape,\n  SimpleShapeSchemeType,\n  ComplexMusicPaperShape,\n  ComplexShapeSchemeType,\n} from '@consts/types';\nimport palettes from '@consts/palettes';\nimport createColor from '@utils/create-color';\n\nconst INIT_POINT: IPoint = {\n  x: 150,\n  y: 150\n}\n\nconst INIT_SIZE: ISize = {\n  width: 200,\n  height: 200\n}\n\nconst COMPLEX_SHAPE_INIT_POINT_COUNT = 10;\nconst firstPaletteKey = palettes.default.key;\n\nexport const createSimpleMusicShape = (musicShapeType: SimpleShapeSchemeType): SimpleMusicPaperShape => ({\n  id: nanoid(),\n  type: musicShapeType,\n  track: {\n    SoundPaletteKey: firstPaletteKey,\n    soundPosition: []\n  },\n  color: createColor(),\n  shapeScheme: {\n    point: { ...INIT_POINT },\n    size: { ...INIT_SIZE }\n  }\n})\n\n// TODO: temporary decision with use paper.Point, refactor when free time exist\nexport const createComplexMusicShape = (musicShapeType: ComplexShapeSchemeType): ComplexMusicPaperShape => {\n  const centerPoint = { ...INIT_POINT };\n  // centerPoint.x += Math.round(INIT_SIZE.width/2);\n  // centerPoint.y += Math.round(INIT_SIZE.height/2);\n\n  const corePoint = new paper.Point(centerPoint);\n  const pointArr: IPoint[] = [];\n\n  for (let i = 0; i < COMPLEX_SHAPE_INIT_POINT_COUNT; i++) {\n    const delta = new paper.Point({\n      length: (0.5) + (Math.random() * 0.25),\n      angle: (360 / COMPLEX_SHAPE_INIT_POINT_COUNT) * i\n    });\n\n    const { x, y } = corePoint.multiply(delta);\n\n    // TODO: Find decision with complex shape position and rewrite this part\n    const totalX = x + Math.floor(INIT_POINT.x * 1.7);\n    const totalY = y + Math.floor(INIT_POINT.y * 1.7);\n\n    pointArr.push({ x: totalX, y: totalY });\n  }\n\n  return {\n    id: nanoid(),\n    type: musicShapeType,\n    track: {\n      SoundPaletteKey: firstPaletteKey,\n      soundPosition: []\n    },\n    color: createColor(),\n    shapeScheme: {\n      points: pointArr\n    }\n  }\n}\n\n","import {ShapeSchemeType, SimpleShapeSchemeType} from \"@consts/types\";\n\nconst isSimpleShapeSchemeType = (type: ShapeSchemeType): type is SimpleShapeSchemeType => {\n  return [ShapeSchemeType.ellipse, ShapeSchemeType.rectangle].includes(type);\n}\n\nexport default isSimpleShapeSchemeType;","import {IPoint, ISize, ShapeSchemeType} from \"@consts/types\";\nimport {Rectangle} from \"@common/new-drawer/entity\";\n\nconst BACKGROUND_RECTANGLE_ID = '0000';\n\nconst createBackgroundRectangle = (scope: paper.PaperScope) => {\n  const backgroundColor = new scope.Color(255, 255, 255, 1);\n  const { width: viewWidth, height: viewHeight } = scope.view.bounds\n  const viewSize: ISize = { width: viewWidth, height: viewHeight };\n  const zeroPoint: IPoint = { x: 0, y: 0 };\n\n  return  new Rectangle(scope, {\n    id: BACKGROUND_RECTANGLE_ID,\n    type: ShapeSchemeType.rectangle,\n    color: backgroundColor,\n    track: null,\n    shapeScheme: {\n      point: zeroPoint,\n      size: viewSize\n    }\n  });\n}\n\nexport default createBackgroundRectangle;","import styled from '@emotion/styled';\n\nexport const Container = styled.div`\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n  height: 100%;\n`;\n\nexport const Content = styled.div`\n  width: 100%;\n  height: 100%;\n`;","import styled from '@emotion/styled';\n\nexport const TitleTextFields = styled.div`\n  width: 300px;\n  position: absolute;\n  top: 15px;\n  left: 15px;\n  input {\n    font-size: 20px;\n  }\n`;","import React, { FC, Ref, memo } from 'react';\nimport styled from \"@emotion/styled\";\n\ntype CanvasProps = {\n  canvasRef: Ref<HTMLCanvasElement>\n}\n\nexport const Content = styled.div`\n  //width: 800px;\n  //height: 800px;\n  //pointer-events: none\n`;\n\nconst Canvas: FC<CanvasProps> = ({ canvasRef }) => {\n  return (\n    <Content>\n      <canvas ref={canvasRef}  />\n    </Content>\n  )\n}\n\nexport default memo(Canvas);\n","import React, {FC, useCallback, useEffect, useMemo, useRef, useState} from 'react';\nimport paper from \"paper\";\nimport {nanoid} from 'nanoid';\nimport {Color, MusicPaperShape, ShapeSchemeType, Track} from \"@consts/types\";\nimport useCopyPast from \"@hooks/useCopyPast\";\nimport {AbstractFigure, Blob, Ellipse, Polygon, Rectangle} from \"@common/new-drawer/entity\";\nimport Sidebar from \"@common/new-drawer/parts/sidebar\";\nimport ControlGroup from \"@common/new-drawer/parts/control-group\";\nimport {createComplexMusicShape, createSimpleMusicShape} from \"@common/new-drawer/utils/shape-creators\";\nimport isSimpleShapeSchemeType from \"../utils/guards/isSimpleShapeSchemeType\";\nimport createBackgroundRectangle from \"../utils/create-background-rectangle\";\nimport {Container} from \"../styleds/root\";\nimport {TitleTextFields} from './title-text-field'\nimport Canvas from './canvas'\nimport {Input} from \"@material-ui/core\";\n\ntype ShapeMap = {\n  [key: string]: AbstractFigure;\n}\n\ntype CanvasProps = {\n  title: string;\n  shapeList: MusicPaperShape[];\n  backgroundColor: Color;\n  isPlayMode: boolean;\n  updateShapeList: (type: MusicPaperShape[]) => void;\n  updateBackgroundColor: (color: Color) => void;\n  updateTitle: (title: string) => void;\n  openUploadModal: VoidFunction;\n  openDownloadModal: VoidFunction;\n  setPlayMode: (status: boolean) => void;\n}\n\nconst createShape = (scope: paper.PaperScope, shapeData: MusicPaperShape) => {\n  switch (shapeData.type) {\n    case ShapeSchemeType.rectangle:\n      return new Rectangle(scope, shapeData);\n    case ShapeSchemeType.ellipse:\n      return new Ellipse(scope, shapeData);\n    case ShapeSchemeType.polygon:\n      return new Polygon(scope, shapeData);\n    case ShapeSchemeType.blob:\n      return new Blob(scope, shapeData);\n  }\n}\n\nconst createShapeMap = (shapeList: AbstractFigure[]) => {\n  return shapeList.reduce<ShapeMap>((map, shape) => ({\n    ...map,\n    [shape.id]: shape\n  }), {})\n}\n\nconst Drawer: FC<CanvasProps> = ({\n  title,\n  shapeList,\n  backgroundColor,\n  isPlayMode,\n  updateShapeList,\n  updateBackgroundColor,\n  updateTitle,\n  openUploadModal,\n  openDownloadModal,\n  setPlayMode\n}) => {\n  const [selectShapeId, setSelectShapeId] = useState<string | null>(null);\n  const pastBufferRef = useRef<MusicPaperShape | null>(null);\n  const shapeListRef = useRef<MusicPaperShape[]>([]);\n  shapeListRef.current = shapeList;\n  const selectShape = useMemo<MusicPaperShape | null>(() => {\n    const value = shapeList.find(shape => shape.id === selectShapeId)\n    return value || null;\n  }, [selectShapeId, shapeList])\n\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const shapeArrRef = useRef<AbstractFigure[]>([]);\n  const backgroundRef = useRef<Rectangle | null>(null);\n  const scopeRef = useRef<paper.PaperScope | null>();\n\n  const titleInputRef = useRef<HTMLInputElement>(null);\n\n  const updateShapeItem = useCallback((updateShape: MusicPaperShape) => {\n    const actualShapeList = shapeListRef.current\n    const selectShapeIndex = actualShapeList.findIndex((shape) => shape.id === updateShape.id);\n    if (selectShapeIndex === -1) return;\n    updateShapeList([\n      ...actualShapeList.slice(0, selectShapeIndex),\n      updateShape,\n      ...actualShapeList.slice(selectShapeIndex + 1)\n    ])\n\n  }, [updateShapeList])\n\n  const handleResizeWindow = useCallback(() => {\n    const container = containerRef.current;\n    const background = backgroundRef.current;\n    const scope = scopeRef.current;\n\n    if (!container || !background || !scope) return;\n    const { clientWidth: width, clientHeight: height } = container;\n\n    scope.view.viewSize.width = width;\n    scope.view.viewSize.height = height;\n\n    background.updateFromShapeData({\n      ...background.shapeData,\n      shapeScheme: {\n        ...background.shapeData.shapeScheme,\n        size: { width, height },\n      }\n    });\n    scope.view.update();\n  }, [])\n\n  useEffect(() => {\n    if (!canvasRef.current) throw new Error('Expected canvas element missing');\n    const scope = new paper.PaperScope()\n    scope.setup(canvasRef.current);\n    scopeRef.current = scope;\n\n    const background = createBackgroundRectangle(scope);\n    background.isDisable = true;\n    backgroundRef.current = background;\n    const selectShape: { current: MusicPaperShape | null } = {\n      current: null,\n    };\n\n    const handleShapeUpdate = (shapeData: MusicPaperShape) => {\n      const actualShapeList = shapeListRef.current\n      const selectShapeIndex = actualShapeList.findIndex((shape) => shape.id === shapeData.id);\n      if (selectShapeIndex === -1) return;\n      updateShapeList([\n        ...actualShapeList.slice(0, selectShapeIndex),\n        shapeData,\n        ...actualShapeList.slice(selectShapeIndex + 1)\n      ])\n    }\n\n    const handleShapeFocused = (shapeData: MusicPaperShape) => {\n      if (shapeData.id === backgroundRef.current?.id) {\n        setSelectShapeId(null);\n        return;\n      }\n\n      const actualShapeList = shapeListRef.current\n      const selectShapeIndex = actualShapeList.findIndex((shape) => shape.id === shapeData.id);\n      if (selectShapeIndex === -1) return;\n      updateShapeList([\n        ...actualShapeList.slice(0, selectShapeIndex),\n        ...actualShapeList.slice(selectShapeIndex + 1),\n        shapeData,\n      ])\n\n      if (selectShape.current?.id !== shapeData.id) {\n        setSelectShapeId(shapeData.id);\n      }\n    }\n\n    const handleCanvasClick = () => {\n      titleInputRef.current?.focus();\n    }\n\n    const containerElement = containerRef.current;\n    window.addEventListener('resize', handleResizeWindow);\n    containerElement?.addEventListener('click', handleCanvasClick);\n\n    AbstractFigure.emitter.on('click', handleShapeFocused);\n    AbstractFigure.emitter.on('edited', handleShapeUpdate);\n    return () => {\n      window.removeEventListener('resize', handleResizeWindow)\n      containerElement?.removeEventListener('click', handleCanvasClick);\n\n      AbstractFigure.emitter.off('click', handleShapeFocused)\n      AbstractFigure.emitter.on('edited', handleShapeUpdate)\n    }\n  }, [setSelectShapeId, updateShapeList, handleResizeWindow])\n\n  useEffect(() => {\n    if (!scopeRef.current) throw new Error('Expected scope missing');\n    const shapeMap = createShapeMap(shapeArrRef.current)\n    const scope = scopeRef.current;\n    shapeArrRef.current = [];\n    shapeList.forEach(shapeData => {\n      let shape = shapeMap[shapeData.id];\n      if (shape) {\n        shape.updateFromShapeData(shapeData);\n        delete shapeMap[shapeData.id];\n      } else {\n        shape = createShape(scope, shapeData)\n      }\n      shapeArrRef.current.push(shape);\n      shape.bringToFront();\n    })\n\n    // const reverseShapeArr = [...shapeArrRef.current].reverse();\n    // reverseShapeArr.forEach(shape => shape.bringToFront());\n\n    Object.values(shapeMap).forEach((shape) => {\n      shape.remove();\n    })\n  }, [shapeList])\n\n  useEffect(() => {\n    if (!selectShape) return;\n    const shape = shapeArrRef.current.find(shape => shape.id === selectShape.id);\n    if (!shape) return;\n    shapeArrRef.current.forEach(shape => shape.isActive = false);\n    shape.isActive = true;\n  }, [selectShape])\n\n  useEffect(() => {\n    const background = backgroundRef.current;\n    if (!background) return;\n    background.updateFromShapeData({\n      ...background.shapeData,\n      color: backgroundColor\n    })\n  }, [backgroundColor])\n\n  useEffect(() => {\n    shapeArrRef.current.forEach(shape => shape.isPlayMode = isPlayMode);\n    handleResizeWindow();\n    setSelectShapeId(null);\n  }, [isPlayMode, setSelectShapeId, handleResizeWindow])\n\n\n  const handleCopy = useCallback(() => {\n    if (!selectShape) return;\n    pastBufferRef.current = { ...selectShape };\n  }, [selectShape]);\n\n  const handlePast = useCallback(() => {\n    if (!pastBufferRef.current) return;\n    const bufferValueShape: MusicPaperShape = {\n      ...pastBufferRef.current,\n      id: nanoid()\n    };\n\n    setSelectShapeId(bufferValueShape.id);\n    updateShapeList([\n      ...shapeListRef.current,\n      bufferValueShape\n    ]);\n\n\n  }, [updateShapeList, setSelectShapeId]);\n\n  useCopyPast(handleCopy, handlePast);\n\n\n  const createMusicShape = useCallback((type: ShapeSchemeType) => {\n    const musicShape = isSimpleShapeSchemeType(type) ? createSimpleMusicShape(type) : createComplexMusicShape(type);\n    updateShapeList([\n      ...shapeList,\n      musicShape\n    ])\n  }, [shapeList, updateShapeList])\n\n  const removeMusicShape = useCallback((shape: MusicPaperShape) => {\n    const index = shapeList.findIndex(item => item.id === shape.id);\n    if (index === -1) return;\n\n    updateShapeList([\n      ...shapeList.slice(0 ,index),\n      ...shapeList.slice(index + 1),\n    ])\n  }, [shapeList, updateShapeList])\n\n  const handleColorChange = useCallback((color: Color) => {\n    if (selectShape) {\n      updateShapeItem({  ...selectShape, color });\n    } else {\n      updateBackgroundColor(color)\n    }\n  }, [\n    selectShape,\n    updateBackgroundColor,\n    updateShapeItem\n  ])\n\n  const handleTrackChange = useCallback((track: Track) => {\n    if (!selectShape) return;\n    updateShapeItem({  ...selectShape, track });\n  }, [selectShape, updateShapeItem])\n\n\n  return (\n    <>\n      <Container ref={containerRef}>\n        <TitleTextFields>\n          <Input\n            value={title}\n            ref={titleInputRef}\n            placeholder='Title'\n            fullWidth\n            onChange={event => updateTitle(event.target.value)}\n          />\n        </TitleTextFields>\n        <ControlGroup\n          selectShape={selectShape}\n          isPlayMode={isPlayMode}\n          createFigure={createMusicShape}\n          removeFigure={removeMusicShape}\n          openDownloadModal={openDownloadModal}\n          openUploadModal={openUploadModal}\n          setPlayMode={setPlayMode}\n        />\n        <Canvas canvasRef={canvasRef} />\n        {!isPlayMode && (\n          <Sidebar\n            selectShape={selectShape}\n            background={backgroundColor}\n            onColorChange={handleColorChange}\n            onTrackChange={handleTrackChange}\n          />\n        )}\n      </Container>\n    </>\n);\n}\n\nexport default Drawer;\n","import {fromBase64, encode as encodeToBase64} from 'js-base64';\nimport {pack, unpack} from \"jsonpack\";\n\n\nexport const encode = <T extends {}>(data: T): string => {\n  const packJSON = pack(data);\n  return encodeToBase64(packJSON, true);\n}\nexport const decode = <T extends {}>(dataStr: string): T => {\n  const packJSON = fromBase64(dataStr);\n  return unpack<T>(packJSON);\n}\n","import styled from '@emotion/styled';\n\ntype DropZoneContainerProps = {\n  isActive: boolean;\n}\n\nexport const DropZoneContainer = styled.div<DropZoneContainerProps>`\n  padding: 40px 10px;\n  background: #f5f5f5;\n  border: 1px ${({ isActive }) => isActive ? 'dashed' : 'solid'} #717171;\n  outline: none;\n  cursor: pointer;\n`;","import React, {useCallback} from 'react'\nimport Typography from '@material-ui/core/Typography';\nimport {useDropzone} from 'react-dropzone'\nimport {DropZoneContainer} from './styled'\n\nconst loadFile = (file: File) => new Promise<string | ArrayBuffer | null>(resolve => {\n  const reader = new FileReader();\n  reader.addEventListener('loadend', () => resolve(reader.result));\n  reader.readAsArrayBuffer(file)\n});\n\ntype DropzoneProps = {\n  onLoaded(data: string): void;\n  accept?: string;\n}\n\nexport const Dropzone = ({ onLoaded, accept }: DropzoneProps) => {\n  const onDrop = useCallback((acceptedFiles: File[]) => {\n    const firstFile = acceptedFiles[0];\n    loadFile(firstFile).then((arrayBuffer) => {\n      onLoaded(arrayBuffer as string)\n    })\n  }, [onLoaded])\n\n  const {getRootProps, getInputProps, isDragActive} = useDropzone({\n    multiple: false,\n    onDrop,\n    accept: accept ?? undefined\n  })\n\n  return (\n    <DropZoneContainer\n      {...getRootProps()}\n      isActive={isDragActive}\n    >\n      <input {...getInputProps()} />\n      {\n        isDragActive ?\n          <Typography>Drop the files here ...</Typography> :\n          <Typography>Drag and drop your file here, or click to select file</Typography>\n      }\n    </DropZoneContainer>\n  )\n}\n","import React, {FC, useCallback, useState} from 'react';\nimport styled from '@emotion/styled'\nimport Modal from '@material-ui/core/Modal';\nimport Box from '@material-ui/core/Box';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport Radio from '@material-ui/core/Radio';\nimport RadioGroup from '@material-ui/core/RadioGroup';\nimport TextField from '@material-ui/core/TextField';\nimport Button from '@material-ui/core/Button';\nimport {decode} from '@utils/squeezeBase64';\nimport {MusicPaper} from '@consts/types';\nimport {Dropzone} from '@common/dropzone';\n\ntype UploadModalProps = {\n  isOpen: boolean;\n  uploadMusicPaper: (musicPaper: MusicPaper) => void;\n  closeUploadModal: VoidFunction;\n}\n\nconst ModalContainer = styled.div`\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  position: absolute;\n  width: 500px;\n  height: 500px;\n  background-color: #fff;\n  padding: 15px;\n  outline: none;\n`;\n\nconst UploadStringTextField = styled(TextField)`\n  width: 100%;\n  padding-bottom: 15px;\n`;\n\nconst CustomFormControlLabel = styled(FormControlLabel)`\n  .MuiRadio-colorSecondary.Mui-checked {\n    color: #4e4e4e;\n  }\n`;\n\nconst CustomButton = styled(Button)`\n  &.MuiButton-root {\n    background: #fff;\n    color: #2f2f2f;\n    border: 1px solid #2f2f2f;\n    box-shadow: none;\n    &:hover {\n      background: #fff;\n      box-shadow: none;\n    }\n  }\n`;\n\ntype UploadType = 'file' | 'dataString';\n\nexport const ImportModal: FC<UploadModalProps> = ({ isOpen, uploadMusicPaper, closeUploadModal }) => {\n  const [uploadType, setUploadType] = useState<UploadType>('file');\n  const [dataString, setDataString] = useState<string>('');\n\n  const handleUploadFile = useCallback((base64: string) => {\n    const musicPaper = decode<MusicPaper>(base64);\n    uploadMusicPaper(musicPaper);\n  }, [uploadMusicPaper])\n\n  const handleUploadString = useCallback(() => {\n    const musicPaper = decode<MusicPaper>(dataString);\n    uploadMusicPaper(musicPaper);\n  }, [dataString, uploadMusicPaper])\n\n  const handleUploadTypeChange = useCallback((type: string) => {\n    setUploadType(type as UploadType)\n  }, [setUploadType])\n\n  return (\n    <Modal\n      open={isOpen}\n      onClose={closeUploadModal}\n    >\n      <ModalContainer>\n        <Box sx={{ m: 2 }}>\n          <FormControl component=\"fieldset\">\n            <FormLabel component=\"legend\">:</FormLabel>\n            <RadioGroup\n              name=\"uploadType\"\n              value={uploadType}\n              row\n              onChange={((_, value) => handleUploadTypeChange(value))}\n            >\n              <CustomFormControlLabel value=\"file\" control={<Radio />} label=\"Upload your file\" />\n              <CustomFormControlLabel value=\"dataString\" control={<Radio />} label=\"Paste from the clipboard\" />\n            </RadioGroup>\n          </FormControl>\n        </Box>\n        {(uploadType === 'file') && (\n          <div style={{ margin: '0 15px' }} >\n            <Dropzone\n              onLoaded={handleUploadFile}\n              accept='.json'\n            />\n          </div>\n        )}\n        {(uploadType === 'dataString') && (\n          <>\n            <Box sx={{ m: 2 }}>\n              <UploadStringTextField\n                label=\"Paste data from the clipboard\"\n                multiline\n                rows={7}\n                placeholder='Paste'\n                value={dataString}\n                onChange={(el) => setDataString(el.target.value)}\n              />\n            </Box>\n            <div style={{ margin: '0 15px' }} >\n              <CustomButton\n                variant=\"contained\"\n                fullWidth\n                disabled={dataString.length <= 0}\n                onClick={handleUploadString}\n              >\n                Upload\n              </CustomButton>\n            </div>\n          </>\n        )}\n      </ModalContainer>\n    </Modal>\n  )\n}\n","\nconst saveFile = (file: Blob, fileName: string) => {\n  const a = document.createElement(\"a\");\n  a.download = fileName;\n  const url = URL.createObjectURL(file);\n  a.href = url;\n\n  document.body.appendChild(a);\n  a.click();\n  setTimeout(() => {\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n  }, 0);\n}\n\nexport default saveFile;","import React, {FC, useCallback, useMemo} from 'react';\nimport styled from '@emotion/styled'\nimport Modal from '@material-ui/core/Modal';\nimport Box from '@material-ui/core/Box';\nimport TextField from '@material-ui/core/TextField';\nimport Button from '@material-ui/core/Button';\nimport {MusicPaper} from '@consts/types';\nimport {encode as encodeSqueezeBase64} from \"@utils/squeezeBase64\";\n// import copyToClipboard from \"@utils/copy-to-clipboard\";\nimport saveFile from \"@utils/saveFile\";\n\ntype UploadModalProps = {\n  isOpen: boolean;\n  musicPaper: MusicPaper\n  closeDownloadModal: VoidFunction;\n}\n\nconst ModalContainer = styled.div`\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  position: absolute;\n  width: 500px;\n  height: auto;\n  background-color: #fff;\n  padding: 15px;\n  outline: none;\n`;\n\nexport const CustomButton = styled(Button)`\n  &.MuiButton-root {\n    background: #fff;\n    color: #2f2f2f;\n    border: 1px solid #2f2f2f;\n    box-shadow: none;\n    &:hover {\n      background: #fff;\n      box-shadow: none;\n    }\n  }\n`;\n\nexport const ExportModal: FC<UploadModalProps> = ({\n  isOpen,\n  musicPaper,\n  closeDownloadModal\n}) => {\n  const dataString = useMemo(() => encodeSqueezeBase64(musicPaper), [musicPaper])\n  const handleDownload = useCallback(() => {\n    const file = new Blob([dataString], { type: 'application/json' });\n      saveFile(file, `${musicPaper.title}.json`)\n  }, [dataString, musicPaper])\n\n  // const handleCopyToClipboard = useCallback(() => {\n  //   copyToClipboard(dataString);\n  // }, [dataString])\n\n  return (\n    <Modal open={isOpen} onClose={closeDownloadModal} >\n      <ModalContainer>\n        <Box sx={{ mb: 2 }} >\n          <TextField\n            label=\"Copy data to the clipboard or download the file\"\n            multiline\n            rows={16}\n            value={dataString}\n            fullWidth\n          />\n        </Box>\n        {/*<Box sx={{ mb: 2 }} >*/}\n        {/*  <Button*/}\n        {/*    variant=\"contained\"*/}\n        {/*    fullWidth*/}\n        {/*    disabled={dataString.length <= 0}*/}\n        {/*    onClick={handleCopyToClipboard}*/}\n        {/*  >*/}\n        {/*    Export to clipboard*/}\n        {/*  </Button>*/}\n        {/*</Box>*/}\n        <CustomButton\n          variant=\"contained\"\n          fullWidth\n          disabled={dataString.length <= 0}\n          onClick={handleDownload}\n        >\n          DOWNLOAD\n        </CustomButton>\n      </ModalContainer>\n    </Modal>\n  )\n}\n","import React, {FC, useState, useCallback, useRef} from 'react';\nimport {nanoid} from 'nanoid'\nimport {Color, MusicPaper, MusicPaperShape} from '@consts/types';\nimport PaperMusicDrawer from './parts/drawer';\nimport {ImportModal} from \"./parts/import-modal\";\nimport {ExportModal} from \"./parts/export-modal\";\n\nconst WHITE_COLOR: Color = { alpha: 1, green: 255, red: 255, blue: 255 };\nconst MUSIC_PAPER_DATA_VERSION = '1.0.0';\n\nconst PaperMusic: FC = () => {\n  const [isUploadModalOpen, setUploadModalState] = useState<boolean>(false);\n  const [isDownloadModalOpen, setDownloadModalState] = useState<boolean>(false);\n  const [isPlayMode, setPlayMode] = useState<boolean>(false);\n  const [musicPaper, setMusicPaper] = useState<MusicPaper>({\n    id: nanoid(),\n    title: '',\n    version: MUSIC_PAPER_DATA_VERSION,\n    shapeList: [],\n    backgroundColor: { ...WHITE_COLOR }\n  });\n\n  const musicPaperRef = useRef<MusicPaper>(musicPaper);\n  musicPaperRef.current = musicPaper;\n\n  const uploadMusicPaper = useCallback((data: MusicPaper) => {\n    setMusicPaper(data);\n    setUploadModalState(false);\n  }, [setUploadModalState, setMusicPaper])\n\n  const updateShapeList = useCallback((updateShapeList: MusicPaperShape[]) => {\n    setMusicPaper(state => ({ ...state, shapeList: updateShapeList }));\n  }, [setMusicPaper])\n\n  const updateBackgroundColor = useCallback((color: Color) => {\n    setMusicPaper(state => ({ ...state, backgroundColor: color }));\n  }, [setMusicPaper])\n\n  const updateTitle = useCallback((title: string) => {\n    if (title.length > 40) return;\n    setMusicPaper(state => ({ ...state, title }));\n  }, [setMusicPaper])\n\n  const openUploadModal = useCallback(() => {\n    setUploadModalState(true);\n  }, [setUploadModalState])\n\n  const closeUploadModal = useCallback(() => {\n    setUploadModalState(false);\n  }, [setUploadModalState])\n\n  const openDownloadModal = useCallback(() => {\n    setDownloadModalState(true);\n  }, [setDownloadModalState])\n\n  const closeDownloadModal = useCallback(() => {\n    setDownloadModalState(false);\n  }, [setDownloadModalState])\n\n  return (\n    <>\n      <PaperMusicDrawer\n        title={musicPaper.title}\n        shapeList={musicPaper.shapeList}\n        backgroundColor={musicPaper.backgroundColor}\n        isPlayMode={isPlayMode}\n        openUploadModal={openUploadModal}\n        openDownloadModal={openDownloadModal}\n        updateShapeList={updateShapeList}\n        updateBackgroundColor={updateBackgroundColor}\n        updateTitle={updateTitle}\n        setPlayMode={setPlayMode}\n      />\n      <ImportModal\n        isOpen={isUploadModalOpen}\n        uploadMusicPaper={uploadMusicPaper}\n        closeUploadModal={closeUploadModal}\n      />\n      <ExportModal\n        isOpen={isDownloadModalOpen}\n        musicPaper={musicPaper}\n        closeDownloadModal={closeDownloadModal}\n      />\n    </>\n  );\n}\n\nexport default PaperMusic;\n","import React from 'react';\n// import Launchpad from '@common/launchpad'\nimport Drawer from './components/common/new-drawer/paper-music';\n\nimport 'normalize.css'\nimport './root.css'\n\nconst App = () => {\n  return (\n    <Drawer/>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);  \n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n}\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './app';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { SoundPaletteMap, SoundPalette, SoundRow, SoundMatrix } from \"@components/common/launchpad\";\n\nexport const firstMatrix: SoundRow[] = [\n  [\n    { nodeName: 'a7', sound: 'x3', color: '#EF56CE' },\n    { nodeName: 'a8', sound: 'x2', color: '#EC3899' },\n    { nodeName: 'a9', sound: 'x1', color: '#E91A64' },\n  ],\n  [\n    { nodeName: 'a4', sound: 'x6', color: '#F489D0' },\n    { nodeName: 'a5', sound: 'x5', color: '#F064A5' },\n    { nodeName: 'a6', sound: 'x4', color: '#EE3E7B' },\n  ],\n  [\n    { nodeName: 'a1', sound: 'x9', color: '#F9BBD2' },\n    { nodeName: 'a2', sound: 'x8', color: '#F38FB2' },\n    { nodeName: 'a3', sound: 'x7', color: '#F16294' },\n  ],\n\n]\n\nconst secondMatrix: SoundMatrix = [\n  [\n    { nodeName: 'b7', sound: 'b3', color: '#4470E0' },\n    { nodeName: 'b8', sound: 'b2', color: '#2356AF' },\n    { nodeName: 'b9', sound: 'b1', color: '#013B7D' }\n  ],\n  [\n    { nodeName: 'b4', sound: 'b6', color: '#56A4E3' },\n    { nodeName: 'b5', sound: 'b5', color: '#2B84BD' },\n    { nodeName: 'b6', sound: 'b4', color: '#006396' }\n  ],\n  [\n    { nodeName: 'b1', sound: 'b9', color: '#67D8E5' },\n    { nodeName: 'b2', sound: 'b8', color: '#43BCD4' },\n    { nodeName: 'b3', sound: 'b7', color: '#0090B5' }\n  ],\n]\nconst thirdMatrix: SoundMatrix = [\n  [\n    { nodeName: 'd7', sound: 'd3', color: '#44B7AC' },\n    { nodeName: 'd8', sound: 'd2', color: '#22A992' },\n    { nodeName: 'd9', sound: 'd1', color: '#009A78'},\n  ],\n  [\n    { nodeName: 'd4', sound: 'd6', color: '#6FC5AD'  },\n    { nodeName: 'd5', sound: 'd5', color: '#38BC94' },\n    { nodeName: 'd6', sound: 'd4', color: '#00B27A' },\n  ],\n  [\n    { nodeName: 'd1', sound: 'd9', color: '#99D3AD' },\n    { nodeName: 'd2', sound: 'd8', color: '#70D09E' },\n    { nodeName: 'd3', sound: 'd7', color: '#46CC8F'},\n  ],\n]\n\nconst fourthMatrix: SoundMatrix = [\n  [\n    { nodeName: 'x7', sound: 'a3', color: '#aaa3b1' },\n    { nodeName: 'x8', sound: 'a2', color: '#b94eb2' },\n    { nodeName: 'x9', sound: 'a1', color: '#c617b2' }\n  ],\n  [\n    { nodeName: 'x4', sound: 'a6', color: '#d89e81' },\n    { nodeName: 'x5', sound: 'a5', color: '#e15c7f' },\n    { nodeName: 'x6', sound: 'a4', color: '#df2a89' }\n  ],\n  [\n    { nodeName: 'x1', sound: 'a9', color: '#f9ce04' },\n    { nodeName: 'x2', sound: 'a8', color: '#f87f2e' },\n    { nodeName: 'x3', sound: 'a7', color: '#f6434c' }\n  ],\n]\n\n\n\n\n\nconst defaultSoundPalette: SoundPalette = {\n  key: 'default',\n  caption: 'Xylophone',\n  matrix: firstMatrix\n}\n\nconst secondSoundPalette: SoundPalette = {\n  key: 'extra',\n  caption: 'Bass',\n  matrix: secondMatrix\n}\n\nconst thirdSoundPalette: SoundPalette = {\n  key: 'bass',\n  caption: 'Drum',\n  matrix: thirdMatrix\n}\nconst fourthSoundPalette: SoundPalette = {\n  key: 'Mixed',\n  caption: 'Mixed',\n  matrix: fourthMatrix\n}\nconst soundPaletteMap: SoundPaletteMap = {\n  default: defaultSoundPalette,\n  extra: secondSoundPalette,\n  bass: thirdSoundPalette,\n  Mixed: fourthSoundPalette\n}\n\nexport default soundPaletteMap;\n","const soundMap = {\n  x1: './sounds/1 Xylophone.mp3',\n  x2: './sounds/2 Xylophone.mp3',\n  x3: './sounds/3 Xylophone.mp3',\n  x4: './sounds/4 Xylophone.mp3',\n  x5: './sounds/5 Xylophone.mp3',\n  x6:'./sounds/6 Xylophone.mp3',\n  x7: './sounds/7 Xylophone.mp3',\n  x8: './sounds/8 Xylophone.mp3',\nx9:'./sounds/9 Xylophone.mp3',\nb1: './sounds/1 Bass.mp3',\nb2: './sounds/2 Bass.mp3',\nb3: './sounds/3 Bass.mp3',\nb4: './sounds/4 Bass.mp3',\nb5: './sounds/5 Bass.mp3',\nb6:'./sounds/6 Bass.mp3',\nb7: './sounds/7 Bass.mp3',\nb8: './sounds/8 Bass.mp3',\nb9:'./sounds/9 Bass.mp3',\nd1: './sounds/1 Drums.mp3',\nd2: './sounds/2 Drums.mp3',\nd3: './sounds/3 Drums.mp3',\nd4: './sounds/4 Drums.mp3',\nd5: './sounds/5 Drums.mp3',\nd6:'./sounds/6 Drums.mp3',\nd7: './sounds/7 Drums.mp3',\nd8: './sounds/8 Drums.mp3',\nd9:'./sounds/9 Drums.mp3',\na1: './sounds/1.mp3',\na2: './sounds/2.mp3',\na3: './sounds/3.mp3',\na4: './sounds/4.mp3',\na5: './sounds/5.mp3',\na6:'./sounds/6.mp3',\na7: './sounds/7.mp3',\na8: './sounds/8.mp3',\na9:'./sounds/10.mp3'\n}\n\nexport default soundMap;\n","import {Howl} from 'howler';\n\ntype InitSoundData = {\n  [sound: string]: string;\n}\n\ntype SoundMap = {\n  [sound: string]: Howl\n};\n\n\n\nfunction playSound(soundMap: SoundMap, soundArr: string[], index = 0) {\n    const soundKey = soundArr[index];\n    if (!soundKey) return;\n\n    const sound = soundMap[soundKey];\n    sound.once('end', () => {\n      playSound(soundMap, soundArr, index + 1);\n    })\n\n    sound.play();\n}\n\n\nexport default class SongFactory {\n  protected soundMap: SoundMap;\n\n  constructor(initSoundData: InitSoundData) {\n    this.soundMap = {}\n\n    Object.keys(initSoundData).forEach((key) => {\n      const url = initSoundData[key]\n      this.soundMap[key] = new Howl({ src: [url] });\n    });\n  }\n\n  playSong(soundArray: string[]) {\n    const unexpendedSound = soundArray.find(\n      (sound) => !this.soundMap[sound]\n    );\n\n    if (unexpendedSound) {\n      throw new Error(`Unexpended sound ${unexpendedSound}`);\n    }\n\n\n    const soundMap = this.soundMap;\n    playSound(soundMap, soundArray)\n  }\n};\n","import { css } from '@emotion/react';\nimport styled from '@emotion/styled';\n\n\nexport const MatrixContainer = styled.div`\n    height: 100%;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    margin-bottom: 10px;\n`;\n\nexport const MatrixRow = styled.div`\n    display: flex;\n    flex-direction: row;\n    width: 100%;\n    height: 100%;\n    /* margin: 10px 0; */\n`;\n\ntype MatrixCellProps = {\n    color?: string;\n    isSelect?: boolean;\n}\nexport const MatrixCell = styled.div<MatrixCellProps>`\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 100%;\n    /* margin: 0 10px; */\n    box-sizing: border-box;\n    background-color: ${(props) => props.color ?? '#eee'};\n    text-align: center;\n    cursor: pointer;\n    font-size: 12px;\n    ${(props) => props.isSelect && css`background: white`}\n    * {\n        font-size: 12px;\n    }\n`;\n","import {IPoint} from '@consts/types';\nimport React, { FC, useCallback, useMemo } from 'react';\nimport { SoundMatrix} from '@common/launchpad';\nimport {\n  MatrixContainer,\n  MatrixRow,\n  MatrixCell\n} from '../styleds/matrix';\n\ninterface IMatrixProps {\n  activeCell: IPoint[];\n  matrix: SoundMatrix;\n  schemeKey: string;\n  onToggleCell: (position: IPoint) => void;\n}\n\ninterface IActiveCellMap {\n  [row: number]: {\n    [cell: number]: number\n  }\n}\n\nconst LaunchpadMatrix: FC<IMatrixProps> = ({\n    matrix,\n    activeCell,\n    schemeKey,\n    onToggleCell\n}) => {\n  const orderMap = useMemo(() => {\n    const keyMap = new Array(matrix.length).fill(null).map((_, i) => [i, {}]);\n    const map: IActiveCellMap = Object.fromEntries(keyMap);\n    return activeCell.reduce((obj, { x, y }, index) => {\n      obj[y][x] = index + 1;\n      return obj;\n    }, map)\n  }, [activeCell, matrix]);\n\n  const isCellSelect = useCallback(\n    (x: number, y: number) => !!orderMap[y][x],\n    [orderMap]\n  )\n\n  const onCellClick = useCallback((x: number, y: number) => {\n    onToggleCell({ x, y });\n  }, [onToggleCell])\n\n  return (\n    <MatrixContainer>\n      {matrix.map((row, rowIndex) => (\n        <MatrixRow key={`${schemeKey}-${rowIndex}`}>\n          {row.map((cell, cellIndex) => (\n            <MatrixCell\n              key={`${schemeKey}-${rowIndex}:${cellIndex}`}\n              isSelect={isCellSelect(cellIndex, rowIndex)}\n              color={cell.color}\n              onClick={() => onCellClick(cellIndex, rowIndex)}\n            >\n              {cell.nodeName}\n            </MatrixCell>\n          ))}\n        </MatrixRow>\n      ))}\n    </MatrixContainer>\n  )\n}\n\nexport default LaunchpadMatrix;","import styled from '@emotion/styled';\n\nexport const Container  = styled.div`\n  width: 240px;\n  height: 240px;\n`; ","import styled from '@emotion/styled';\nimport Button from \"@material-ui/core/Button\";\n\n\nexport const PlayButton = styled(Button)`\n  &.MuiButton-root {\n    background: #fff;\n    color: #2f2f2f;\n    border: 1px solid #2f2f2f;\n    box-shadow: none;\n    &:hover {\n      background: #fff;\n      box-shadow: none;\n    }\n  }\n`;","import React, { FC, useCallback, useMemo, useState } from 'react';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Select from '@material-ui/core/Select';\nimport {IPoint, Track} from '@consts/types';\nimport isPositionEqual from '@utils/isPositionEqual'\nimport MusicFactory from '@utils/MusicFactory'\nimport Matrix from './parts/matrix'\nimport palettes from '@consts/palettes';\nimport soundMap from '@consts/soundMap';\nimport { Container } from './styleds/root';\nimport { PlayButton } from './styleds/play-button';\n\ninterface LaunchPadProps {\n  onTrackChange: (music: Track) => void\n  track: Track | null;\n}\n\nconst paletteItemsForDD = Object.keys(palettes).map((key) => palettes[key]);\nconst firstPalette = palettes.default;\n\nconst createEmptyTrack = (): Track => ({\n  SoundPaletteKey: firstPalette.key,\n  soundPosition: [],\n})\n\nconst LaunchPad: FC<LaunchPadProps> = ({ track, onTrackChange: onMusicChange }) => {\n  // const [localTrack, setMusic] = useState<Track>(createEmptyTrack());\n  const [selectPalette, setPalette] = useState<string>(track?.SoundPaletteKey || firstPalette.key);\n\n  // useEffect(() => {\n  //   setMusic(() => track ?? createEmptyTrack());\n  // }, [track, localTrack, setMusic])\n\n  // useEffect(() => {\n  //   if (onMusicChange) onMusicChange(localTrack);\n  // }, [localTrack, onMusicChange])\n\n  const musicFactory = useMemo(() => new MusicFactory(soundMap), []);\n\n  const onPlay = useCallback(() => {\n    const { SoundPaletteKey, soundPosition } = track || createEmptyTrack();\n    const { matrix } = palettes[SoundPaletteKey];\n    const musicRoad = soundPosition.map(({ x, y }) => {\n      const { sound } = matrix[x][y];\n      return sound;\n    });\n\n    musicFactory.playSong(musicRoad);\n  }, [musicFactory, track]);\n\n  // TODO: refactor this fn\n  const onToggleCell = useCallback((position: IPoint) => {\n    const { SoundPaletteKey, soundPosition } = track || createEmptyTrack();\n    const index = soundPosition.findIndex(\n      (trackItem) => isPositionEqual(trackItem, position)\n    )\n\n    let updateSoundPosition: IPoint[];\n    if (index !== -1) {\n      updateSoundPosition = [\n        ...soundPosition.slice(0, index),\n        ...soundPosition.slice(index + 1)\n      ]\n    } else {\n      updateSoundPosition = [\n        ...soundPosition,\n        position\n      ]\n    }\n\n    onMusicChange({\n      SoundPaletteKey,\n      soundPosition: updateSoundPosition\n    })\n  }, [track, onMusicChange])\n\n  const onChangePalette = useCallback((value: string) => {\n    onMusicChange({\n      SoundPaletteKey: value,\n      soundPosition: []\n    });\n    setPalette(value);\n  }, [setPalette, onMusicChange])\n\n  return (\n    <Container>\n      <Select\n        value={selectPalette}\n        onChange={(event) => onChangePalette(event.target.value)}\n        fullWidth={true}\n      >\n        {paletteItemsForDD.map(({ caption, key }) => (\n          <MenuItem key={key} value={key} >{caption}</MenuItem>\n        ))}\n      </Select>\n      <Matrix\n        matrix={palettes[selectPalette].matrix}\n        activeCell={track?.soundPosition ?? []}\n        schemeKey={selectPalette}\n        onToggleCell={onToggleCell}\n      />\n      <PlayButton\n        onClick={onPlay}\n        color='primary'\n        variant=\"contained\"\n        fullWidth={true}\n      >\n        Play\n      </PlayButton>\n    </Container>\n  )\n}\n\nexport default LaunchPad;\n","import { IPoint } from \"@consts/types\";\n\nexport default (first: IPoint, second: IPoint) => {\n  return first.x === second.x && first.y === second.y;\n}"],"sourceRoot":""}